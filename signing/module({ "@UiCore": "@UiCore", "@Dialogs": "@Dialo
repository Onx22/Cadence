module({ "@UiCore": "@UiCore", "@Dialogs": "@Dialogs", "@PasswordStrength": "@PasswordStrength", "@Northstar": "@Northstar", "@NextUtil": "@NextUtil", "@Widgets": "@Widgets", "@Model": "@Model", "css!/build/welcome/mode/desktop/ftux.css": "css!/asset/d5c180f9c007377c/build/welcome/mode/desktop/ftux.css" }, function (n) { var J = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function () { return '<div class="canvas-container"><canvas width="1024" height="768"></canvas></div>\n' }, useData: !0 }) }({}), w = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function () { return '<div class="progress">\n    <div class="bar">\n        <div class="value"></div>\n        <div class="percentage"></div>\n    </div>\n    <div class="border"></div>\n</div>\n' }, useData: !0 }) }({}); w = function (h) { var d = h.UiCore.UiContext; return d.extend("LoadingProgress", { uiContextName: "loading_progress", className: "loading-progress", dependencies: "dialogManager globalStringManager perfReportManager progressPromises Promise timer window".split(" "), initialize: function (a) { d.prototype.initialize.call(this, a); this.__timer = a.timer; this.__lingerTime = a.lingerTime || 500; this.finished = new a.Promise(function (e) { this.__finishedResolver = e }.bind(this)); var c = a.weighting || _.map(_.range(this.__progressPromises.length), function () { return 1 }.bind(this)); this.__initTime = +new Date; this.__progressControls = _.map(this.__progressPromises, function (e, b) { return { promise: e, weight: c[b], progress: 0 } }.bind(this)); this.__progressTotal = _.reduce(this.__progressControls, function (e, b) { return e + b.weight }.bind(this), 0); this.addToDOM(); this.__updateBar = this.__createUpdateBarFunction(); _.each(this.__progressControls, function (e) { e.promise.then(this.__onProgress.bind(this), this.__onProgress.bind(this)) }.bind(this)); this.__onProgress() }, delete: function () { this.__timer.clearTimeout(this.__timeoutFade); this.__timer.clearTimeout(this.__timeoutDelete); d.prototype.delete.call(this) }, render: function () { this.$el.html(h.template).addClass("animated"); this.$(".percentage").show(); this.__perfReportManager.record(this.__perfReportManager.tags.WIDGET_LOADING_PROGRESS, "auto", this.__perfStartTime) }, partialProgress: function (a, c) { "pending" === this.__progressControls[a].promise.state && (this.__progressControls[a].progress = c, this.__onProgress()) }, passive: function () { this.$el.addClass("passive") }, __onProgress: function () { var a = _.reduce(this.__progressControls, function (c, e) { "pending" !== e.promise.state && (e.progress = 1); return c + e.progress * e.weight }, 0); this.__updateBar(a / this.__progressTotal); a === this.__progressTotal && this.__finish() }, __finish: function () { this.__finishedResolver.accept(); this.__timer.clearTimeout(this.__timeout); this.__timeoutFade = this.__timer.setTimeout(function () { this.$el.fadeOut(.25 * this.__lingerTime) }.bind(this), .75 * this.__lingerTime); this.__timeoutDelete = this.__timer.setTimeout(this.delete.bind(this), this.__lingerTime); this.trigger("timeCompleted", +new Date - this.__initTime) }, __createUpdateBarFunction: function () { this.$(".percentage").show(); return function (a) { var c = this; this.__window.requestAnimationFrame(function () { c.$(".value").css("width", 100 * a + "%"); c.$(".percentage").text(c.__globalStringManager.get("loading_bar_text", { percentage: Math.floor(100 * a) })) }) }.bind(this) } }) }({ NextUtil: n["@NextUtil"], UiCore: n["@UiCore"], template: w }); var p = function (h) { return h.Northstar.Network.extend("WrappedNetwork", { __construct: function (d) { this.__parent.__construct.call(this); this.__northstar = d.ns; this.__network = new this.__northstar.XHRNetwork }, setTimeout: function (d) { this.__network.setTimeout(d) }, GET: function (d, a, c, e) { a && a.toString().includes("creator_assetserver") && (d = d || {}, d.withCredentials = !0); return this.__network.GET(d, a, c, e) } }) }({ Northstar: n["@Northstar"] }); p = function (h) { var d = h.UiCore.UiContext; return d.extend("NorthstarModule", { uiContextName: "northstar_module", className: "northstar-module", dependencies: "diagnostics globalStartupModel prefsManager Promise timer window".split(" "), initialize: function (a) { var c = this; a = void 0 === a ? {} : a; d.prototype.initialize.call(this, a); this.loadingBarPromise = new this.__Promise(function (g) { c.loadingBarPromiseResolver = g }); this.__diagnostics.bumpNorthstarInstances(1); this.__prefsManager.populated().then(function () { var g = this.__prefsManager.get("next.northstarLoggingPrefs"); this.__loggingPref = g ? g.split(",") : [] }.bind(this)); this.__northstar = h.Northstar; this.__globalStartupModel.get("id") && this.__globalStartupModel.get("id").includes("creator") ? this.__network = new h.WrappedNetwork({ ns: this.__northstar }) : this.__network = new this.__northstar.XHRNetwork; this.__preciseTimer = new this.__northstar.PreciseTimer; this.__frameTimer = new this.__northstar.RequestAnimationFrameTimer; this.__prefsManager.populated().then(function () { var g = c.__prefsManager.getBool("next.high_fps_mode") ? 60 : 30; window.console.log("Target frame rate", g, "FPS"); c.__frameTimer.setTargetFrameRate(g) }); this.__document = a.document || document; this.addToDOM(); new this.__Promise(function (g) { this.__logEvents("northstar", "got loadedEverything resolver"); this.__loadedEverythingResolver = g }.bind(this)); a = a.canvas || this.$("canvas"); this.__logEvents("northstar", "NorthstarModule.canvas ", a); this.__canvas = new this.__northstar.DOMCanvas(a[0]); this.__setupInput(); a[0].id = "northstar-canvas-" + Date.now().toString(); this.__gl = new this.__northstar.WebGL(a[0].id); var e = new this.__northstar.WebGLGraphicsConduit(this.__gl).deleteLater(), b = new this.__northstar.HttpConduit(this.__network).deleteLater(), f = this.__globalStartupModel.get("polarisUrl"); this.__session3dAggregate = this.__northstar.Session3dAggregate.create(e, b, f, this.__preciseTimer, this.__canvas.getSize()[0], this.__canvas.getSize()[1]); this.__canvasGestureAdapter = new this.__northstar.CanvasGestureAdapter({ canvasElement: a[0], documentObj: this.__document, session3dAggregate: this.__session3dAggregate, windowObj: this.__window }); this.__canvasGestureAdapter.setCallbackMouseDoubleClick(function (g, k) { k = 1; c.__session3dAggregate.getCurrentPolicy().deleteLater().handleGestureTapAtRasterCoordinates(g, k) }); $(this.__window).on("resize.NorthstarModule" + this.cid, this.__onWindowResize.bind(this)); this.__onWindowResize(); this.__frameTimer.onUpdate(function (g) { this.__session3dAggregate.tickByDeltaSeconds(g); this.__session3dAggregate.processCompletions() }.bind(this)); this.__frameTimer.run() }, pause: function () { this.__session3dAggregate.enableRendering(!1); this.__session3dAggregate.conserveMemory() }, resume: function () { this.__session3dAggregate.enableRendering(!0) }, loadedEverything: function () { return this.__loadedEverythingResolver.promise }, delete: function (a) { if (this.isDeleted() && "undefined" === typeof a) return this.__window.console.warn("NorthstarModule::delete  - Double deletion of module??"), !1; this.__diagnostics.bumpNorthstarInstances(-1); d.prototype.delete.call(this); $(this.__window).off("resize.NorthstarModule" + this.cid); this.__canvasGestureAdapter.delete(); this.__session3dAggregate.delete(); this.__session3dAggregate = null; this.__gl.delete(); this.__gl = null; this.__canvas.delete(); this.__canvas = this.__canvas.element = null; this.__frameTimer.stop(); this.__frameTimer.delete(); this.__frameTimer = null; this.__network.delete(); this.__network = null; this.__preciseTimer.delete(); this.__preciseTimer = null }, __logEvents: function (a) { if (_.contains(this.__loggingPref, a) || "error" == a) { var c = Array.prototype.slice.call(arguments, 1); c.unshift(this.uiContextName + "(" + a + ")>>"); c.unshift((new Date).toISOString() + ":"); _.contains(this.__loggingPref, "stacktrace") || "error" == a ? this.__window.console.trace.apply(this.__window.console, c) : this.__window.console.log.apply(this.__window.console, c) } }, __onWindowResize: function () { var a = this.$el.width(), c = this.$el.height(); if (0 === a || 0 === c) this.__logEvents("northstar_debug", "Zero canvas size ", a, ":", c); else { this.__canvas.resize(a, c); this.__session3dAggregate.setCanvasSize(a, c); var e = this.__canvas.getSize(); this.__logEvents("northstar_debug", "__onWindowResize ", a, ":", c, "-", e[0], ":", e[1]); this.trigger("resize") } }, __documentOnKeyDown: function (a) { this.__altKeyDown = a.altKey; this.__ctrlKeyDown = a.ctrlKey; this.__shiftKeyDown = a.shiftKey }, __documentOnKeyUp: function (a) { this.__altKeyDown = a.altKey; this.__ctrlKeyDown = a.ctrlKey; this.__shiftKeyDown = a.shiftKey }, __setupInput: function () { this.__shiftKeyDown = this.__ctrlKeyDown = this.__altKeyDown = this.__isContextMenuDown = !1; this.__document.addEventListener("keydown", this.__documentOnKeyDown.bind(this), !0); this.__document.addEventListener("keyup", this.__documentOnKeyUp.bind(this), !0) }, __onValidSceneDo: function (a) { this.__session3dAggregate && a.call(this, this.__session3dAggregate.getCurrentPolicy()) }, __scrubTriggeredAction: function (a) { a = a.match(/[\x00-\x7F]/g); return a = null === a ? "" : a.join("") }, logLoadCompletionError: function (a, c, e, b, f, g) { this.__logEvents("error", a, c, e, b); this.__logEvents("northstar_load_response", a, f, g) }, showLoadingProgress: function (a, c) { this.__loadingProgress = a.createChildContext(h.LoadingProgress, c) }, makeLoadCompletion: function (a) { a = (a = void 0 === a ? {} : a) || {}; var c = a.source || "Northstar"; a = _.extend({ onAllAssetsSuccess: function () { this.__logEvents("northstar_load_response", c, " - All assets loaded - Scene load complete") }.bind(this), onCriticalAssetFailure: function (e, b, f, g, k) { this.logLoadCompletionError(c + " - A critical asset failed to load:", e, b, f, g, k) }.bind(this), onAllActionsReady: function () { this.__logEvents("northstar_load_response", "All Action ready") }.bind(this), onCriticalAssetsReady: function () { this.__logEvents("northstar_load_response", c + " - All critical assets loaded") }.bind(this), onProgress: function (e) { this.__logEvents("northstar_load_response", c + " - Scene load is " + parseInt(100 * e, 10) + "% complete") }.bind(this), onNonCriticalAssetFailure: function (e, b, f, g, k) { this.logLoadCompletionError(c + " - A non-critical asset failed to load:", e, b, f, g, k) }.bind(this) }, _.pick(a, "onAllAssetsSuccess onCriticalAssetFailure onAllActionsReady onCriticalAssetsReady onProgress onNonCriticalAssetFailure".split(" "))); return this.__northstar.LoadCompletion.implement(a).deleteLater() }, makeAsyncCompletion: function (a) { a = (a = void 0 === a ? {} : a) || {}; var c = a.source || "Northstar"; a = _.extend({ onSuccess: function () { this.__logEvents("northstar_load_response", c, " - Async call success") }.bind(this), onFailure: function (e, b, f, g, k) { this.logLoadCompletionError(c + " - Async call failure:", e, b, f, g, k) }.bind(this) }, _.pick(a, ["onSuccess", "onFailure"])); return this.__northstar.AsyncCompletion.implement(a).deleteLater() } }) }({ Northstar: n["@Northstar"], UiCore: n["@UiCore"], LoadingProgress: w, WrappedNetwork: p }); J = function (h) { var d = h.NorthstarModule; return d.extend("FtuxModule", { uiContextName: "ftux_module", className: "ftux-module", dependencies: "femaleUrl ftuxState globalStartupModel maleUrl Northstar Promise roomUrl window".split(" "), FTUX_MODE_GENDER: 0, FTUX_MODE_LOOK: 1, trackedEvents: function () { return d.prototype.trackedEvents.call(this).concat([{ type: "click", selector: "canvas", name: "change_gender", handler: this.__onChangeGender }]) }, initialize: function (a) { a = void 0 === a ? {} : a; this.__window = a.window; this.__roomUrl = a.roomUrl; this.__femaleUrl = a.femaleUrl; this.__maleUrl = a.maleUrl; this.__Promise = a.Promise; this.__ftuxMode = this.FTUX_MODE_GENDER; this.__globalStartupModel = a.globalStartupModel; this.ftuxState = a.ftuxState; this.document = document; d.prototype.initialize.call(this, a); this.__policyFtux = this.__session3dAggregate.acquirePolicyFtux(); this.__policyFtux.configureAssetsUrls(this.__roomUrl, this.__maleUrl, this.__femaleUrl); a = { source: "FtuxModule.initialize", onAllAssetsSuccess: this.__onSession3dLoaded.bind(this), onCriticalAssetFailure: this.__onSession3dError.bind(this) }; a = this.makeLoadCompletion(a); var c = (new this.__northstar.PolicyConfig).deleteLater(); c.useAntiAlias = !0; this.__policyFtux.establishScene(c, a) }, delete: function () { this.__policyFtux.delete(); d.prototype.delete.call(this) }, render: function () { d.prototype.render.call(this); this.$el.html(h.template) }, setModeToLook: function (a) { this.__ftuxMode !== this.FTUX_MODE_LOOK && (this.setGender(this.ftuxState.getGender()), this.__policyFtux.setModeToLook(), this.__ftuxMode = this.FTUX_MODE_LOOK, this.ftuxState.getAssetUrl() ? this.changeAssetsByUrlString(this.ftuxState.getAssetUrl(), a) : this.__window.console.log("there was no url in setModeToLook for ", this.ftuxState.getGender())) }, setModeToGender: function () { this.__policyFtux.setModeToGender(); this.__ftuxMode = this.FTUX_MODE_GENDER; this.ftuxState.clearAssets() }, changeAssetsByUrlString: function (a, c) { var e = { onAllAssetsSuccess: function () { c() }.bind(this), onCriticalAssetFailure: function () { this.__recordEvent("change_assets_url_error", { record: !0 }); c() }.bind(this) }; this.ftuxState.setAssetUrl(a); this.__policyFtux && this.__policyFtux.changeAvatar(a, this.makeLoadCompletion(e)) }, focusOnBodyRegion: function (a) { if (null !== this.__policyFtux && this.__ftuxMode === this.FTUX_MODE_LOOK) { var c = this.__northstar.EnumHumanoidBodyRegion; this.__policyFtux.focusOnBodyRegion({ skins: c.SKIN, heads: c.HEAD, eyes: c.EYES, hair: c.HAIR, facial_hair: c.FACIALHAIR, tops: c.TORSO, bottoms: c.LEGS, shoes: c.FEET, accessories: c.TORSO }[a] || c.ALL) } }, setGender: function (a) { window.policyFtux = this.__policyFtux; this.__ftuxMode !== this.FTUX_MODE_LOOK && ("male" === a ? (this.ftuxState.setGender("male"), this.__policyFtux.selectGenderByOrdinal(1)) : (this.ftuxState.setGender("female"), this.__policyFtux.selectGenderByOrdinal(2))) }, __onChangeGender: function (a) { this.__ftuxMode !== this.FTUX_MODE_LOOK && (this.ftuxState.clearAssets(), a.offsetX < this.$("canvas").width() / 2 ? this.setGender("female") : this.setGender("male"), this.trigger("change:gender")) }, __onSession3dLoaded: function (a) { this.$el.addClass("is-ready"); this.__loadedEverythingResolver.resolve(this) }, __onSession3dError: function (a) { this.__recordEvent("ftux_3d_async_completion_error", { record: !0 }); this.__window.console.log("jsSession3dAsyncCompletion.onError", a) }, noJQResizeToContainer: function () { this.__session3dAggregate.setCanvasSize(this.$el[0].offsetWidth, this.$el[0].offsetHeight) }, reparent: function (a) { this.$el.appendTo(a); this.__onWindowResize() }, _getPolicy: function () { return this.__policyFtux } }) }({ UiCore: n["@UiCore"], NorthstarModule: p, template: J }); var K = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ 1: function () { return " is-experiment " }, compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '<div class="ftux-body fixed-position-ghost-layout loading">\n    <div class="avatar-container-2d"></div>\n    <div class="avatar-container" data-gender></div>\n    <div class="main-content">\n        <div class="download-container">\n            <p class="download-intro">'; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "welcome_download_intro", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += ' <span class="username"></span>!</p>\n            <div class="download-title">\n                <p>', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "welcome_download_title", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</p>\n            </div>\n\n            <div class="download-body">\n                <p>', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "download_body", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</p>\n            </div>\n\n            <div class="download-widgets ', b = a["if"].call(d, d && d.isExperiment, { name: "if", hash: {}, fn: this.program(1, e), inverse: this.noop, data: e }), (b || 0 === b) && (g += b), g += '">\n                <div class="download-client-container"></div>\n                <div class="download-mobile-container"></div>\n            </div>\n\n            <div class="id-goto-next-link hidden">\n                 <p>', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "welcome_goto_next", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g + '</p>\n            </div>\n        </div>\n    </div>\n    <div class="download-reminder-container"></div>\n    <div class="survey-popup-container"></div>\n</div>\n' }, useData: !0 }) }({}); p = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = ""; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-imvu-logo", { name: "icon", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '\n<h3 class="survey-popup-title">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "survey_popup_title", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</h3>\n<p class="survey-popup-text">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "survey_popup_text", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</p>\n<div class="survey-popup-buttons">\n    <button class="btn btn-secondary btn-small cancel-cta">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "survey_popup_no_thanks", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</button>\n    <button class="btn btn-small btn-primary join-study-cta">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "survey_popup_join_study", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g + "</button>\n</div>\n" }, useData: !0 }) }({}); var x = function (h) { var d = h.UiCore.UiContext; return d.extend("SurveyPopup", { className: "survey-popup bottom-slide-in", uiContextName: "survey_popup", dependencies: ["rest", "window"], trackedEvents: function () { return [{ type: "click", selector: ".join-study-cta", name: "join_study", handler: "__joinStudy" }, { type: "click", selector: ".cancel-cta", name: "cancel", handler: "__hide" }] }, initialize: function (a) { d.prototype.initialize.call(this, a); this.__surveyURL = this.__serviceProvider.get("baseRoot") + "client_download/survey"; this.addToDOM() }, render: function () { this.$el.html(h.template()) }, __joinStudy: function () { this.__window.open(this.__surveyURL, "_blank") }, __hide: function () { this.$el.removeClass("bottom-slide-in"); this.$el.addClass("bottom-slide-out") } }) }({ UiCore: n["@UiCore"], template: p }); p = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ 1: function (d, a, c, e) { var b; c = this.escapeExpression; return "\n                <span>" + c((b = a.left_column_subtitle || d && d.left_column_subtitle, "function" === typeof b ? b.call(d, { name: "left_column_subtitle", hash: {}, data: e }) : b)) + "</span>\n            " }, compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = this.escapeExpression; var g = '<div class="top-row"></div>\n<div class="column-container">\n    <div class="left-column column">\n        <div class="back-bar">\n            <div class="icon">\n                <svg class="icon-back" width="20" height="20" viewBox="0 0 25 25"><title>back</title><path d="M8.9 12.5l6.82-7.25c.18-.2.28-.44.28-.7 0-.28-.1-.53-.28-.72-.4-.44-1.13-.44-1.54 0l-8.1 8.57-.08.1 8.2 8.67c.2.2.47.33.75.33s.54-.12.74-.33c.18-.2.28-.46.28-.74 0-.28-.1-.54-.3-.74l-6.8-7.2z" fill-rule="evenodd"/></svg>\n            </div>\n            <span>' + c((f = a.left_column_title || d && d.left_column_title, "function" === typeof f ? f.call(d, { name: "left_column_title", hash: {}, data: e }) : f)) + "</span>\n            "; return b = a["if"].call(d, d && d.left_column_subtitle, { name: "if", hash: {}, fn: this.program(1, e), inverse: this.noop, data: e }), (b || 0 === b) && (g += b), g + '\n        </div>\n        <div class="left-sidebar"></div>\n    </div>\n    <div class="main-column column">\n        <div class="main-content"></div>\n    </div>\n    <div class="right-column column">\n        <div class="back-bar">\n            <div class="icon">\n                <svg class="icon-back" width="20" height="20" viewBox="0 0 25 25"><title>back</title><path d="M8.9 12.5l6.82-7.25c.18-.2.28-.44.28-.7 0-.28-.1-.53-.28-.72-.4-.44-1.13-.44-1.54 0l-8.1 8.57-.08.1 8.2 8.67c.2.2.47.33.75.33s.54-.12.74-.33c.18-.2.28-.46.28-.74 0-.28-.1-.54-.3-.74l-6.8-7.2z" fill-rule="evenodd"/></svg>\n            </div>\n            <span>' + c((f = a.right_column_title || d && d.right_column_title, "function" === typeof f ? f.call(d, { name: "right_column_title", hash: {}, data: e }) : f)) + '</span>\n        </div>\n        <div class="right-sidebar"></div>\n    </div>\n</div>\n<div class="fixed-position-ghost-layout">\n    <div class="top-row"></div>\n    <div class="column-container">\n        <div class="left-column column">\n            <div class="left-sidebar"></div>\n        </div>\n        <div class="main-column column">\n            <div class="main-content"></div>\n        </div>\n        <div class="right-column column">\n            <div class="right-sidebar"></div>\n        </div>\n    </div>\n</div>' }, useData: !0 }) }({}); p = function (h) { var d = h.Widgets.WithmeContext; return d.extend("Submode", { __id: "", layout: "", dependencies: "googleAnalytics mode modeManager multiGetManager platform smartAdHelper window".split(" "), __recordShown: !0, drillDownFrom: null, initialize: function (a) { a.id && (this.__id = a.id); this.__window = a.serviceProvider.get("window"); d.prototype.initialize.call(this, a); this.__modeManager = a.modeManager; this.__googleAnalytics = a.googleAnalytics; this.__parentMode = a.mode; this.__parentMode.setLayout(this.layout); this.__slideIns = [] }, render: function () { this.$el.html(h.template({ left_column_title: this.leftColumnTitle, right_column_title: this.rightColumnTitle, left_column_subtitle: this.leftColumnSubTitle })) }, subId: function () { return this.__id }, summarize: function () { return {} }, getTitle: function () { }, overrideMainNav: null, overrideAuxNav: null, overrideNavLabel: null, show: function (a) { a = void 0 === a ? {} : a; d.prototype.show.call(this, a); this.__modeManager.togglePermalink(!0 === a.isPermaLink); this.$el.css("display", ""); this.__parentMode.markActiveNav(this.subId()); this.__parentMode.updateTitle(); this.__googleAnalytics.recordPageView(this.__serviceProvider.get("appName") + "/" + this.__parentMode.modeId + "/" + ("__default__" == this.subId() ? "" : this.subId())); "__default__" !== this.subId() && this.__googleAnalytics.recordSubModeChange(this.subId()); this.__toggleLeftColumnToggleVisibility() }, __bringColumnToFront: function (a) { a = a.closest(".column, .top-row"); var c = a.parents(".fixed-position-ghost-layout"); 0 < c.length && c.addClass("in-use"); a.addClass("has-content"); a.hasClass("left-column") && this.__toggleLeftColumnToggleVisibility() }, __getWidgetContainer: function (a, c) { return (c ? this.$(".fixed-position-ghost-layout") : this.$el).find(a).first() }, __addWidget: function (a, c, e, b) { a = this.__getWidgetContainer(a, b); this.__bringColumnToFront(a); return this.createChildContext(c, _.extend({ $parentElement: a }, e)) }, addWidgetToTopRow: function (a, c, e) { return this.__addWidget(".top-row", a, c, e) }, addWidgetToBody: function (a, c, e) { return this.__addWidget(".main-content", a, c, e) }, addWidgetToLeftSidebar: function (a, c, e) { return this.__addWidget(".left-sidebar", a, c, e) }, addWidgetToRightSidebar: function (a, c, e) { return this.__addWidget(".right-sidebar", a, c, e) }, addWidgetToRightColumn: function (a, c, e) { return this.__addWidget(".right-column", a, c, e) }, addWidgetToLeftColumn: function (a, c, e) { return this.__addWidget(".left-column", a, c, e) }, __addSmartAd: function (a, c, e) { a = this.__getWidgetContainer(a, e); var b = c.format; this.__bringColumnToFront(a); "top" === c.append ? a.prepend('<div class="smart-ad-slot" id=' + this.__smartAdHelper.getTagId(b) + "></div>") : a.append('<div class="smart-ad-slot" id=' + this.__smartAdHelper.getTagId(b) + "></div>"); this.__window.sas.cmd.push(function () { this.__window.sas.call("iframe", { siteId: this.__smartAdHelper.getSiteId(), pageId: this.__smartAdHelper.getPageId(this.__platform), formatId: this.__smartAdHelper.getFormatId(b), target: "", tagId: this.__smartAdHelper.getTagId(), width: c.width, height: c.height }) }.bind(this)) }, __addSmartAdForIframeSubmode: function (a, c) { var e = this.__smartAdHelper.getTagId(); c.attr("id", e); this.__window.sas.cmd.push(function () { this.__window.sas.call("iframe", { siteId: this.__smartAdHelper.getSiteId(), pageId: this.__smartAdHelper.getPageId(this.__platform), formatId: this.__smartAdHelper.getFormatId(a.format), target: "", tagId: e, width: a.width, height: a.height }) }.bind(this)) }, addAdToBody: function (a, c, e) { a = { append: a, width: 768, height: 90, format: "banner" }; c ? this.__addSmartAdForIframeSubmode(a, e) : this.__addSmartAd(".main-content", a) }, addAdToLeftColumn: function (a, c) { var e = { append: !0, width: 300, height: 600, format: "tower" }; a ? this.__addSmartAdForIframeSubmode(e, c) : this.__addSmartAd(".left-column", e, !1) }, addAdToRightColumn: function (a, c) { var e = { append: !0, width: 300, height: 600, format: "tower" }; a ? this.__addSmartAdForIframeSubmode(e, c) : this.__addSmartAd(".right-column", e, !1) }, removeDisplayAds: function () { this.__window.sas.clean(); this.$(".smart-ad-slot").remove() }, addSlideIn: function (a, c) { a = this.addWidgetToBody(a, c, !0); this.__slideIns.push(a); return a }, hideAllSlideIns: function () { _.each(this.__slideIns, function (a) { a.hide() }.bind(this)) }, toggleMagicLineMenu: function (a) { "undefined" === typeof this.__magicLine && (this.__modeContainer = document.getElementsByClassName("mode-container")[0], this.__magicLine = this.__modeContainer.getElementsByClassName("magic-line-menu")[0]); "undefined" !== typeof this.__magicLine && (!0 === a ? this.__magicLine.classList.add("hidden") : this.__magicLine.classList.remove("hidden")) }, __toggleLeftColumnToggleVisibility: function () { var a = this.$(".left-column").hasClass("has-content"); this.$el.parents(".mode").find('li[data-nav="toggle_left_column"]').toggleClass("hidden", !a) } }) }({ UiCore: n["@UiCore"], Widgets: n["@Widgets"], template: p }); var y = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '<div class="download-reminder-icon">'; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-download-reminder-arrow", { name: "icon", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</div>\n<div class="download-reminder-text"><span class="title">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "click here", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += "</span>", f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "download_reminder_text", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g + '</div>\n<div class="download-reminder-image"><img class="avatarImage" src=""></div>\n' }, useData: !0 }) }({}); y = function (h) { var d = h.UiCore.UiContext; return d.extend("DownloadReminder", { className: "download-reminder", uiContextName: "download_reminder", dependencies: ["imageManager", "loginManager", "rest", "window"], initialize: function (a) { d.prototype.initialize.call(this, a); this.__isLoggedIn = this.__loginManager.isLoggedIn(); this.__defaultAvatarImage = "/common/withme/img/download_reminder_default_avatar.png"; this.addToDOM() }, render: function () { this.$el.html(h.template()); this.__isLoggedIn ? (this.__myself = this.__loginManager.getCurrentUser(), this.__myself.populated().then(function () { this.__avatarOutfitModel = this.__myself.getSingleEdge("avatar"); return this.__avatarOutfitModel.populated() }.bind(this)).then(function () { return this.__rest.get(this.__avatarOutfitModel.get("look_url")) }.bind(this)).then(function (a) { a = a.response.data || a; this.__setOverlayAvatar(IMVU.URI.build(a.avatarImage || a.response.avatarImage, { height: 200, width: 150, view: "pose.wave" })) }.bind(this)).catch(function (a) { this.__window.console.log("Something went wrong:", a) }.bind(this))) : this.__setOverlayAvatar(this.__defaultAvatarImage) }, __setOverlayAvatar: function (a) { this.__imageManager.load(this.$("img.avatarImage"), a) } }) }({ UiCore: n["@UiCore"], template: y }); var C = function (h) { var d = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame; return function (a, c, e) { var b = +new Date, f = b + a; (function k() { var m = +new Date; m > f ? e() : (c(b, m, f), d(k)) })() } }({}), u = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ 1: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '\n        <div class="download-widget-icon">'; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-apple", { name: "icon", hash: { id: "imvu_logo", class: "bg-logo" }, data: e }), (b || 0 === b) && (g += b), g + "</div>\n    " }, 3: function (d, a, c, e) { var b; c = "\n        "; return b = a["if"].call(d, d && d.iconMac, { name: "if", hash: {}, fn: this.program(4, e), inverse: this.program(6, e), data: e }), (b || 0 === b) && (c += b), c + "\n    " }, 4: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '\n            <div class="download-widget-icon">'; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-apple", { name: "icon", hash: { id: "imvu_beta", class: "bg-logo" }, data: e }), (b || 0 === b) && (g += b), g + "</div>\n        " }, 6: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '\n            <div class="download-widget-icon">'; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-imvu-beta", { name: "icon", hash: { id: "imvu_beta", class: "bg-logo" }, data: e }), (b || 0 === b) && (g += b), g + "</div>\n        " }, 8: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '\n        <div class="download-widget-icon">'; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-windows", { name: "icon", hash: { id: "imvu_windows", class: "bg-logo" }, data: e }), (b || 0 === b) && (g += b), g + "</div>\n    " }, 10: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '\n        <div class="download-widget-icon">'; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-mobile_icon", { name: "icon", hash: { id: "imvu_mobile", class: "bg-logo" }, data: e }), (b || 0 === b) && (g += b), g + "</div>\n    " }, 12: function (d, a, c, e) { var b, f; c = '\n    <div class="download-widget-body">'; return f = a.bodyText || d && d.bodyText, b = "function" === typeof f ? f.call(d, { name: "bodyText", hash: {}, data: e }) : f, (b || 0 === b) && (c += b), c += ' <span class="small-print"><sup>*</sup>', f = a.smallPrint || d && d.smallPrint, b = "function" === typeof f ? f.call(d, { name: "smallPrint", hash: {}, data: e }) : f, (b || 0 === b) && (c += b), c += "</span></div>\n        ", b = a["if"].call(d, d && d.isUpdate, { name: "if", hash: {}, fn: this.program(13, e), inverse: this.program(15, e), data: e }), (b || 0 === b) && (c += b), c + "\n    " }, 13: function (d, a, c, e) { var b, f, g = this.escapeExpression; c = a.helperMissing; g = '\n            <a href="' + g((f = a.clientUrl || d && d.clientUrl, "function" === typeof f ? f.call(d, { name: "clientUrl", hash: {}, data: e }) : f)) + '" class="update-widget-client-button pending ' + g((f = a.platform || d && d.platform, "function" === typeof f ? f.call(d, { name: "platform", hash: {}, data: e }) : f)) + '">'; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "update_widget_downloading_text", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g + "</a>\n        " }, 15: function (d, a, c, e) { var b, f, g = this.escapeExpression; c = a.helperMissing; g = '\n            <a href="' + g((f = a.clientUrl || d && d.clientUrl, "function" === typeof f ? f.call(d, { name: "clientUrl", hash: {}, data: e }) : f)) + '" class="download-widget-client-button ' + g((f = a.platform || d && d.platform, "function" === typeof f ? f.call(d, { name: "platform", hash: {}, data: e }) : f)) + '">'; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "download_widget_button_1", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g + "</a>\n        " }, 17: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '\n        <div class="download-widget-app-buttons-container">\n            <div class="download-widget-button download-widget-button_ios">\n                <a target="_blank" href="https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8" class="download-ios-button">\n                    '; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-app-store", { name: "icon", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '\n                </a>\n            </div>\n            <div class="download-widget-button download-widget-button_android">\n                <a target="_blank" href="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova" class="last download-andriod-button">\n                    ', f = a.icon || d && d.icon || c, b = f.call(d, "icon-google-play", { name: "icon", hash: {}, data: e }), (b || 0 === b) && (g += b), g + "\n                </a>\n            </div>\n        </div>\n    " }, compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '<div class="download-widget-container '; return f = a.type || d && d.type, b = "function" === typeof f ? f.call(d, { name: "type", hash: {}, data: e }) : f, (b || 0 === b) && (g += b), g += '">\n    ', b = a["if"].call(d, d && d.mac, { name: "if", hash: {}, fn: this.program(1, e), inverse: this.noop, data: e }), (b || 0 === b) && (g += b), g += "\n    ", b = a["if"].call(d, d && d.beta, { name: "if", hash: {}, fn: this.program(3, e), inverse: this.noop, data: e }), (b || 0 === b) && (g += b), g += "\n    ", b = a["if"].call(d, d && d.windows, { name: "if", hash: {}, fn: this.program(8, e), inverse: this.noop, data: e }), (b || 0 === b) && (g += b), g += "\n    ", b = a["if"].call(d, d && d.mobile, { name: "if", hash: {}, fn: this.program(10, e), inverse: this.noop, data: e }), (b || 0 === b) && (g += b), g += '\n    <div class="download-widget-title">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, d && d.downloadTitle, { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += "</div>\n    ", b = a.unless.call(d, d && d.mobile, { name: "unless", hash: {}, fn: this.program(12, e), inverse: this.noop, data: e }), (b || 0 === b) && (g += b), g += "\n    ", b = a["if"].call(d, d && d.mobile, { name: "if", hash: {}, fn: this.program(17, e), inverse: this.noop, data: e }), (b || 0 === b) && (g += b), g + "\n</div>\n" }, useData: !0 }) }({}); u = function (h) { var d = h.UiCore.UiContext; return d.extend("Download", { className: "download", uiContextName: "download", dependencies: "browserInfo featureAccessManager globalStartupModel globalStringManager googleAnalytics leanplum loginManager modeManager timer urlManager window".split(" "), trackedEvents: function () { return [{ type: "click", selector: ".download-widget-client-button", name: "download_client", handler: "__downloadClient" }, { type: "click", selector: ".download-widget-client-button.windows", name: "download_client_win64_app", handler: "__downloadClient" }, { type: "click", selector: ".download-widget-client-button.mac", name: "download_client_darwin_app", handler: "__downloadClient" }, { type: "click", selector: ".update-widget-client-button", name: "download_client", handler: "__updateClient" }] }, initialize: function (a) { d.prototype.initialize.call(this, a); this.__isExperiment = IMVU.optionalProperty(a, "isExperiment", !1); this.__autoDownload = IMVU.optionalProperty(a, "autoDownload", !1); this.__isUpdate = IMVU.optionalProperty(a, "isUpdate", !1); this.__clientUrl = a.clientUrl; this.__featureAccessManager.isElectronClient() && (this.__autoUpdate = a.window.autoUpdate, this.listenTo(this.__autoUpdate, "update-downloaded", this.__updateDownloadCTA)); "client" == a.type ? (this.__type = this.__browserInfo.getOS(), this.__downloadTitle = this.__isExperiment && "windows" !== this.__type ? "beta" : "windows" === this.__type && this.__isExperiment ? "empty" : this.__type) : this.__downloadTitle = this.__type = a.type; this.addToDOM() }, render: function () { var a = "", c = "", e = ""; "mac" == this.__type ? (a = this.__globalStringManager.get("download_widget_mac_reqs_1") + "<br>" + this.__globalStringManager.get("download_widget_mac_reqs_2") + "<br>", e = this.__globalStringManager.get("download_widget_mac_small_print"), this.__clientUrl = this.__globalStartupModel.get("macClientUrl")) : "windows" == this.__type || "unknown" == this.__type ? (a = this.__globalStringManager.get("download_widget_windows_reqs_1"), this.__clientUrl = this.__globalStartupModel.get("windowsClientUrl")) : "beta" == this.__type && ("mac" === this.__browserInfo.getOS() ? (a = this.__globalStringManager.get("download_widget_mac_beta_reqs_1"), this.__clientUrl = this.__globalStartupModel.get("macClientBetaUrl"), c = "mac") : (a = this.__globalStringManager.get("download_widget_windows_beta_reqs_1"), this.__clientUrl = this.__globalStartupModel.get("windowsClientBetaUrl"), c = "windows")); this.__isExperiment && (a = "windows" == this.__type || "unknown" == this.__type ? this.__globalStringManager.get("download_widget_windows_reqs_1") : this.__globalStringManager.get("download_widget_mac_beta_reqs_1"), this.__clientUrl = this.__serviceProvider.get("baseRoot") + "client_download/" + this.__type, c = this.__type, e = ""); this.$el.html(h.template({ downloadTitle: "download_widget_title_" + this.__downloadTitle, type: this.__type, mac: "mac" == this.__type, windows: "windows" == this.__type, mobile: "mobile" == this.__type, beta: "beta" == this.__type, bodyText: a, learnMoreUrl: this.__urlManager.get("coming_soon_for_imvu_desktop_mac"), clientUrl: this.__clientUrl, platform: c, iconMac: "mac" == c, isExperiment: this.__isExperiment, autoDownload: this.__autoDownload, smallPrint: e, isUpdate: this.__isUpdate })); this.__isExperiment && this.__clientUrl && this.__autoDownload && this.__timer.setTimeout(function () { this.__window.location = this.__clientUrl }.bind(this), 1e3) }, __downloadClient: function (a) { this.__googleAnalytics.recordClick("download_widget", "client"); this.trigger("downloadClientClicked") }, __updateDownloadCTA: function () { this.$(".update-widget-client-button").removeClass("pending"); this.$(".update-widget-client-button").text(this.__globalStringManager.get("update_widget_update_text")) }, __updateClient: function (a) { a.preventDefault(); this.$(".update-widget-client-button").hasClass("pending") || (this.$(".update-widget-client-button").text(this.__globalStringManager.get("update_widget_updating_text")), this.__autoUpdate.quitAndInstall()) } }) }({ UiCore: n["@UiCore"], template: u }); K = function (h) { var d = h.Submode; return d.extend("FtuxDownloadSubmode", { uiContextName: "ftux_download_submode", className: "submode submode-ftux-download ftux-layout", dependencies: "browserInfo counterHelper featureAccessManager ftuxState globalNav globalStringManager googleAnalytics leanplum loginManager startupModel uiEventReporter webGL window".split(" "), trackedEvents: function () { return [{ type: "click", selector: ".download-web-link", name: "weblink_click", handler: "__weblinkClick" }, { type: "click", selector: ".id-goto-next-link", name: "goto_next_from_welcome", handler: "__goToNext" }] }, hide: function () { d.prototype.hide.call(this); this.__globalNav.clearText() }, initialize: function (a) { d.prototype.initialize.call(this, a); this.__googleAnalytics.recordSubModeChange("welcome-download"); this.addToDOM(); this.__recordEvent("wasreallyshown", { record: !0 }); $(this.__window).on("beforeunload", function () { this.__serviceProvider.get("uiEventReporter").flush() }.bind(this)); this.__loginManager = a.loginManager; this.__myself = this.__loginManager.getCurrentUser() }, render: function () { this.$el.html(h.template({ isExperiment: !0 })); this.__downloadClient = this.createChildContext(h.Download, { $parentElement: this.$(".download-client-container"), type: "client", isExperiment: !0, autoDownload: !1 }); this.listenTo(this.__downloadClient, "downloadClientClicked", this.__downloadClientClicked); this.__downloadMobile = this.createChildContext(h.Download, { $parentElement: this.$(".download-mobile-container"), type: "mobile", isExperiment: !1, autoDownload: !1 }) }, show: function () { d.prototype.show.call(this); this.__globalNav.setText(this.__globalStringManager.get("GET IMVU DESKTOP APP")); this.__myself.populated().then(function () { this.__userName = this.__myself.get("username").replace("Guest_", ""); this.__updateIntro() }.bind(this)); this.__startupModel.populated().then(function (a) { return a.getSingleEdge("dress_up_ftux").populated() }.bind(this)).then(function (a) { var c = a.get(this.__ftuxState.getGender() + "_reg"); this.__clothingProductUrl = a.get("dress_up_reg"); var e = function () { this.setLoading(!1); this.__show2dAvatar(this.__ftuxState.getGender(), c) }.bind(this); this.__webGL.use3d() && (this.__ftuxModel = a, this.__show3DScene(this.__ftuxState.getGender())); e(); return this.__serviceProvider.get("rest").get(c) }.bind(this)).catch(function (a) { this.__window.console.error(a) }.bind(this)); this.__counterHelper.increment("welcome_ftux_bridge") }, delete: function () { $(this.__window).off("beforeunload") }, __updateIntro: function () { $(".download-intro .username").text("@" + this.__userName) }, __show3DScene: function (a) { var c = this.__ftuxState.getAssetUrl(); c || (c = this.__ftuxModel.get(a + "_asset_url")); (c = this.__ftuxState.getGenderState().lookUrl) || (c = this.__ftuxModel.get(a + "_reg")); (c = this.__ftuxState.getGenderState().avatarImage) || (c = this.__ftuxModel.get(a + "_image")); this.__parentMode.show3dScene({ $parentElement: this.$(".avatar-container"), parentContext: this, genders: [a] }).then(function (e) { return e.loadedEverything().then(function () { this.$(".ftux-module").css("right", "-75%"); $(this.__window).resize(); h.rafUtil(610, e.noJQResizeToContainer.bind(e), function () { e.noJQResizeToContainer(); this.$(".download-container").css("opacity", 1); $(this.__window).resize() }.bind(this)) }.bind(this)) }.bind(this)).then(this.__on3dLoaded.bind(this)).catch(function (e) { this.__window.console.error(e) }.bind(this)) }, __on3dLoaded: function () { this.setLoading(!1); this.__mediaLoaded() }, __show2dAvatar: function (a) { this.__parentMode.show2dAvatar({ gender: a, $parentElement: this.$(".avatar-container-2d"), parentContext: this, keepLookModel: !0 }).then(function (c) { this.__2dAvatar = window._avatar = c; this.__mediaLoaded(); "rtl" === document.querySelector("html").getAttribute("dir") ? this.$(".avatar-container-2d").css("right", "35%") : this.$(".avatar-container-2d").css("left", "35%"); this.$(".download-container").css("opacity", 1) }.bind(this)).catch(function (c) { this.__window.console.error(c) }.bind(this)) }, __mediaLoaded: function () { this.__loadedMedias++; 0 < this.__totalMedias && this.__loadedMedias === this.__totalMedias && this.__onFinishedLoading() }, __onFinishedLoading: function () { var a = this.uiContextName + "_" + (this.__webGL.use3d() ? "3d" : "2d") + "_load_time", c = (this.__timer.getTime() - this.__initTime) / 1e3; this.__recordEvent(a, { time: c, record: !0 }); this.__uiEventReporter.flush() }, setLoading: function (a) { this.$(".ftux-body").toggleClass("loading", a) }, __goToNext: function () { this.__window.location = "/next/home/explore" }, __weblinkClick: function () { this.__leanplum.recordEvent("welcome_ftux_download_weblink_clink") }, __downloadClientClicked: function () { this.__showDownloadReminder(); this.__showSurveyPopup() }, __showDownloadReminder: function () { "Chrome" === this.__browserInfo.getBrowserName() && void 0 === this.__downloadReminder && (this.__downloadReminder = this.createChildContext(h.DownloadReminder, { $parentElement: this.$(".download-reminder-container"), loginManager: this.__loginManager })) }, __showSurveyPopup: function () { void 0 !== this.__surveyPopup || "windows" !== this.__browserInfo.getOS() || "1" !== this.__serviceProvider.get("showSurveyPopup") || this.__serviceProvider.get("isWin5050ExperimentClosed") || (this.__surveyPopup = this.createChildContext(h.SurveyPopup, { $parentElement: this.$(".survey-popup-container") })) }, _testTriggerDownload: function () { this.__downloadClient.trigger("downloadClientClicked") } }) }({ UiCore: n["@UiCore"], Download: u, DownloadReminder: y, rafUtil: C, Submode: p, SurveyPopup: x, template: K }); x = function (h) { var d = IMVU.NamedModel, a = {}; return d.extend("LookModelManager", _.extend({ dependencies: "featureAccessManager fetchResponseHandler lookModelId modelCache Promise rest window".split(" "), initialize: function (c) { this.__serviceProvider = c.serviceProvider; _.each(this.dependencies, function (e) { this["__" + e] = c[e] }.bind(this)); a[this.__lookModelId] = this; d.prototype.initialize.call(this, { pending_adds: [], pending_removes: [] }); this.__changeNum = 0; this.__changeToPendingSet = {}; this.__changeToPendingSet[this.__changeNum] = { pending_adds: [], pending_removes: [] }; this.__lastShownRequest = this.__requestCount = 0; this.__initialRequestSent = this.__populated = !1; this.__outstandingRequests = 0 }, resetLookModelId: function (c) { a[c] = this; delete a[this.__lookModelId]; this.__lookModelId = c }, isSyncing: function () { return 0 < this.__outstandingRequests }, fetch: function (c) { c = c || {}; var e = c.add || [], b = c.remove || []; c = c.baseProductList || []; e = _(this.get("pending_adds")).concat(e); var f = _(this.get("pending_removes")).concat(b); _.each([e, f, c], function (k) { _.each(k, function (m, l) { _.isString(k[l]) && (k[l] = parseInt(k[l].replace(/^(.*\/product[\-\/])*(\d+)$/, "$2"), 10)) }.bind(this)) }.bind(this)); e = _.uniq(e); f = _.uniq(f); var g = _.intersection(e, f); b = _(e).difference(g); e = _(f).difference(g); c = this.__buildLookModelUrl(this.__lookModelId, b, e, c); f = ++this.__changeNum; this.__changeToPendingSet[f] = { pending_adds: b, pending_removes: e, url: c }; this.set({ pending_adds: b, pending_removes: e }); return this.__fetch(c) }, __buildLookModelUrl: function (c, e, b, f) { var g = {}; 0 < e.length && (g.add = e.join(",")); 0 < b.length && (g.remove = b.join(",")); 0 < f.length && (g.base_product_list = f.join(",")); return IMVU.URI.build(c, g, { prune: !0 }) }, __fetch: function (c) { this.__modelCache.invalidate(c); var e = ++this.__requestCount; this.__outstandingRequests++; this.trigger("syncing", this.isSyncing()); return this.__rest.get(c).then(function (b) { this.__outstandingRequests--; this.trigger("syncing", this.isSyncing()); b = b.response.data; e > this.__lastShownRequest && (this.__lastShownRequest = e, this.__fetchResponseHandler(b), this.__modelCache.invalidate(c), e === this.__requestCount && this.set({ pending_adds: [], pending_removes: [] })); return this.__Promise.resolve() }.bind(this)).catch(function (b) { this.__window.console.log(b); this.__outstandingRequests--; this.trigger("syncing", this.isSyncing()); return this.__Promise.reject(b) }.bind(this)) }, post: function (c) { this.set({ pending_adds: [], pending_removes: [] }); var e = ++this.__requestCount; this.__outstandingRequests++; this.trigger("syncing", this.isSyncing()); this.__featureAccessManager.failLookModelPost() && (c = { look_url: "justfail" }); return this.__rest.post(this.__lookModelId, c).then(function (b) { this.__outstandingRequests--; this.trigger("syncing", this.isSyncing()); b = b.response.data; e > this.__lastShownRequest && (this.__lastShownRequest = e, this.__fetchResponseHandler(b)) }.bind(this)).catch(function (b) { this.__window.console.log(b); this.__outstandingRequests--; this.trigger("syncing", this.isSyncing()); return this.__Promise.reject(b) }.bind(this)) } }, Backbone.events), { getManager: function (c) { return a[c] } }) }({ Model: n["@Model"], UiCore: n["@UiCore"] }); x = function (h) { var d = IMVU.NamedModel; return d.extend("LookModel", { dependencies: ["globalStartupModel", "Promise", "typeId"], initialize: function (a) { this.__serviceProvider = a.serviceProvider; _.each(this.dependencies, function (c) { this["__" + c] = a[c] }.bind(this)); this.__Promise = a.Promise; this.__globalStartupModel = a.globalStartupModel; this.__typeId = this.parseTypeId(a.typeId); this.__populatedResolver = null; this.__populatedPromise = new this.__Promise(function (c) { this.__populatedResolver = c }.bind(this)); this.__lookModelBase = this.__globalStartupModel.get("lookModelUrl"); this.id = this.__globalStartupModel.get("starterAvatars." + this.__typeId); if (_.isNull(this.id) || _.isUndefined(this.id)) this.id = this.__lookModelBase + "/look_model-" + this.__typeId; d.prototype.initialize.call(this, { url: this.id }); this.__managerClass = IMVU.optionalProperty(a, "managerClass", h.LookModelManager); this.__manager = this.__serviceProvider.create(this.__managerClass, { lookModelId: this.id, fetchResponseHandler: this.__fetchResponseHandler.bind(this) }); this.fetch() }, parseTypeId: function (a) { return a.split(/\//).pop() }, setLookModelId: function (a) { this.__typeId = this.parseTypeId(a); this.id = this.__globalStartupModel.get("starterAvatars." + this.__typeId); if (_.isNull(this.id) || _.isUndefined(this.id)) this.id = this.__lookModelBase + "/look_model-" + this.__typeId; this.set({ url: this.id }); this.__manager.resetLookModelId(this.id) }, setChatTypeId: function (a, c) { a = a.id.split("/").pop(); c = c.id.split("/").pop(); this.setLookModelId(a + ":participants:" + c) }, populated: function () { return this.__populatedPromise }, isSyncing: function () { return this.__manager.isSyncing() }, getProducts: function () { return this.get("products") }, getGender: function () { var a = this.get("body_pattern_ids"); return null === a || void 0 === a ? null : _.contains(a, 80) ? "female" : _.contains(a, 191) ? "male" : null }, getLookUrl: function () { return decodeURIComponent(this.get("look_url")) }, getLookPids: function (a) { return a ? _.map(decodeURIComponent(a.split("/").pop()).split(","), function (c) { return parseInt(c, 10) }.bind(this)) : _.pluck(this.get("products"), "product_id") }, getTypeId: function () { return this.__typeId }, __fetchResponseHandler: function (a) { var c = ["look_url", "asset_url", "avatar_image"]; this.__lastResponse = a = _.mapObject(a, function (e, b) { return _.isNull(e) || _.isUndefined(e) || !_.contains(c, b) ? e : decodeURIComponent(e) }.bind(this)); this.set(a) }, getChangePromise: function () { return this.__changePromise }, fetch: function (a) { this.__changeResolver = null; this.__changePromise = new this.__Promise(function (c) { this.__changeResolver = c }.bind(this)); return this.__manager.fetch(a).then(function () { "accepted" !== this.__populatedPromise.state && this.__populatedResolver.resolve(); this.__changeResolver.resolve(this.__lastResponse); this.trigger("change"); return this.__Promise.accept() }.bind(this)).catch(function (c) { "accepted" !== this.__populatedPromise.state && "rejected" !== this.__populatedPromise.state && this.__populatedResolver.reject(c); this.__changeResolver.reject(c); this.trigger("change"); return this.__Promise.reject(c) }.bind(this)) }, save: function (a) { return this.__manager.post(a).then(function () { this.trigger("change"); return this.__Promise.accept() }.bind(this)).catch(function (c) { window.console.log(c); return this.fetch().then(function () { return this.__Promise.reject(c) }.bind(this)).catch(function (e) { return this.__Promise.reject({ message: "LookModel failed to refetch after POST failure", originalError: c, newError: e }) }.bind(this)) }.bind(this)) } }) }({ UiCore: n["@UiCore"], LookModelManager: x }); y = function (h) { return IMVU.BaseClass.extend("FtuxState", _.extend({ dependencies: ["localStorage"], initialize: function (d) { d = void 0 === d ? {} : d; this.__localStorage = d.localStorage; this.getState() }, saveState: function (d) { this.__localStorage.setItem("ftux-state", JSON.stringify(d)) }, getDefaultState: function () { return { gender: "female", male: { equippedItems: [], products: [], avatarImage: null, lookUrl: null, assetUrl: null }, female: { equippedItems: [], products: [], avatarImage: null, lookUrl: null, assetUrl: null } } }, getStateString: function () { return JSON.stringify(this.getState(), null, 2) }, getState: function () { var d = this.__localStorage.getItem("ftux-state"); d ? d = JSON.parse(d) : (d = this.getDefaultState(), this.saveState(d)); return d }, getGender: function () { return this.getState().gender }, getGenderState: function () { var d = this.getState(); return d[d.gender] }, clearAssets: function () { this.saveState(this.getDefaultState()) }, updateFromLookModel: function (d) { var a = _.extend(this.getState(), {}), c = a[this.getGender()]; c.avatarImage = d.get("avatar_image"); c.lookUrl = d.get("look_url"); c.products = d.get("products"); this.saveState(a) }, setGender: function (d) { d = _.extend(this.getState(), { gender: d }); this.saveState(d); this.trigger("setGender") }, isNothingEquipped: function () { return 0 === this.getEquippedItems().length }, createEquippedItemIds: function (d) { if (d) { var a = _.extend(this.getState(), {}); a[this.getGender()].equippedItems = _.pluck(d, "product_id").map(Number); this.saveState(a) } }, getEquippedItems: function () { return this.getGenderState().equippedItems }, getAssetUrl: function () { return this.getGenderState().assetUrl }, setAssetUrl: function (d) { var a = _.extend(this.getState(), {}); a[this.getGender()].assetUrl = d; this.saveState(a) } }, Backbone.Events)) }({}); C = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ 1: function () { return '\n<nav class="mode-nav bar magic-line-menu disable-text-selection">\n    <div class="center-nav-container">\n        <ul class="center-nav"></ul>\n        <div class="magic-line"></div>\n    </div>\n    <div class="simple-scroller-placeholder"></div>\n    <div class=\'nav-label\'>\n        <span class=\'label\'></span>\n        <div class=\'dismiss\'></div>\n    </div>\n    <ul class="aux-nav"></ul>\n</nav>\n<header></header>\n' }, compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b; c = ""; return b = a["if"].call(d, d && d.canSeeHeaderNav, { name: "if", hash: {}, fn: this.program(1, e), inverse: this.noop, data: e }), (b || 0 === b) && (c += b), c + '\n<div class="submodes"></div>\n' }, useData: !0 }) }({}); u = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ 1: function () { return " disabled" }, 3: function (d, a, c, e) { var b; c = this.escapeExpression; return '<button class="btn btn-primary">' + c((b = a.text || d && d.text, "function" === typeof b ? b.call(d, { name: "text", hash: {}, data: e }) : b)) + "</button>" }, 5: function () { return '<div class="name-widget-goes-here"></div>' }, 7: function (d, a, c, e) { var b, f; c = "<a>"; return f = a.text || d && d.text, b = "function" === typeof f ? f.call(d, { name: "text", hash: {}, data: e }) : f, (b || 0 === b) && (c += b), c + "</a>" }, 9: function (d, a, c, e) { var b, f; c = a.helperMissing; return f = a.icon || d && d.icon || c, b = f.call(d, d && d.svgIcon, { name: "icon", hash: {}, data: e }), b || 0 === b ? b : "" }, 11: function () { return '<span class="icon"></span>' }, compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = this.escapeExpression; c = '<li data-nav="' + c((f = a.name || d && d.name, "function" === typeof f ? f.call(d, { name: "name", hash: {}, data: e }) : f)); return b = a["if"].call(d, d && d.disabled, { name: "if", hash: {}, fn: this.program(1, e), inverse: this.noop, data: e }), (b || 0 === b) && (c += b), c += '">', b = a["if"].call(d, d && d.is_button, { name: "if", hash: {}, fn: this.program(3, e), inverse: this.noop, data: e }), (b || 0 === b) && (c += b), b = a["if"].call(d, d && d.is_name_widget, { name: "if", hash: {}, fn: this.program(5, e), inverse: this.noop, data: e }), (b || 0 === b) && (c += b), b = a["if"].call(d, d && d.is_text, { name: "if", hash: {}, fn: this.program(7, e), inverse: this.noop, data: e }), (b || 0 === b) && (c += b), b = a["if"].call(d, d && d.is_svg_icon, { name: "if", hash: {}, fn: this.program(9, e), inverse: this.noop, data: e }), (b || 0 === b) && (c += b), b = a["if"].call(d, d && d.is_default, { name: "if", hash: {}, fn: this.program(11, e), inverse: this.noop, data: e }), (b || 0 === b) && (c += b), c + "</li>" }, useData: !0 }) }({}); var r = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '<div class="simple-scroller-viewport"></div>\n<button class="btn btn-tertiary simple-scroller-right flex items-center justify-center" disabled>\n    '; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-page-right", { name: "icon", hash: { class: "wh-15 block" }, data: e }), (b || 0 === b) && (g += b), g += '\n</button>\n<button class="btn btn-tertiary simple-scroller-left flex items-center justify-center" disabled>\n    ', f = a.icon || d && d.icon || c, b = f.call(d, "icon-page-left", { name: "icon", hash: { class: "wh-15 block" }, data: e }), (b || 0 === b) && (g += b), g + "\n</button>" }, useData: !0 }) }({}), F = function (h) { var d = 0, a = h.UiCore.UiContext; return h.UiCore.UiContext.extend("SimpleScroller", { className: "simple-scroller disable-text-selection", uiContextName: "simple_scroller", keepGoingThreshold: 50, dependencies: ["$target", "timer", "window"], initialize: function (c) { a.prototype.initialize.call(this, c); this.__instanceNumber = d++; this.__absoluteScrollBy = c.scrollBy || !1; this.__window = c.window; this.__autoRefresh = !!c.autoRefresh; this.__timer = c.timer; this.__scrollEntireWidth = c.scrollEntireWidth; this.__$target = c.$target; this.__$target.parent(".simple-scroller-viewport").length || (this.template = c.template || h.template, this.addToDOM(), this._refreshScrollabilityCount = 0, this.$(".simple-scroller-viewport").on("scroll.simple-scroller", this.refreshScrollability.bind(this)), this.$(".simple-scroller-left").on("click", this.scrollLeft.bind(this)), this.$(".simple-scroller-right").on("click", this.scrollRight.bind(this)), $(this.__window).on(this.__getEventNamespaceForThisInstance("resize"), this.refreshScrollability.bind(this))) }, __getEventNamespaceForThisInstance: function (c) { return c + ".ss-" + this.__instanceNumber }, delete: function () { $(this.__window).off(this.__getEventNamespaceForThisInstance("resize")); this.$(".simple-scroller-viewport").off(".simple-scroller"); this.__refreshTimer && this.__timer.clearInterval(this.__refreshTimer); a.prototype.delete.call(this) }, render: function () { this.$el.html(this.template); this.$(".simple-scroller-viewport").append(this.__$target); this.__$target.addClass("simple-scroller-target"); this.refreshScrollability(); this.__autoRefresh && (this.__refreshTimer = this.__timer.setInterval(function () { this.$el.is(":visible") && this.refreshScrollability() }.bind(this), 300)) }, viewportWidth: function () { return this.$(".simple-scroller-viewport").outerWidth() }, leftEdge: function () { return this.$(".simple-scroller-viewport").scrollLeft() }, rightEdge: function () { return this.scrollWidth() - this.viewportWidth() - 1 }, scrollWidth: function () { return this.$(".simple-scroller-viewport")[0].scrollWidth }, scrollBy: function () { return this.__absoluteScrollBy || this.viewportWidth() / 2 }, scrollByEntireWidth: function () { return this.__absoluteScrollBy || this.viewportWidth() }, refreshLeftScrollability: function () { this.$(".simple-scroller-left").prop("disabled", 0 >= this.leftEdge()) }, refreshRightScrollability: function () { this.$(".simple-scroller-right").prop("disabled", this.leftEdge() >= this.rightEdge()) }, refreshScrollability: function () { this._refreshScrollabilityCount++; this.refreshLeftScrollability(); this.refreshRightScrollability() }, scroll: function (c) { this.$(".simple-scroller-viewport").animate({ scrollLeft: "+=" + c }, 150, this.refreshScrollability.bind(this)) }, scrollLeft: function (c) { c = this.scrollBy(); this.__scrollEntireWidth && (c = this.scrollByEntireWidth()); this.leftEdge() - c < this.keepGoingThreshold && (c *= 2); this.scroll(-c) }, scrollRight: function (c) { c = this.scrollBy(); this.__scrollEntireWidth && (c = this.scrollByEntireWidth()); this.leftEdge() + c > this.rightEdge() - this.keepGoingThreshold && (c *= 2); this.scroll(c) }, resetPosition: function () { this.$(".simple-scroller-viewport").scrollLeft(0); this.refreshScrollability() } }) }({ UiCore: n["@UiCore"], template: r }); r = function (h) { function d(c, e) { var b = c.get("bootstrapParams").is_app; c.get("window").open(e, b ? "_system" : "_blank") } function a(c) { return -1 !== c.indexOf("iPad") || -1 !== c.indexOf("iPhone") || -1 !== c.indexOf("iPod") } return { openExternal: d, externalizeA: function (c, e) { e = $(e); var b = e.attr("href"); e.attr("href", ""); e.click(function () { d(c, b); return !1 }) }, isAndroid: function (c) { return -1 !== c.get("window").navigator.userAgent.indexOf("Android") }, isAndroidChrome: function (c) { c = c.get("window").navigator.userAgent; return -1 !== c.indexOf("Android") && -1 !== c.indexOf("Chrome/") && -1 === c.indexOf("Version/") }, isAndroidWebApp: function (c) { c = c.get("window"); return -1 !== c.navigator.userAgent.indexOf("Android") && c.navigator.standalone ? !0 : !1 }, isIOS: function (c) { c = c.get("window").navigator.userAgent; return a(c) }, isIOSSafari: function (c) { c = c.get("window").navigator.userAgent; return a(c) && -1 === c.indexOf("CriOS/") ? -1 !== c.indexOf("Safari/") ? !0 : -1 !== c.indexOf("AppleWebKit/") && -1 === c.indexOf("Chrome/") : !1 }, getVersionIOS: function (c) { c = c.get("window").navigator.userAgent; return a(c) ? (c = /(iphone|ipad)(; CPU)? OS ((\d+)_(\d+)(_(\d+))?)/i.exec(c), null === c ? null : { raw: c[3], major: parseInt(c[4], 10), minor: parseInt(c[5], 10), revision: c[7] ? parseInt(c[7], 10) : null }) : null } } }({}); C = function (h) { var d = h.UiCore.UiContext; return d.extend("Mode", { uiContextName: "generic_mode", className: "mode", navId: null, submodes: {}, dependencies: "featureAccessManager globalNav googleAnalytics historyManager id loginManager perfReportManager platform restCacheManager restModelFactory siteRoot stringManager timer window".split(" "), __recordShown: !0, trackedEvents: function () { var a = function (c) { return { which: c.attr("data-nav") } }; return [{ type: "click", selector: ".mode-nav .center-nav > li", name: "mode_nav", handler: "__onClickNavButton", allowBubble: !0, attributes: a }, { type: "click", selector: ".mode-nav .aux-nav > li", name: "aux_nav", handler: "__onClickNavButton", allowBubble: !0, attributes: a }, { type: "click", selector: ".right-column .back-bar .icon", name: "collapse_right_column", handler: function () { this.toggleRightColumn(!0) }.bind(this) }, { type: "click", selector: ".left-column .back-bar .icon", name: "collapse_left_column", handler: function () { this.toggleLeftColumn() }.bind(this) }, { type: "click", selector: ".mode-nav .nav-label .dismiss", name: "dismiss_nav_label", handler: "__dismissNavLabel" }] }, mainNav: function () { return null }, auxNav: function () { return null }, navLabel: function () { return null }, initialize: function (a) { d.prototype.initialize.call(this, a); this.className += " mode"; this.modeId = a.id; this.__serviceProvider = a.serviceProvider; this.__globalNav = a.globalNav; this.__historyManager = a.historyManager; this.__submodeInstances = {}; this.__currentSubmode = this.__submodeDefs = null; this.__window = a.window; this.__navHandlers = {}; this.__currentNavLabelModel = this.__currentAuxNavModel = this.__currentMainNavModel = null; this.__serviceProvider.register("mode", this); this.__stringManager = a.stringManager; this.__platform = a.platform; this.__googleAnalytics = a.googleAnalytics; this.__restModelFactory = a.restModelFactory; this.__submodeIdHistory = [null, null]; this.__canSeeHeaderNav = IMVU.optionalProperty(a, "canSeeHeaderNav", !0); this.__myself = (this.__isLoggedIn = this.__loginManager.isLoggedIn()) ? this.__loginManager.getCurrentUser() : null }, render: function () { this.$el.html(h.template({ canSeeHeaderNav: this.__canSeeHeaderNav })) }, getModeUrl: function () { return this.__siteRoot + this.modeId + "/" }, getSubmodeUrl: function (a) { return this.getModeUrl() + a + "/" }, getTitle: function () { return this.__stringManager.getWithDefault("mode_name", "") }, updateTitle: function () { var a = this.getTitle(); if (this.__currentSubmode) { var c = this.__currentSubmode.getTitle(); void 0 !== c && (a = c) } this.__serviceProvider.get("modeManager").setTitle(a) }, show: function (a) { $("html").removeAttr("data-modifier"); this.$el.parents("body").find(".loading-facade .loading").remove(); a = a || {}; d.prototype.show.call(this, a); this.updateTitle(); a.submode ? this.__submodeInstances[a.submode.id] ? this.__showSubmode(this.__submodeInstances[a.submode.id], a.submode) : this.openSubmode(a.submode) : this.__currentSubmode && (this.refreshNav(), this.__currentSubmode.show(a), a.poppingHistory || this.__historyManager.setState({ fragment: "__default__" === this.__currentSubmodeId ? "" : this.__urlId(this.__currentSubmodeId), mode: { id: this.modeId }, submode: { id: this.__currentSubmodeId, summary: this.__currentSubmode.summarize() } })); this.__serviceProvider.get("globalNav").markActiveMode(this); this.__googleAnalytics.recordModeChange(this.modeId) }, hide: function () { this.__currentSubmode && this.__currentSubmode.hide(); d.prototype.hide.call(this) }, openDefaultView: function (a) { this.openSubmode(_.extend({ id: "__default__" }, a || {})) }, refreshNav: function () { this.$(".mode-nav .magic-line").hide(); this.__globalNav.setVisibility(!0); this.collapseLeftAndRightColumns(); if (this.__currentSubmode) { var a = this.__currentSubmode.overrideMainNav ? this.__currentSubmode.overrideMainNav() : this.mainNav(); this.__setupModeNav(a, this.__currentSubmode.overrideAuxNav ? this.__currentSubmode.overrideAuxNav() : this.auxNav(), this.__currentSubmode.overrideNavLabel ? this.__currentSubmode.overrideNavLabel() : this.navLabel()); this.__globalNav.drillDown(!!this.__currentSubmode.drillDownFrom) } }, markActiveNav: function (a) { ("all" === a || a && -1 !== a.indexOf("user-")) && "inventory" !== this.modeId && (a = "featured"); var c = this.$('.mode-nav li[data-nav="' + a + '"]'); if ("shop" === this.modeId || "inventory" === this.modeId) c = this.$('.mode-nav .product-navigation-main li[data-nav="' + a + '"]'); c.length && ("shop" === this.modeId || "inventory" == this.modeId ? (this.$(".mode-nav .product-navigation-main li.active").removeClass("active"), c.parents("li.has-children").length ? (c.parents("li.has-children").addClass("active"), this.$(".mode-nav .magic-line").show().css({ "margin-left": c.parents("li.has-children.nav-level-1").position().left + "px", width: c.parents("li.has-children.nav-level-1").outerWidth() }), c.parents("li.has-children.nav-level-1")[0].scrollIntoView(!1)) : (c.addClass("active"), this.$(".mode-nav .magic-line").show().css({ "margin-left": c.position().left + "px", width: c.outerWidth() }), c[0].scrollIntoView(!1))) : (this.$(".mode-nav li.active").removeClass("active"), c.addClass("active"), this.$(".mode-nav .magic-line").show().css({ "margin-left": c.find("a").position().left + "px", width: c.find("a").outerWidth() }), c[0].scrollIntoView(!1))) }, refreshMagicLine: function () { var a = this.$(".mode-nav li.active"); a.length && this.$(".mode-nav .magic-line").show().css({ "margin-left": a.find("a").position().left + "px", width: a.find("a").outerWidth() }) }, markActiveAuxNav: function (a) { h.NextUtil.DomHelper.radioClass(this.$('.aux-nav li[data-nav="' + a + '"]'), "active") }, getCurrentSubmode: function () { return this.__currentSubmode }, getPreviousSubmodeId: function () { if (this.__currentSubmode) { var a = this.__currentSubmode.id; for ("true" === localStorage.getItem("forceProduction") && (a = a.replace("localhost.", "")); this.__submodeIdHistory && 0 < this.__submodeIdHistory.length && a === this.__submodeIdHistory[0];)this.__submodeIdHistory.shift() } return this.__submodeIdHistory[0] }, openSubmode: function (a) { var c = this.__perfReportManager.getTime(); this.__restCacheManager.saveFromModelCache(); this.__restCacheManager.resetAutoSaveTimer(); this.__serviceProvider.get("modeManager").dismissAllDismissibles(); a = a || { id: "__default__" }; var e = a.id || "__default__"; a.perfStartTime = c; this.__submodeDefs = this.submodes(e); "true" === localStorage.getItem("forceProduction") && (e = e.replace("localhost.", "")); this.__submodeIdHistory[1] !== e && (this.__submodeIdHistory.shift(), this.__submodeIdHistory.push(e)); c = this.__submodeInstances[e]; if (!c || c.isDeleted()) { if (c = this.__submodeDefs[e]) { var b = "function" === typeof c[1] ? c[1](e) : c[1]; c = this.createChildContext(c[0], _.extend({ $parentElement: this.$(".submodes") }, b, a)) } else if (this.__submodeDefs.__id__ && -1 !== e.indexOf("/")) c = this.__submodeDefs.__id__, b = "function" === typeof c[1] ? c[1](e) : c[1], c = this.createChildContext(c[0], _.extend({ $parentElement: this.$(".submodes"), model: this.__restModelFactory.readModel(e, c[0].CustomModelClass || h.UiCore.NodeModel) }, b, a)); else if ("av" == this.modeId && this.__submodeDefs.__id__ && -1 == e.indexOf("-")) { c = this.__submodeDefs.__id__; b = "function" === typeof c[1] ? c[1](e) : c[1]; var f = this.__restModelFactory.searchCollection("https://api.imvu.com/user", { username: e }, h.UiCore.NodeCollection); c = this.createChildContext(c[0], _.extend({ $parentElement: this.$(".submodes"), userCollection: f, model: null }, b, a)) } else if ("vcoin" == this.modeId && this.__submodeDefs.__id__ && -1 !== e.indexOf("withdraw_ticket-")) c = this.__submodeDefs.__id__, b = "function" === typeof c[1] ? c[1](e) : c[1], f = e.split("-")[1], c = this.createChildContext(c[0], _.extend({ $parentElement: this.$(".submodes"), ticketId: f }, b, a)); else return this.__window.console.log("ERROR: Tried to open unknown submode, " + e + "."), this.__submodeDefs.__default__ ? this.openSubmode() : this.openDefaultView(); this.__submodeInstances[e] = c } return this.__currentSubmode === c ? (a.showAlways && this.__currentSubmode.show(a), c) : this.__showSubmode(c, a) }, getCurrentSubmodeId: function () { return "featured" === this.__submodeIdHistory[0] ? "featured" : this.__currentSubmodeId }, isCurrentSubmode: function (a) { return this.__currentSubmode === this.__submodeInstances[a] && this.__currentSubmode }, __showSubmode: function (a, c) { this.__currentSubmode && (this.__currentSubmode.hide(), this.__currentSubmode.stopListening(this.__currentSubmode, "change:title")); this.__currentSubmode = a; this.__currentSubmodeId = c.id; this.listenTo(this.__currentSubmode, "change:title", this.updateTitle.bind(this)); this.__canSeeHeaderNav && this.refreshNav(); this.setLayout(a.layout); this.__currentSubmode.show(c); c.poppingHistory || this.__historyManager.setState({ fragment: "__default__" === this.__currentSubmodeId ? "" : this.__urlId(this.__currentSubmodeId), mode: { id: this.modeId }, submode: { id: this.__currentSubmodeId, summary: a.summarize() } }); this.__globalNav.revealSubmodeSpecificItems(); return this.__currentSubmode }, setLayout: function (a) { this.$el.attr("data-layout", a) }, __buildNav: function (a, c) { c.parent(".center-nav-container").removeClass("has-subnav-with-title"); c.empty(); a.get("buttons") ? _.each(a.get("buttons"), function (e, b) { var f = "button" === e.type; b = !1 === f && "undefined" !== typeof e.nameNode; var g = !1 === f && !1 === b && "string" === typeof e.text && "" !== e.text, k = !1 === f && !1 === b && !1 === g && "undefined" !== typeof e.svgIcon; f = _.extend({ is_button: f, is_name_widget: b, is_text: g, is_svg_icon: k, is_default: !1 === f && !1 === b && !1 === g && !1 === k }, e); c.append(h.templateModeNavItem(f)); b && (this.__displayName = this.createChildContext(h.Widgets.DisplayName, { $replaceElement: this.$(".name-widget-goes-here"), user: e.nameNode, size: "small", color: "dark", showVipBadge: !1 })); this.__navHandlers[e.name] = { cb: e.handler, arg: e.args } }.bind(this)) : a.get("text") && (c.parent(".center-nav-container").addClass("has-subnav-with-title"), c.append('<li class="center-nav-text">' + a.get("text") + "</li>")) }, __updateNavLabel: function (a, c) { c.html(a.get("label") || ""); this.$el.toggleClass("has-nav-label", !!a.get("label")) }, __setupModeNavMain: function (a, c) { var e = a.main; a = a.hasSubMenu; if (e) { var b = this.$(".mode-nav ul.center-nav"); if (void 0 !== e.get("buttons") || a) { for (a = this.$(".simple-scroller-placeholder"); 1 < a.length;)a[1].remove(), a = this.$(".simple-scroller-placeholder"); e && void 0 !== e.get("buttons") && (this.modeNavSimpleScroller = this.createChildContext(h.SimpleScroller, _.extend({ $replaceElement: this.$(".simple-scroller-placeholder"), $target: this.$(".mode-nav .center-nav-container") }))) } this.__buildNav(e, b); this.__currentMainNavModel = e; this.__currentMainNavModel.on("change", function () { this.__buildNav(this.__currentMainNavModel, b) }, this); c && c.accept() } }, __setupModeNav: function (a, c, e, b) { var f = this, g = "shop" === this.modeId || "inventory" === this.modeId; null !== this.__currentMainNavModel && this.__currentMainNavModel.off(void 0, void 0, this); null !== this.__currentAuxNavModel && this.__currentAuxNavModel.off(void 0, void 0, this); null !== this.__currentNavLabelModel && this.__currentNavLabelModel.off(void 0, void 0, this); var k = this.$(".mode-nav ul.aux-nav"), m = this.$(".mode-nav .nav-label .label"); this.$el.parent().removeClass("no-subnav"); this.__navHandlers = {}; a && "function" === typeof a.then ? a.then(function (l) { f.__setupModeNavMain({ main: l, hasSubMenu: g }, b) }) : this.__setupModeNavMain({ main: a, hasSubMenu: g }); c && (this.__buildNav(c, k), this.__currentAuxNavModel = c, this.__currentAuxNavModel.on("change", function () { this.__buildNav(this.__currentAuxNavModel, k) }, this)); e && (this.__updateNavLabel(e, m), this.__currentNavLabelModel = e, this.__currentNavLabelModel.on("change", function () { this.__updateNavLabel(e, m) }, this)); c || a ? this.$(".mode-nav").show() : (this.$(".mode-nav").hide(), this.$el.parent().addClass("no-subnav")) }, __onClickNavButton: function (a) { var c = $(a.currentTarget).data("nav"), e = this.__navHandlers[c]; e && e.cb(c, e.args, a) }, collapseLeftAndRightColumns: function () { this.$el.removeClass("expand-left-column"); this.$el.removeClass("expand-right-column") }, isLeftColumnExpanded: function () { return this.$el.hasClass("expand-left-column") }, isRightColumnExpanded: function () { return this.$el.hasClass("expand-right-column") }, toggleLeftColumn: function () { "mobile" === this.__platform && (this.$el.toggleClass("expand-left-column"), this.__globalNav.setVisibility(!this.isLeftColumnExpanded())) }, toggleRightColumn: function () { "mobile" === this.__platform && (this.$el.toggleClass("expand-right-column"), this.__globalNav.setVisibility(!this.isRightColumnExpanded())) }, __leftColumnToggleButton: function () { return { name: "toggle_left_column", svgIcon: "icon-filter", handler: this.toggleLeftColumn.bind(this) } }, __dismissNavLabel: function () { this.__currentNavLabelModel.set({ label: "" }); this.__currentNavLabelModel.trigger("dismissed") } }) }({ NextUtil: n["@NextUtil"], UiCore: n["@UiCore"], Widgets: n["@Widgets"], MobileBrowser: r, SimpleScroller: F, template: C, templateModeNavItem: u }); u = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '<div class="copy-body">\n    '; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_adult_dialog_body_1", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '\n    <a href="https://secure.imvu.com/next/policyhub/gdprconsent/" class="tooltip-target">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_adult_dialog_body_2", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += "</a>\n    ", f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_adult_dialog_body_3", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '\n    <a href="https://secure.imvu.com/next/policyhub/privacypolicy/" target="_blank">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_adult_dialog_body_4", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += "</a>\n    ", f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_adult_dialog_body_5", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += "\n    <br>\n    ", f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_adult_dialog_body_6", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '\n\n    <div class="accept-button">\n        <button class="btn btn-primary accept-cookies">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "accept all cookies", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g + '</button>\n    </div> \n</div>\n\n\n<div class="tooltip-content cookie-tooltip">\n    <div class="tooltip-body">\n        To give you the best possible experience, personalize content and ads, this site uses Cookies. Continuing to use the site you agree we may place these cookies on your device. You can view our Privacy Policy for more details.\n\n        <div class="tooltip-header">Strictly Necessary Cookies:</div>\n            <div>These cookies are necessary for the website to function and cannot be switched off in our systems. </div>\n            <ul>\n                <li>prefer_alloy - Used to determine if you see IMVU Next or Core.</li>\n                <li>alloy_landing_cookie - Used to determine if you see IMVU Next or Core.</li>\n                <li>in_ux - Assigned to a "unique user" experiment.</li>\n                <li>osCsid - Session cookie; required for login to function.</li>\n            </ul>\n        <div class="tooltip-header">Performance Cookies:</div>\n            <div>These cookies allow us to count visits and traffic sources, so we can measure and improve the performance of our site. They help us know which pages are the most and least popular and see how visitors move around the site.</div>\n            <ul>\n                <li>browser_session - Tracks statistics about your IMVU session.</li>\n                <li>window_session - Tracks statistics about a specific IMVU window.</li>\n                <li>Targeting Cookies</li>\n                <li>These cookies are set through our site by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant ads on other sites. They work by uniquely identifying your browser and device.</li>\n                <li>login_interstitial_seen - tracks the last time you saw an interstitial, for aggregate analytics purposes.</li>\n                <li>sncd - Tracks CIDs you have logged into, for detecting if a new account is an alt.</li>\n                <li>nunu - Tracks if we believe you are a new new user.</li>\n                <li>preLogID - Used to connect incoming users with their subsequent login or registration.</li>\n                <li>imvua - Tracks which acquisition partner you came from.</li>\n                <li>datetime_entered - Tracks when you first landed on our site.</li>\n                <li>linkshare_site_id - If acquired through a specific partner, tracks which ad you followed.</li>\n                <li>lpip - Stores the IP you hit a landing page with.</li>\n            </ul>\n        <div class="tooltip-header">Presentation Cookies:</div>\n            <div>These cookies are set to help enhance your experience and for example, allow us to show you IMVU in the language of your choice.</div>\n            <ul>\n                <li>imvu_avnm - stores your avatarname for display purposes.</li>\n                <li>saved_locale - stores which language you prefer to see IMVU in.</li>\n            </ul>\n        <div class="tooltip-header">Third Party Partners:</div>\n            <div>We also have third party partners who may set cookies including this list below:</div>\n            <ul>\n                <li>Amazon</li>\n                <li>Doubleverify</li>\n                <li>Facebook</li>\n                <li>Google</li>\n                <li>Peanutlabs</li>\n                <li>Revenue Universe</li>\n                <li>AppNexus</li>\n                <li>Google Analytics</li>\n                <li>Threat Metrix</li>\n            </ul>\n    </div>\n</div>' }, useData: !0 }) }({}); r = function (h) { var d = h.Dialogs.AlloyModalDialog; return d.extend("TooltipDialog", { uiContextName: "tooltip_dialog", className: "tooltip-dialog dialog-type-B text-close", trackedEvents: function () { return this.__customTrackedEvents }, initialize: function (a) { this.__customTrackedEvents = a.trackedEvents || []; d.prototype.initialize.call(this, a); this.title = a.title; this.__tooltipContent = a.tooltipContent; this.addToDOM() }, postRender: function () { this.setContent("body", this.__tooltipContent) } }) }({ Dialogs: n["@Dialogs"] }); r = function (h) { var d = h.UiCore.UiContext; return d.extend("Tooltip", { className: "tooltip", uiContextName: "tooltip", dependencies: ["dialogManager", "timer", "tooltipLayer", "window"], trackedEvents: function () { return [{ type: "click", selector: "a", name: "link_click", handler: "__clickedLink", allowBubble: !0 }].concat(this.__customTrackedEvents) }, __installTooltipLayerEventHandlers: function () { this.__tooltipLayer.$el.on("mouseenter.tooltip", ".tooltip", function () { this.__timer.clearTimeout(this.__targetTimeout); this.__timer.clearTimeout(this.__tooltipTimeout); this.$target.off("mouseleave.tooltip") }.bind(this)); this.__tooltipLayer.$el.on("mouseleave.tooltip", ".tooltip", function () { this.__timer.clearTimeout(this.__tooltipTimeout); this.__tooltipTimeout = this.__timer.setTimeout(function () { this.setVisible(!1); this.__timer.clearTimeout(this.__tooltipTimeout); this.__tooltipTimeout = this.__timer.setTimeout(function () { this.__hide(); this.__installTargetMouseleave() }.bind(this), 125) }.bind(this), 250) }.bind(this)) }, __removeTooltipLayerEventHandlers: function () { this.__tooltipLayer.$el.off(".tooltip") }, initialize: function (a) { this.$tooltip = IMVU.requireProperty(a, "$replaceElement"); this.$target = IMVU.requireProperty(a, "$tooltipTarget"); this.tooltipTitle = IMVU.optionalProperty(a, "title", !1); this.__tooltipStyle = IMVU.optionalProperty(a, "tooltipStyle", "default"); this.__tooltipPosition = IMVU.optionalProperty(a, "tooltipPosition", "default"); this.__positionDelta = IMVU.optionalProperty(a, "positionDelta", 0); this.__customTrackedEvents = a.trackedEvents || []; d.prototype.initialize.call(this, a); this.$body = $("body"); this.$globalNav = $("nav.global-nav:visible"); if ("mobile" === this.__serviceProvider.get("platform")) this.$target.on("click.tooltip", function (c) { c.stopPropagation(); this.__openTooltipDialog() }.bind(this)); else this.$target.on("mouseenter.tooltip", function () { this.__timer.clearTimeout(this.__targetTimeout); this.__timer.clearTimeout(this.__tooltipTimeout); this.__timer.clearTimeout(this.__targetFadeinTimeout); this.__installTargetMouseleave(); this.__targetFadeinTimeout = this.__timer.setTimeout(function () { this.setVisible(!0); this.__show() }.bind(this), 250) }.bind(this)); "snug" === this.__tooltipStyle && this.$el.addClass("tooltip-snug"); this.$el.append(this.$tooltip); this.setParentUiContext(this.__tooltipLayer); this.__tooltipLayer.$el.append(this.$el) }, setVisible: function (a) { this.$el.toggleClass("tooltip-open", !!a) }, __installTargetMouseleave: function () { this.$target.on("mouseleave.tooltip", function () { this.__timer.clearTimeout(this.__targetTimeout); this.__targetTimeout = this.__timer.setTimeout(function () { this.setVisible(!1); this.__timer.clearTimeout(this.__targetTimeout); this.__targetTimeout = this.__timer.setTimeout(function () { this.__hide() }.bind(this), 125) }.bind(this), 250) }.bind(this)) }, __show: function () { this.__installTooltipLayerEventHandlers(); this.__trackTooltip(); $(this.__window).on("scroll.tooltip", function () { this.__trackTooltip() }.bind(this)); this.$body.find(".transparent-overlay").on("scroll.tooltip", function () { this.__trackTooltip() }.bind(this)) }, __trackTooltip: function () { var a = this.$globalNav.height() || 0, c = this.$target[0].getBoundingClientRect().top, e = this.$target[0].getBoundingClientRect().left, b = $(window).width() - (e + this.$target.outerWidth() / 2), f = this.$el[0].offsetWidth; 0 < this.$target.parents(".dialog-manager").length && (a = 0); b = b > f ? e + this.$target.width() / 2 : e + this.$target.width() / 2 - f; "bottom" === this.__tooltipPosition ? (b = e - this.$tooltip.width() / 2, c = this.$target[0].getBoundingClientRect().bottom - this.__positionDelta) : "above" === this.__tooltipPosition && (b = e + this.$target.width() / 2 - f, c = this.$target[0].getBoundingClientRect().top - this.$el[0].offsetHeight); this.$el.css({ "margin-top": Math.max(c, a), "margin-left": b }) }, __hide: function () { this.__removeTooltipLayerEventHandlers(); this.setVisible(!1) }, __openTooltipDialog: function () { return this.__dialogManager.showDialog(h.TooltipDialog, { title: this.tooltipTitle || this.$target.text(), tooltipContent: this.$tooltip.html(), trackedEvents: this.__customTrackedEvents }) }, delete: function () { this.$el.removeAttr("style"); this.__timer.clearTimeout(this.__targetFadeinTimeout); this.__timer.clearTimeout(this.__targetTimeout); this.__timer.clearTimeout(this.__tooltipTimeout); this.$target.off(".tooltip"); this.__removeTooltipLayerEventHandlers(); $(this.__window).off("scroll.tooltip"); this.$body.find(".transparent-overlay").off("scroll.tooltip"); d.prototype.delete.call(this) }, __clickedLink: function (a) { this.__hide() } }) }({ UiCore: n["@UiCore"], TooltipDialog: r }); u = function (h) { var d = h.Dialogs.AlloyModalDialog; return d.extend("PrivacyPolicyAdultDialog", { uiContextName: "privacy_policy_adult_dialog", className: "privacy-policy-adult-dialog dialog-type-B", dependencies: ["cookieManager", "globalStringManager"], trackedEvents: function () { return [{ type: "click", selector: ".accept-button", name: "submit_privacy_policy_adult_okay", handler: "__onClose" }] }, initialize: function (a) { d.prototype.initialize.call(this, a); this.title = this.__globalStringManager.get("privacy_policy_adult_dialog_title"); this.isUncancellableDialog = !0; this.addToDOM(); this.$(".dialog-x").remove() }, postRender: function () { this.setContent("body", h.template, {}); this.tooltip = this.createChildContext(h.Tooltip, { $replaceElement: this.$(".tooltip-content"), $tooltipTarget: this.$(".tooltip-target") }); this.tooltip.$el.addClass("tooltip-wide") }, __onClose: function (a) { this.__cookieManager.set("accepted_all_cookies", "true"); d.prototype.__onClose.call(this, a) } }) }({ Dialogs: n["@Dialogs"], Tooltip: r, template: u }); var D = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function () { return "<img class='silhouette' src='/common/withme/img/loading_avatar.png'>" }, useData: !0 }) }({}); D = function (h) { var d = h.UiCore.UiContext; return d.extend("Avatar2d", { uiContextName: "avatar_2d", className: "avatar-2d", dependencies: ["dialogManager", "globalStringManager", "model", "timer"], initialize: function (a) { d.prototype.initialize.call(this, a); this.__width = IMVU.optionalProperty(a, "width", 800); this.__height = IMVU.optionalProperty(a, "height", 800); this.__vanishDelay = IMVU.optionalProperty(a, "vanishDelay", 800); this.__imageError = IMVU.optionalProperty(a, "imageError", "error"); this.__imageFactory = IMVU.optionalProperty(a, "imageFactory", function () { return new Image }); this.__lookModel = this.__model; this.addToDOM(); this.__lookModel.on("syncing", this.__refreshLoading, this); this.__refreshLoading(); a.filterModel ? (this.__filterModel = a.filterModel, this.listenTo(this.__filterModel, "change:category", this.__updateAvatarImage.bind(this))) : a.view && (this.__view = a.view); this.listenTo(this.__lookModel, "change", this.__updateAvatarImage.bind(this)); this.__lookModel.populated().then(this.__updateAvatarImage.bind(this)) }, getSceneLoadedPromise: function () { return this.__lookModel.populated() }, delete: function () { this.__destroyInFlightImage(); this.$(".avatar-image").off(); this.__timer.clearTimeout(this.__vanishTimer); d.prototype.delete.call(this) }, __refreshLoading: function () { this.$el.toggleClass("loading", this.__lookModel.isSyncing() || !!this.__$inFlightImage) }, __destroyInFlightImage: function () { this.__$inFlightImage && (this.__$inFlightImage.off(), this.__$inFlightImage = null) }, __vanishCurrentImage: function () { if (this.__$currentImage) { var a = this.__$currentImage; a.addClass("vanishing"); this.__$currentImage = null; this.__vanishTimer = this.__timer.setTimeout(function () { a.remove() }, this.__vanishDelay) } }, __maybeFadeIn: function (a) { this.$el.is(":visible") && a.addClass("fade-in") }, __onImageLoad: function () { this.__vanishCurrentImage(); this.__$currentImage = this.__$inFlightImage; this.__maybeFadeIn(this.__$inFlightImage); this.$el.addClass("populated").removeClass("error").append(this.__$inFlightImage); this.__$inFlightImage = null; this.__refreshLoading() }, __onImageFail: function () { this.trigger("avatar_load_fail"); this.__destroyInFlightImage(); this.__recordEvent("avatar_image_load_error", { url: this.__lookModel.get("avatar_image"), record: !0 }); this.$el.addClass("error"); this.__refreshLoading(); this.__dialogManager.alert({ title: this.__globalStringManager.get("dialog_avatar_error_title"), text: this.__globalStringManager.get("dialog_avatar_error_text"), ok: this.__globalStringManager.get("dialog_avatar_error_button") }) }, __buildFilterView: function () { var a = this.__filterModel.get("category"); return "dressup_front_" + (_.contains("wearing all accessories skins avatars outfits".split(" "), a) ? "all" : a) }, __buildImageSrc: function () { return IMVU.URI.build(this.__lookModel.get("avatar_image"), { width: this.__width, height: this.__height, view: this.__filterModel ? this.__buildFilterView() : this.__view }) }, __updateAvatarImage: function () { if (void 0 !== this.__lookModel.get("avatar_image") && null !== this.__lookModel.get("avatar_image")) { var a = this.__buildImageSrc(); a !== this.__currentImageSrc && (this.__currentImageSrc = a, this.__destroyInFlightImage(), this.__$inFlightImage = $(this.__imageFactory()), this.__$inFlightImage.attr("src", a).addClass("avatar-image avatar-2d-ie11-fix").on("load", this.__onImageLoad.bind(this)).on(this.__imageError, this.__onImageFail.bind(this)), this.__refreshLoading()) } }, isRendering: function () { return !0 }, render: function () { this.$el.html(h.template()); this.__maybeFadeIn(this.$(".silhouette")) } }) }({ UiCore: n["@UiCore"], template: D }); D = function (h) { var d = h.Avatar2d; return d.extend("FtuxAvatar2d", { uiContextName: "ftux_avatar_2d", className: "avatar-2d ftux-avatar-2d", dependencies: ["dialogManager", "globalStringManager", "Promise", "timer"], initialize: function (a) { this.__category = a.category || "all"; this.__loadedPromise = new a.Promise(function (c) { this.__loadedResolver = c }.bind(this)); d.prototype.initialize.call(this, a); this.setAttachedToBottom(a.attachedToBottom) }, setAttachedToBottom: function (a) { this.$el.toggleClass("is-attached-to-bottom", !!a) }, setCategory: function (a) { this.__category !== a && (this.__category = a, this.__updateAvatarImage()) }, getCategory: function () { return this.__category }, getLookModel: function () { return this.__lookModel }, vanishCurrentImage: function () { if (this.__$currentImage) { var a = this.__$currentImage; this.__$currentImage = null; a.addClass("vanishing"); this.__vanishTimer = this.__timer.setTimeout(function () { a.remove() }, this.__vanishDelay) } }, __onImageLoad: function () { d.prototype.__onImageLoad.call(this); "pending" === this.__loadedPromise.state && this.__loadedResolver.accept(this); this.trigger("loaded") }, __buildImageSrc: function () { var a = _.contains(["accessories", "skins"], this.__category) ? "all" : this.__category; a = $.param({ width: 945, height: 945, view: "dressup_front_" + a }); return this.__lookModel.get("avatar_image") + "?" + a }, loaded: function () { return this.__loadedPromise } }) }({ UiCore: n["@UiCore"], Avatar2d: D }); var L = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ 1: function (d) { var a, c = this.escapeExpression; return "\n                        <a class='px-5 language language-" + c((a = d && d.code, "function" === typeof a ? a.apply(d) : a)) + "' data-code='" + c((a = d && d.code, "function" === typeof a ? a.apply(d) : a)) + "' href=\"" + c((a = d && d.url, "function" === typeof a ? a.apply(d) : a)) + '">' + c((a = d && d.name, "function" === typeof a ? a.apply(d) : a)) + "</a>\n                        " }, compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = this.escapeExpression, k = '<div class="ftux-body">\n    <div class="bg-container">\n    </div>\n    <div class="ftux-body-overlay">\n        <div class="flex-layout">\n            <div class="flex-cell">\n                '; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-imvu-logo", { name: "icon", hash: { class: "bg-logo" }, data: e }), (b || 0 === b) && (k += b), k += '\n            </div>\n            <div class="flex-cell">\n                <div class="content">\n                    <p class="id-title">', f = a.i18n || d && d.i18n || c, b = f.call(d, "welcome_frontpage_title", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</p>\n                    <p class="id-text">', f = a.i18n || d && d.i18n || c, b = f.call(d, "welcome_frontpage_text", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</p>\n                    <button class="btn btn-primary-dark id-continue">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "get_started_for_free", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</button>\n                        <div class="label label-or">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_or", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n                        <button class="btn btn-primary-dark btn-apple id-apple">Continue with Apple</button>\n                    <button class="btn btn-fb id-fb">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "continue_with_facebook", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</button>\n                    <ul class="ftux-bottom-nav">\n                        <div class="have-an-account">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_have_an_account", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div> <a class="login">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_login_link", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a>\n                    </ul>\n                    <div class="label languages">\n                        <a class=\'px-5 language current_language language-' + g((b = d && d.currentLocale, b = null == b || !1 === b ? b : b.code, "function" === typeof b ? b.apply(d) : b)) + "' data-code='" + g((b = d && d.code, "function" === typeof b ? b.apply(d) : b)) + "' href=\"" + g((b = d && d.currentLocale, b = null == b || !1 === b ? b : b.url, "function" === typeof b ? b.apply(d) : b)) + '">' + g((b = d && d.currentLocale, b = null == b || !1 === b ? b : b.name, "function" === typeof b ? b.apply(d) : b)) + "</a>\n                        ", b = a.each.call(d, d && d.otherLocales, { name: "each", hash: {}, fn: this.program(1, e), inverse: this.noop, data: e }), (b || 0 === b) && (k += b), k += '\n                        <button class="px-5 btn btn-secondary more-locales right">\n                            <span class="icon">\n                            ', f = a.icon || d && d.icon || c, b = f.call(d, "icon-action_more", { name: "icon", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '\n                            </span>\n                        </button>\n                    </div>\n                    <nav class="footer">\n                        <ul class="footer-items">\n                            <li><a data-external href="https://about.imvu.com/">', f = a.i18n || d && d.i18n || c, b = f.call(d, "welcome_frontpage_about", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a></li>\n                            <li><a data-external href="https://blog.imvu.com/">', f = a.i18n || d && d.i18n || c, b = f.call(d, "welcome_frontpage_blog", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a></li>\n                            <li><a data-external href="https://about.imvu.com/careers">', f = a.i18n || d && d.i18n || c, b = f.call(d, "welcome_frontpage_jobs", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a></li>\n                            <li><a data-external href="https://www.imvu.com/next/policyhub/">', f = a.i18n || d && d.i18n || c, b = f.call(d, "welcome_frontpage_policies", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a></li>\n                            <li><a data-external href="https://help.imvu.com/">', f = a.i18n || d && d.i18n || c, b = f.call(d, "welcome_frontpage_help", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a></li>\n                            <li><a data-external href="https://about.imvu.com/contact">', f = a.i18n || d && d.i18n || c, b = f.call(d, "welcome_frontpage_contact", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a></li>\n                            <li><a data-external href="https://www.imvu.com/creatorlanding/explore/" class="uppercase-text">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "Become Creator", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a></li>\n                        </ul>\n                        <a class=\'personal-info\' data-external href="https://www.imvu.com/next/policyhub/ccpa/" target="_blank">\n                            ', f = a.i18n || d && d.i18n || c, b = f.call(d, "welcome_frontpage_personal_info", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (k += b), k += "\n                        </a>\n                        <a class='opt-out-adchoices' data-external href=\"" + g((f = a.adchoicesUrl || d && d.adchoicesUrl, "function" === typeof f ? f.call(d, { name: "adchoicesUrl", hash: {}, data: e }) : f)) + '" target="_blank" rel="noopener noreferrer">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "adchoices", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k + '</a>\n                    </nav>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="ftux-avatar-cache"></div>\n' }, useData: !0 }) }({}), G = function (h) { var d = h.UiCore.UiContext; return d.extend("ContextMenu", { uiContextName: "context_menu", tagName: "ul", className: "context-menu", trackedEvents: function () { return [{ type: "click", selector: "li", name: "context_menu_item", handler: "__chooseMenuItem", attributes: function (a) { return { which: a.attr("data-menu-item") } } }] }, initialize: function (a) { d.prototype.initialize.call(this, a); this.__items = IMVU.requireProperty(a, "items"); this.location = IMVU.requireProperty(a, "location"); this.mouseMargin = IMVU.optionalProperty(a, "mouseMargin", ""); this.__showCaret = IMVU.optionalProperty(a, "showCaret", !1); this.__closeOnScroll = void 0 !== a.closeOnScroll ? a.closeOnScroll : !0; this.addToDOM() }, render: function () { _.each(this.__items, function (a) { var c = $("<li />"); c.attr("data-menu-item", a.name).text(a.text).addClass(a.classNames).toggleClass("divider", !!a.divider); _.has(a, "title") && _.isString(a.title) && c.attr("title", a.title); this.$el.append(c) }.bind(this)); this.__showCaret && this.$el.append('<div class="caret"></div>') }, __chooseMenuItem: function (a) { var c = $(a.currentTarget).data("menu-item"), e = _.find(this.__items, function (b) { return b.name === c }).handler; e && e.call(this, a); this.trigger("item-chosen") }, shouldCloseOnScroll: function () { return !this.__closeOnScroll } }) }({ UiCore: n["@UiCore"] }), E = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ 1: function (d) { var a, c = this.escapeExpression; return "\n        <a class='px-5 language language-" + c((a = d && d.code, "function" === typeof a ? a.apply(d) : a)) + "' data-code='" + c((a = d && d.code, "function" === typeof a ? a.apply(d) : a)) + "' href=\"" + c((a = d && d.url, "function" === typeof a ? a.apply(d) : a)) + '">' + c((a = d && d.name, "function" === typeof a ? a.apply(d) : a)) + "</a>\n        " }, compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = this.escapeExpression, k = '<form name="login_form" method="GET" action="#" class="login">\n    <div class="label login_avatarname label-first" data-holder="'; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "welcome_dialog_username_placeholder", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '">\n        <input type="text" tabindex="1" name="avatarname" placeholder=\'', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "welcome_dialog_username_placeholder", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '\'  autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" value="' + g((f = a.username || d && d.username, "function" === typeof f ? f.call(d, { name: "username", hash: {}, data: e }) : f)) + '" />\n    </div>\n    <div class="label login_password label-second" data-holder="', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "welcome_dialog_password_placeholder", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '">\n        <div style="position:relative">\n            <input tabindex="1" type="password" name="password" placeholder=\'', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "welcome_dialog_password_placeholder", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '\'/>\n            <div class="toggle-password-visibility icon icon-password-show"></div>\n        </div>\n    </div>\n\n    <label class="submit">\n        <div class="error-message-container">\n            <div class="error-message try-again-later">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_try_again_later_error", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n            <div class="error-message try-again-later-server-load">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_try_again_later_error_server_load", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n            <div class="error-message client-2fa-not-supported">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_client_2fa_not_supported", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n            <div class="error-message credentials">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_credentials_error", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n            <div class="error-message disabled">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_disabled_error", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n            <div class="error-message unknown">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_unknown_login_error", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n            <div class="error-message 2fa-email-sent-rate-limit">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_2fa_email_sent_rate_limit", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n            <div class="error-message wrong-code-rate-limit">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_wrong_code_rate_limit", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n        </div>\n    </label>\n\n    <div class="label label-forgot">\n        <a data-external class="forgot-password-link" href="' + g((f = a.forgotPasswordUrl || d && d.forgotPasswordUrl, "function" === typeof f ? f.call(d, { name: "forgotPasswordUrl", hash: {}, data: e }) : f)) + '">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_forgot_credentials", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a>\n    </div>\n    <div class="label label-log-in">\n        <button class="btn btn-primary" >', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_signin_button", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</button>\n    </div>\n    <div class="label label-or">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_or", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n        <div class="label label-apple">\n            <a class="btn btn-apple id-apple">Continue with Apple</a>\n        </div>\n    <div class="label label-fb">\n        <a class="btn btn-fb id-fb">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "continue_with_facebook", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a>\n    </div>\n\n\n    <div class="label signup">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "welcome_dialog_no_account", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '&nbsp;<a class="id-signup">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "welcome_dialog_signup", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a></div>\n    <div class="label need-help">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_need_help", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '<a data-external href="https://help.imvu.com/">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_help_center", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a></div>\n\n    <div class="label languages flex items-center justify-center">\n        <a class=\'px-5 language current_language language-' + g((b = d && d.currentLocale, b = null == b || !1 === b ? b : b.code, "function" === typeof b ? b.apply(d) : b)) + "' data-code='" + g((b = d && d.code, "function" === typeof b ? b.apply(d) : b)) + "' href=\"" + g((b = d && d.currentLocale, b = null == b || !1 === b ? b : b.url, "function" === typeof b ? b.apply(d) : b)) + '">' + g((b = d && d.currentLocale, b = null == b || !1 === b ? b : b.name, "function" === typeof b ? b.apply(d) : b)) + "</a>\n        ", b = a.each.call(d, d && d.otherLocales, { name: "each", hash: {}, fn: this.program(1, e), inverse: this.noop, data: e }), (b || 0 === b) && (k += b), k += '\n        <div class="px-5 inline-block more-locales right text-charcoal cursor-pointer">\n            <div class="w-25 h-18">\n                ', f = a.icon || d && d.icon || c, b = f.call(d, "icon-action_more", { name: "icon", hash: { class: "wh-full" }, data: e }), (b || 0 === b) && (k += b), k += '\n            </div>\n        </div>\n    </div>\n\n    <p class="app-store-buttons text-spacing">\n        <a data-external href="https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8" class="ios-button" target="_blank">\n            ', f = a.icon || d && d.icon || c, b = f.call(d, "icon-app-store", { name: "icon", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '\n        </a>\n        <a data-external href="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova" class="last android-button" target="_blank">\n            ', f = a.icon || d && d.icon || c, b = f.call(d, "icon-google-play", { name: "icon", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '\n        </a>\n    </p>\n\n    <p class="privacy-agreements">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_privacy_agreements_description", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '<a target="_blank" href="' + g((f = a.policyHubUrl || d && d.policyHubUrl, "function" === typeof f ? f.call(d, { name: "policyHubUrl", hash: {}, data: e }) : f)) + '">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_terms_of_conditions", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</a><a target="_blank" href="' + g((f = a.arbitrationAgreementUrl || d && d.arbitrationAgreementUrl, "function" === typeof f ? f.call(d, { name: "arbitrationAgreementUrl", hash: {}, data: e }) : f)) + '">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_arbitration_agreement", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += "</a>", f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login__dialog_privacy_agreements_and", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '<a target="_blank" href="' + g((f = a.privacyPolicyUrl || d && d.privacyPolicyUrl, "function" === typeof f ? f.call(d, { name: "privacyPolicyUrl", hash: {}, data: e }) : f)) + '">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "login_dialog_privacy_policy", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k + "</a></p>\n</form>\n" }, useData: !0 }) }({}), H = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ 1: function () { return "show-label" }, 3: function (d, a, c, e) { var b, f; return f = a.defaultLabel || d && d.defaultLabel, b = "function" === typeof f ? f.call(d, { name: "defaultLabel", hash: {}, data: e }) : f, b || 0 === b ? b : "" }, 5: function () { return "&nbsp" }, 7: function (d, a, c, e) { var b, f; return f = a.content || d && d.content, b = "function" === typeof f ? f.call(d, { name: "content", hash: {}, data: e }) : f, b || 0 === b ? b : "" }, compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b; c = '<div class="holder-label">\n    <div class="info '; return b = a["if"].call(d, d && d.defaultLabel, { name: "if", hash: {}, fn: this.program(1, e), inverse: this.noop, data: e }), (b || 0 === b) && (c += b), c += '">', b = a["if"].call(d, d && d.defaultLabel, { name: "if", hash: {}, fn: this.program(3, e), inverse: this.program(5, e), data: e }), (b || 0 === b) && (c += b), c += '</div>\n    <div class="content">', b = a["if"].call(d, d && d.content, { name: "if", hash: {}, fn: this.program(7, e), inverse: this.noop, data: e }), (b || 0 === b) && (c += b), c + "</div>\n</div>\n" }, useData: !0 }) }({}); H = function (h) { Handlebars.registerPartial("InputMixinHolderLabel", h.HolderLabelTemplate); return { dependencies: [], trackedEvents: function () { return [{ type: "focus", selector: ".label[data-holder] input", name: "focus_input", handler: "__onHolderInputFocus" }, { type: "blur", selector: ".label[data-holder] input", name: "blur_input", handler: "__onHolderInputBlur" }] }, initialize: function () { this.render = function (d) { return function () { d.apply(this, arguments); this.__insertLabelTemplate(this.$(".label[data-holder]")) } }(this.render) }, __insertLabelTemplate: function (d) { d = (d instanceof $ ? d : this.$(d)).not(":has(>.holder-label)"); d.prepend(h.HolderLabelTemplate()); d.filter("[data-dropdown]").each(function (a, c) { this.__setInputLabelMsg(c, $(c).attr("data-holder")) }.bind(this)) }, __onHolderInputFocus: function (d) { d = $(d.currentTarget); d.attr("placeholder", ""); d = d.closest(".label[data-holder]").removeClass("error"); this.__insertLabelTemplate(d); d.find(">.holder-label >.info").html(d.attr("data-holder")).addClass("show-label") }, __onHolderInputBlur: function (d) { d = $(d.currentTarget); if (!d.val()) { var a = d.closest(".label[data-holder]"); d.attr("placeholder", a.attr("data-holder")); a.hasClass("error") || a.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label") } }, __clearError: function (d) { d = $(d).closest(".label[data-holder]").removeClass("error"); var a = d.find("input"); !a[0] || a.val() ? this.__setInputLabelMsg(d, d.attr("data-holder")) : (a.attr("placeholder", d.attr("data-holder")), d.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label")) }, __setInputLabelMsg: function (d, a) { d = d instanceof $ ? d : this.$(d); d.find(">.holder-label >.info").html(a).toggleClass("show-label", !!d.attr("data-holder") || d.hasClass("error")) }, __setInputErrorLabelMsg: function (d, a) { this.__setInputLabelMsg(this.$(d).addClass("error"), a) } } }({ UiCore: n["@UiCore"], HolderLabelTemplate: H }); var z = function (h) { return h.UiCore.RestCollection.extend("PrefCollection", { model: h.UiCore.EdgeModel }) }({ UiCore: n["@UiCore"] }); z = function (h) { return IMVU.BaseClass.extend("PrefsManager", { dependencies: ["loginManager", "Promise", "rest"], initialize: function (d) { this.Promise = d.Promise; this.rest = d.rest; this.__pendingSets = {}; var a = d.userModel || d.loginManager.getCurrent().getSingleEdge("user"); this.__populated = a.populated().then(function () { var c = this.Promise.resolve(); a.relations && a.relations.preferences || (a.invalidate(), c = a.populated()); return c.then(function () { return a.getEdgeCollection("preferences", h.PrefCollection) }) }.bind(this)).then(function (c) { this.collection = c; return c.populated() }.bind(this)).then(function () { this.collection.on("change", this.__cleanPendingSet.bind(this)) }.bind(this)) }, __cleanPendingSet: function (d) { var a = d.get("name"); d = d.get("value"); this.__pendingSets[a] === d && delete this.__pendingSets[a] }, populated: function () { return this.__populated }, __ensurePopulated: function () { if ("pending" === this.__populated.state) throw Error("Cannot perform preference operation until preferences are populated") }, get: function (d, a) { this.__ensurePopulated(); if (this.__pendingSets[d]) return this.__pendingSets[d]; for (var c = 0; c < this.collection.length; c++) { var e = this.collection.at(c); if (e.get("name") === d) return e.get("value") } return a }, getBool: function (d, a) { d = this.get(d, null); return _.isNull(d) ? a : !!parseInt(d, 10) }, getInt: function (d, a) { d = this.get(d, null); return _.isNull(d) ? a : parseInt(d, 10) }, setBool: function (d, a) { return this.set(d, a ? "1" : "0") }, setInt: function (d, a) { return this.set(d, String(a)) }, set: function (d, a) { this.__ensurePopulated(); if ("string" !== typeof a) throw Error("Tried to set pref with non-string value: " + typeof a); if (this.get(d) === a) return new this.Promise(function (c) { c.accept() }); this.__pendingSets[d] = a; a = this.rest.post(this.collection.url, { id: "/preferences/preference-" + d, data: { value: a } }); a.catch(function () { delete this.__pendingSets[d] }.bind(this)); return a } }) }({ UiCore: n["@UiCore"], PrefCollection: z }); var A = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '<div class="copy-body">\n    '; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_pending_guardian_approval_1", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += "\n    ", f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_pending_guardian_approval_2", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += "\n    ", f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_pending_guardian_approval_3", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '\n    <a href="https://help.imvu.com" target="_blank">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "Help Center", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '.</a></div>\n</div>\n<div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "view_privacy_policy", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</a></div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary full-width">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "close pending policy", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g + "</button>\n<\/script>\n\n" }, useData: !0 }) }({}), B = function (h) { var d = h.Dialogs.AlloyModalDialog; return d.extend("PrivacyPolicyMinorsPendingDialog", { uiContextName: "privacy_policy_minors_pending_dialog", className: "privacy-policy-minors-pending-dialog dialog-type-B", dependencies: ["cookieManager", "globalStringManager"], trackedEvents: function () { return [{ type: "click", selector: "button", name: "submit_privacy_policy_adult_okay", handler: "__onClose" }] }, initialize: function (a) { d.prototype.initialize.call(this, a); this.title = this.__globalStringManager.get("privacy_pending_guardian_approval_title"); this.addToDOM(); this.$(".dialog-x").remove() }, postRender: function () { this.setContent("body", h.template, {}); this.setContent("footer", this.$(".dialog-footer-template").text()) }, __onClose: function (a) { d.prototype.__onClose.call(this, a) } }) }({ Dialogs: n["@Dialogs"], Tooltip: r, template: A }); A = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '<div class="content">\n    <div class="privacy-policy-minors-body">'; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_minors_dialog_body", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</div>\n    <div class="privacy-policy-minors-form">\n        <div class="privacy-policy-minors-form-title">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_minors_dialog_form_title", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</div>\n        <div class="fieldset">\n            <label>', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "Name", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</label>\n            <input type="text" class="privacy-policy-minors-avatarname full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "your name", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</label>\n            <input type="text" class="privacy-policy-minors-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "email address", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += "<span> (", f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_minors_email_note", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += ')</span></label>\n            <input type="text" class="privacy-policy-minors-email full-width"></input>\n            <div class="input-error"></div>\n        </div>\n        <div class="fieldset">\n            <label>', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_minors_guardian_name", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</label>\n            <input type="text" class="privacy-policy-minors-guardian-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_minors_guardian_email", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</label>\n            <input type="text" class="privacy-policy-minors-guardian-email full-width"></input>\n            <div class="input-note">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_minors_guardian_email_note", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</div>\n            <div class="input-error"></div>\n        </div>\n    </div>\n    <div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "view_privacy_policy", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</a></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary minors-guardian-form-submit full-width disabled">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "submit", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g + "</button>\n<\/script>" }, useData: !0 }) }({}); var v = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = "<div>\n    <p>"; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_minors_guardian_dialog_body_1", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += "</p>\n    <p>", f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "privacy_policy_minors_guardian_dialog_body_2", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</p>\n</div>\n<div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "view_privacy_policy", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</a></div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary ok full-width">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "OK", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g + "</button>\n<\/script>" }, useData: !0 }) }({}); v = function (h) { var d = h.Dialogs.AlloyModalDialog; return d.extend("PrivacyPolicyMinorsGuardianDialog", { uiContextName: "privacy_policy_minors_guardian_dialog", className: "privacy-policy-minors-guardian-dialog dialog-type-B", dependencies: ["globalStringManager"], trackedEvents: function () { return [{ type: "click", selector: "button", name: "submit_privacy_policy_minors_okay", handler: "__onClose" }] }, initialize: function (a) { d.prototype.initialize.call(this, a); this.title = this.__globalStringManager.get("privacy_policy_minors_guardian_dialog_title"); this.addToDOM() }, postRender: function () { this.setContent("body", h.template, {}); this.setContent("footer", this.$(".dialog-footer-template").text()) } }) }({ Dialogs: n["@Dialogs"], template: v }); var M = function (h) { return { validateEmail: function (d) { return /[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(d) } } }({}); v = function (h) { var d = h.Dialogs.AlloyModalDialog; return d.extend("PrivacyPolicyMinorsDialog", { uiContextName: "privacy_policy_minors_dialog", className: "privacy-policy-minors-dialog dialog-type-B", dependencies: ["dialogManager", "globalStringManager", "rest"], trackedEvents: function () { return [{ type: "keyup", selector: "input.privacy-policy-minors-avatarname", name: "change_avatarname", handler: "__toggleButton" }, { type: "keyup", selector: "input.privacy-policy-minors-name", name: "change_username", handler: "__toggleButton" }, { type: "keyup", selector: "input.privacy-policy-minors-email", name: "change_email", handler: "__validateMinorsEmail" }, { type: "keyup", selector: "input.privacy-policy-minors-guardian-name", name: "change_guardian_name", handler: "__toggleButton" }, { type: "keyup", selector: "input.privacy-policy-minors-guardian-email", name: "change_guardian_email", handler: "__validateGuardiansEmail" }, { type: "click", selector: "button", name: "submit_privacy_policy_minors_form", handler: "__submit" }] }, initialize: function (a) { d.prototype.initialize.call(this, a); this.__GUARDIAN_VERIFICATION_URL = this.__serviceProvider.get("root") + "/guardian_verification"; this.title = this.__globalStringManager.get("privacy_policy_minors_dialog_title"); this.__formValidator = h.FormValidator; this.addToDOM(); this.$(".dialog-x").remove(); this.__hasError = !1 }, postRender: function () { this.setContent("body", h.template, {}); this.setContent("footer", this.$(".dialog-footer-template").text()); this.$(".content").scrollbar() }, __toggleButton: function () { var a = !1; this.$("input").each(function (e) { $(this).val() || (a = !0) }); var c = this.__minorsEmailError || this.__guardiansEmailError; this.$(".minors-guardian-form-submit").toggleClass("disabled", a || c) }, __validateMinorsEmail: function (a) { this.__minorsEmailError = !1; var c = $(a.currentTarget); a = c.siblings(".input-error"); a.text(""); c = this.__validateEmail(c.val()); null !== c && (this.__minorsEmailError = !0, a.text(c)); this.__toggleButton() }, __validateGuardiansEmail: function (a) { this.__guardiansEmailError = !1; a = $(a.currentTarget); a.siblings(".input-note").toggleClass("hidden", !1); var c = a.siblings(".input-error"); c.text(""); var e = this.__validateEmail(a.val()); null === e && this.$("input.privacy-policy-minors-email").val() === this.$("input.privacy-policy-minors-guardian-email").val() && (e = this.__globalStringManager.get("privacy_policy_minors_guardian_email_note")); null !== e && (this.__guardiansEmailError = !0, c.text(e), a.siblings(".input-note").toggleClass("hidden", !0)); this.__toggleButton() }, __validateEmail: function (a) { return a ? this.__formValidator.validateEmail(a) ? null : this.__globalStringManager.get("error_message_email_invalide_format") : this.__globalStringManager.get("error_message_email_empty") }, __submit: function (a) { this.__rest.post(this.__GUARDIAN_VERIFICATION_URL, { avatarname: this.$("input.privacy-policy-minors-avatarname").val(), user_name: this.$("input.privacy-policy-minors-name").val(), user_email: this.$("input.privacy-policy-minors-email").val(), guardian_name: this.$("input.privacy-policy-minors-guardian-name").val(), guardian_email: this.$("input.privacy-policy-minors-guardian-email").val() }).then(function (c) { }); this.__onClose(a); this.__dialogManager.showDialog(h.PrivacyPolicyMinorsGuardianDialog) } }) }({ Dialogs: n["@Dialogs"], FormValidator: M, PrivacyPolicyMinorsGuardianDialog: v, template: A }); A = function (h) { return { mixin: function (d) { for (var a = [], c = 0; c < arguments.length; ++c)a[c - 0] = arguments[c]; var e = a[0], b = []; c = function (k) { for (var m = [], l = 0; l < arguments.length; ++l)m[l - 0] = arguments[l]; for (l = b.length; 0 < l--;)b[l].apply(this, m) }; var f = [], g = function (k) { for (var m = [], l = 0; l < arguments.length; ++l)m[l - 0] = arguments[l]; l = []; for (var q = f.length; 0 < q--;)l = l.concat(f[q].apply(this, m)); return l }; _.each(a, function (k) { k.initialize && b.push(k.initialize); k.trackedEvents && f.push(k.trackedEvents); if (k !== e) { var m = e.dependencies || []; _.each(k.dependencies, function (l) { -1 === _.indexOf(m, l) && m.push(l) }); m.sort(); _.extend(e, k, { dependencies: m }) } }); b.length && (e.initialize = 1 < b.length ? c : b[0]); f.length && (e.trackedEvents = 1 < f.length ? g : f[0]); return e } } }({}); E = function (h) { var d = h.Dialogs.AlloyModalDialog; return d.extend("LoginDialog", h.Mixin.mixin({ uiContextName: "login_dialog", className: "login-dialog dialog-type-B-flexible", dependencies: "browserInfo contextMenuManager cookieManager counterHelper dialogManager featureAccessManager globalStringManager googleAnalytics localStorage loginManager modeManager prefsManager Promise restModelFactory urlManager window".split(" "), trackedEvents: function () { return [{ type: "submit", selector: "form.login", name: "login", handler: "__onLogin" }, { type: "click", selector: ".id-signup", name: "signup", handler: "__onClickSignup" }, { type: "click", selector: ".id-fb", name: "fb_login", handler: this.__onClickFB }, { type: "click", selector: ".id-apple", name: "apple_login", handler: "__onClickApple" }, { type: "click", selector: ".toggle-password-visibility", name: "toggle_password_visibility", handler: "__togglePasswordVisibility" }, { type: "click", selector: ".forgot-password-link", name: "forgot_password", handler: "__forgotPassword" }, { type: "click", selector: ".language", name: "language", handler: this.__changeLanguage }, { type: "click", selector: ".more-locales", name: "more_locales", handler: this.__showMoreLocalesMenu }] }, initialize: function (a) { this.__browserInfo = a.browserInfo; this.title = a.globalStringManager.get("welcome_login_dialog_signin"); "undefined" !== typeof a.globalStringManager && (this.__globalStringManager = a.globalStringManager); this.hasCloseButton = _.isUndefined(a.hasCloseButton) ? !0 : a.hasCloseButton; this.__loginMode = a.loginMode; d.prototype.initialize.call(this, a); this.__loginCookieName = this.__serviceProvider.get("loginCookieName"); this.__cookieManager = this.__serviceProvider.get("cookieManager"); this.__hasSignupButton = _.isUndefined(a.hasSignupButton) ? !0 : a.hasSignupButton; this.__loginUsername = this.__cookieManager.get("login_username") ? this.__cookieManager.get("login_username") : ""; this.__refreshOnLogin = a.refreshOnLogin || "mobile" === this.__serviceProvider.get("platform"); this.__loginDestination = a.loginDestination ? this.__getLoginDestination(a.loginDestination) : null; this.__contextMenuManager = a.contextMenuManager; this.shouldFocusOnPrimaryButton = !1; this.__socialLogin = this.__loginManager.getSocialLogin(); this.__socialLogin.checkLoginState(); (this.__hadSocialLogin = this.__socialLogin.hadEverLoggedIn()) && this.__socialLogin.logout(); (a = this.__serviceProvider.get("currentLocale")) && "en" != a || (a = "www"); var c = this.__serviceProvider.get("locales"); this.__currentLocaleInfo = void 0; this.__otherLocaleInfo = []; this.__remainderLocaleInfo = []; var e = 0; c = $jscomp.makeIterator(c); for (var b = c.next(); !b.done; b = c.next())(b = b.value) && b.url && (b.url = decodeURIComponent(b.url)), b.code == a ? this.__currentLocaleInfo = b : 2 > e && -1 != ["es", "pt", "www"].indexOf(b.code) ? (this.__otherLocaleInfo.push(b), ++e) : this.__remainderLocaleInfo.push(b); a = this.__serviceProvider.get("siteRoot").replace("welcome/", "").replace("next/", ""); this.__featureAccessManager.isElectronClient() && (a = "https://secure.imvu.com/"); this.__forgotPasswordUrl = a + "welcome/forgotpassword/"; this.addToDOM() }, postRender: function () { this.__loginUsername = "undefined" === typeof this.__loginUsername ? "" : this.__loginUsername; this.__loginUsername = "undefined" === this.__loginUsername ? "" : this.__loginUsername; this.__loginUsername = null === this.__loginUsername ? "" : this.__loginUsername; this.setContent("body", h.template, { username: this.__loginUsername, forgotPasswordUrl: this.__forgotPasswordUrl, currentLocale: this.__currentLocaleInfo, otherLocales: this.__otherLocaleInfo, canSeeAppleSignIn: this.__featureAccessManager.canSeeAppleSignIn(), policyHubUrl: this.__urlManager.get("policy_hub"), arbitrationAgreementUrl: this.__urlManager.get("arbitration_agreement"), privacyPolicyUrl: this.__urlManager.get("privacy_policy") }); this.$(".login_avatarname input").focus(); this.__loginUsername && this.$(".login_password input").focus(); this.$(".login").toggleClass("can-signup", this.__hasSignupButton); if (this.__loginUsername) { var a = this.$('input[name="avatarname"]').closest(".label[data-holder]"); this.__insertLabelTemplate(a); if (a.hasClass("ignore-placeholder-behavior")) return; a.find(">.holder-label >.info").html(a.attr("data-holder")) } this.__counterHelper.increment("welcome_login_dialog") }, __showMoreLocalesMenu: function (a) { a.preventDefault(); for (var c = [], e = {}, b = $jscomp.makeIterator(this.__remainderLocaleInfo), f = b.next(); !f.done; e = { $jscomp$loop$prop$localeInfo$3: e.$jscomp$loop$prop$localeInfo$3 }, f = b.next())e.$jscomp$loop$prop$localeInfo$3 = f.value, c.push({ name: e.$jscomp$loop$prop$localeInfo$3.code, text: e.$jscomp$loop$prop$localeInfo$3.name, handler: function (g) { return function () { var k = g.$jscomp$loop$prop$localeInfo$3.code; if (this.__featureAccessManager.isElectronClient()) this.__localStorage.setItem("lang", k), this.__window.location.reload(); else { "" === k ? this.__cookieManager.clear("saved_locale") : this.__cookieManager.set("saved_locale", k); var m = new URL(this.__window.location.href); 3 < m.host.split(".").length && (m.host = m.host.split(".").splice(1).join(".")); m.host = [k, m.host].join("."); this.__window.location.href = m } } }(e).bind(this) }); this.__contextMenuManager.showMenu(a, h.ContextMenu, { items: c, displayOptions: { above: !0, right: !0 } }) }, __changeLanguage: function (a) { a.preventDefault(); var c = a.target.getAttribute("data-code"); this.__featureAccessManager.isElectronClient() ? (this.__localStorage.setItem("lang", c), this.__window.location.reload()) : ("" === c ? this.__cookieManager.clear("saved_locale") : this.__cookieManager.set("saved_locale", c), this.__window.location.href = a.target.getAttribute("href")) }, __onLogin: function (a) { null !== a && a.preventDefault(); a = "true" === this.__cookieManager.get("accepted_all_cookies") ? !0 : !1; var c = { username: this.$('[name="avatarname"]').val(), password: this.$('[name="password"]').val(), gdpr_cookie_acceptance: a }; this.$("label.submit").addClass("loading"); this.__loginManager.performLoginFromCredentials(this.__serviceProvider, c).then(function (e) { this.__googleAnalytics.recordSuccessfulAuthentication("true"); this.$("label.submit").removeClass("loading"); this.$(".error-message").removeClass("active").css("height", ""); this.__cookieManager.set(this.__loginCookieName, "true"); this.__cookieManager.set("prefer_alloy", "1"); this.__cookieManager.set("login_username", c.username); this.__cookieManager.set("password_changed", "0"); var b = this.__restModelFactory.readModel(e.relations.user, h.UiCore.NodeModel); b.relations && b.relations.preferences || b.invalidate(); b.populated().then(function () { b.get("is_on_hold") ? this.__dialogManager.alert({ title: this.__globalStringManager.get("welcome_login_banned_user_title"), text: this.__globalStringManager.get("welcome_login_banned_user_text") }).finished.then(function () { this.hide(); this.__featureAccessManager.isElectronClient() ? (this.__externalWindow = this.__serviceProvider.get("externalWindow"), this.__externalWindow.newElectronWindow({ width: 1024, height: 768 }).loadURL("https://help.imvu.com/s/contactus"), this.__onLoginContinue(b)) : this.__window.location = "https://help.imvu.com/s/contactus" }.bind(this)) : this.__onLoginContinue(b) }.bind(this)) }.bind(this), function (e) { var b = "credentials"; e === this.__loginManager.ERROR_TRY_AGAIN_LATER ? b = "try-again-later" : e === this.__loginManager.ERROR_DISABLED ? b = "disabled" : e === this.__loginManager.ERROR_UNDERAGE || e === this.__loginManager.ERROR_COOKIE_UNACCEPT || e === this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT ? (b = "disabled", this.__showPrivacyPolicyDialog(e)) : e === this.__loginManager.ERROR_EXCESSIVE_SERVER_LOAD ? b = "try-again-later-server-load" : e === this.__loginManager.ERROR_CODE_EMAIL_RATE_LIMIT ? b = "2fa-email-sent-rate-limit" : e === this.__loginManager.ERROR_WRONG_CODE_RATE_LIMIT ? b = "wrong-code-rate-limit" : e === this.__loginManager.ERROR_CLIENT_2FA_NOT_SUPPORTED && (b = "client-2fa-not-supported"); h.NextUtil.DomHelper.radioClass(this.$(".error-message." + b), "active"); e = this.$(".error-message.active").height(); this.$(".error-message.active").css("height", 0); this.$("label.submit").removeClass("loading"); this.$(".error-message.active").height(); this.$(".error-message.active").css("height", e) }.bind(this)) }, __onLoginContinue: function (a) { var c = this, e = this.__Promise.resolve(); this.__featureAccessManager.isElectronClient() && (e = new this.__Promise(function (b) { c.__LoggedInPrefsManager = c.__serviceProvider.create(h.LoggedInPrefsManager, { userModel: a }); c.__LoggedInPrefsManager.populated().then(function () { this.__LoggedInPrefsManager.setBool("next.has_signed_onto_client", !0); b.resolve() }.bind(c)).catch(function (f) { window.console.error("Unable to save next.has_signed_onto_client", f); b.resolve() }) })); e.then(function () { var b = new URL(c.__window.location.href).searchParams; b && b.get("next") ? (b = b.get("next"), c.__window.location.href = decodeURIComponent(b)) : c.__loginDestination ? c.__window.location.href = decodeURIComponent(c.__loginDestination) : c.__loginManager.getLoginDestination() ? c.__window.location.href = c.__loginManager.getLoginDestination() : c.__serviceProvider.services.overrideMode && "ftux" !== c.__serviceProvider.services.overrideMode ? (b = c.__serviceProvider.get("siteRoot"), b += c.__serviceProvider.get("startMode") + "/", c.__serviceProvider.services.startSubmode && (b += c.__urlId(c.serviceProvider.get("startSubmode")) + "/"), c.__window.location.href = b) : c.__refreshOnLogin ? c.__window.location.reload() : a.populated().then(function () { return a.getEdgeCollection("preferences", h.UiCore.RestCollection) }.bind(c)).then(function (f) { this.__prefs = f; return this.__prefs.populated() }.bind(c)).then(function () { for (var f = !1, g = 0; g < this.__prefs.length; g++) { var k = this.__prefs.at(g); "registered_through_alloy" !== k.get("name") && "registered_through_mobile" !== k.get("name") && "pure_mobile_access" !== k.get("name") || !k.get("value") || (f = !0, this.__window.location.reload()) } f || (this.__window.location.href = "/switch_to/classic/") }.bind(c)) }) }, __onClickSignup: function (a) { a.preventDefault(); this.__googleAnalytics.recordSignUpClick("login"); this.promiseResolver.resolve("signup"); if ("iOS" === this.__browserInfo.getMobileOS()) this.__window.location = "itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8"; else if ("Android" === this.__browserInfo.getMobileOS()) this.__window.location = "https://play.google.com/store/apps/details?id=com.imvu.mobilecordova"; else if ((a = new URL(this.__window.location.href).searchParams) && a.get("next")) { var c = a.get("next"); a = null !== this.__window.location.host.match(/localhost\.imvu\.com$/) === !0 ? new URL("https://localhost.imvu.com/welcome/ftux/gender/") : new URL("https://secure.imvu.com/welcome/ftux/gender/"); a.searchParams.append("next", c); this.__window.open(a, "_self") } else this.__window.location = "/welcome/ftux/gender/" }, __redirectToFtux: function () { this.$el.fadeOut(300, function () { this.__modeManager.openMode({ mode: { id: "ftux" }, submode: { id: "gender" } }) }.bind(this)) }, __onClickCta: function () { "mobile" === this.__serviceProvider.get("platform") ? "iOS" === this.__browserInfo.getMobileOS() ? this.__window.location = "itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8" : "Android" === this.__browserInfo.getMobileOS() ? this.__window.location = "https://play.google.com/store/apps/details?id=com.imvu.mobilecordova" : this.__window.location = "https://about.imvu.com/mobile/" : this.__redirectToFtux() }, __onClickFB: function () { var a = this; "mobile" === this.__serviceProvider.get("platform") ? this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this), function () { a.__dialogManager.confirm({ title: a.__globalStringManager.get("ftux_frontpage_get_the_app"), text: a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"), yes: a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"), no: a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn") }).finished.then(function () { this.__onClickCta() }.bind(a)) }) : this.__featureAccessManager.isElectronClient() ? this.__window.navigator.onLine ? this.__socialLogin.fbOauthLogin(this.__imvuLoginCallback.bind(this), this.__redirectToFtux.bind(this)) : this.__dialogManager.alert({ title: this.__globalStringManager.get("generic_offline_error_title"), text: this.__globalStringManager.get("generic_offline_error_message") }) : this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this), this.__redirectToFtux.bind(this)) }, __onClickApple: function () { var a = this; "mobile" === this.__serviceProvider.get("platform") ? this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this), function () { a.__dialogManager.confirm({ title: a.__globalStringManager.get("ftux_frontpage_get_the_app"), text: a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"), yes: a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"), no: a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn") }).finished.then(function () { this.__onClickCta() }.bind(a)) }, this.__appleErrorCallback.bind(this)) : this.__featureAccessManager.isElectronClient() ? this.__window.navigator.onLine ? this.__socialLogin.appleOauthLogin(this.__imvuLoginCallback.bind(this), this.__redirectToFtux.bind(this), this.__appleErrorCallback.bind(this)) : this.__dialogManager.alert({ title: this.__globalStringManager.get("generic_offline_error_title"), text: this.__globalStringManager.get("generic_offline_error_message") }) : this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this), this.__redirectToFtux.bind(this), this.__appleErrorCallback.bind(this)) }, __imvuLoginCallback: function () { var a = new URL(this.__window.location.href).searchParams; a && a.get("next") ? (a = a.get("next"), this.__window.location.href = decodeURIComponent(a)) : this.__loginDestination ? this.__window.location.href = decodeURIComponent(this.__loginDestination) : this.__loginManager.getLoginDestination() ? this.__window.location.href = this.__loginManager.getLoginDestination() : this.__serviceProvider.services.overrideMode && "ftux" !== this.__serviceProvider.services.overrideMode ? (a = this.__serviceProvider.get("siteRoot"), a += this.__serviceProvider.get("startMode") + "/", this.__serviceProvider.services.startSubmode && (a += this.__urlId(this.serviceProvider.get("startSubmode")) + "/"), this.__window.location.href = a) : this.__window.location.reload() }, __appleErrorCallback: function (a) { var c = this.__globalStringManager.get("Error"), e = this.__globalStringManager.get("login_dialog_unknown_login_error"); "user-disabled" === a ? e = this.__globalStringManager.get("login_dialog_disabled_error") : "user-velocity" === a ? e = this.__globalStringManager.get("login_dialog_try_again_later_error") : "user-service" === a && (e = this.__globalStringManager.get("login_dialog_try_again_later_error_server_load")); this.__dialogManager.alert({ title: c, text: e }) }, __togglePasswordVisibility: function () { var a = this.$(".login_password input"), c = "password" == a.attr("type"); a[0].setAttribute("type", c ? "text" : "password"); this.$(".toggle-password-visibility").toggleClass("icon-password-show", !c).toggleClass("icon-password-hide", c); a.focus() }, __forgotPassword: function () { this.__featureAccessManager.isElectronClient() || (this.__window.location = this.__forgotPasswordUrl) }, __showPrivacyPolicyDialog: function (a) { var c = h.PrivacyPolicyAdultDialog; a === this.__loginManager.ERROR_UNDERAGE ? c = h.PrivacyPolicyMinorsDialog : a === this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT && (c = h.PrivacyPolicyMinorsPendingDialog); return this.__dialogManager.showDialog(c) }, __getLoginDestination: function (a) { for (var c = ["logoff"], e = 0; e < c.length; e++)if (-1 < a.indexOf(c[e])) { a = "/next"; break } return a } }, h.InputMixin)) }({ Dialogs: n["@Dialogs"], NextUtil: n["@NextUtil"], UiCore: n["@UiCore"], ContextMenu: G, InputMixin: H, LoggedInPrefsManager: z, Mixin: A, PrivacyPolicyAdultDialog: u, PrivacyPolicyMinorsDialog: v, PrivacyPolicyMinorsPendingDialog: B, template: E }); L = function (h) { var d = h.Submode; return d.extend("FtuxFrontpageSubmode", { uiContextName: "ftux_frontpage_submode", className: "submode submode-ftux-frontpage ftux-layout", dependencies: "browserInfo contextMenuManager cookieManager dialogManager featureAccessManager globalNav globalStringManager googleAnalytics leanplum localStorage loginManager modeManager Promise startupModel stringManager timer uiEventReporter urlManager webGL window".split(" "), trackedEvents: function () { return [{ type: "click", selector: ".id-continue", name: "lets_start", handler: this.__onClickCta }, { type: "click", selector: ".id-login", name: "login", handler: this.__showLogin.bind(this, !0, "ftux") }, { type: "click", selector: ".id-fb", name: "lets_start", handler: this.__onClickFB }, { type: "click", selector: ".id-apple", name: "apple_signin", handler: this.__onClickApple }, { type: "click", selector: ".id-apple-sdk", name: "apple_login", handler: "__onClickAppleSDK" }, { type: "click", selector: ".login", name: "login", handler: this.__onClickBottomLogIn }, { type: "click", selector: ".language", name: "language", handler: this.__changeLanguage }, { type: "click", selector: ".more-locales", name: "more_locales", handler: this.__showMoreLocalesMenu }] }, show: function () { IMVU.loadLandingVideo(); $(this.__window.landingVideoInfo.container).show(); this.__window.landingVideoInfo.video && this.__window.landingVideoInfo.video.play(); d.prototype.show.call(this); this.refreshVideoSize() }, hide: function () { d.prototype.hide.call(this) }, hasPreviouslyLoggedIn: function () { var a = this.__serviceProvider.get("loginCookieName"); return "undefined" !== typeof this.__cookieManager.get(a) }, initialize: function (a) { a.leanplum.recordEvent("user_landed"); d.prototype.initialize.call(this, a); this.__serviceProvider = a.serviceProvider; this.__dialogManager = a.dialogManager; $(this.__window).on("resize.ftux-frontpage", this.refreshVideoSize.bind(this)); this.__loadedMedia = 0; this.__passwordChanged = IMVU.optionalProperty(a, "passwordChanged", !1) || "1" == this.__cookieManager.get("password_changed") ? !0 : !1; var c = this.__serviceProvider.get("currentLocale"); c && "en" != c || (c = "www"); var e = this.__serviceProvider.get("locales"); this.__currentLocaleInfo = void 0; this.__otherLocaleInfo = []; this.__remainderLocaleInfo = []; var b = 0; e = $jscomp.makeIterator(e); for (var f = e.next(); !f.done; f = e.next())(f = f.value) && f.url && (f.url = decodeURI(f.url.replace(/\+/g, " ").replace(/%2F/gi, "/").replace(/%3A/gi, ":"))), f.code == c ? this.__currentLocaleInfo = f : 2 > b && -1 != ["es", "pt", "www"].indexOf(f.code) ? (this.__otherLocaleInfo.push(f), ++b) : this.__remainderLocaleInfo.push(f); this.__parentMode.hasOwnProperty("getConnectionTier") ? this.__parentMode.getConnectionTier().then(function () { this.addToDOM() }.bind(this)) : this.addToDOM(); (c = document.querySelectorAll("#landing-video source")) && c.length && (this.__recordEvent("next_video_branch", { record: !0, branch: this.__cookieManager.get("next_video"), webmVideo: c[0].getAttribute("src"), mp4Video: c[1].getAttribute("src") }), this.__uiEventReporter.flush()); this.__socialLogin = this.__loginManager.getSocialLogin(); this.__browserInfo = a.browserInfo; this.hasPreviouslyLoggedIn() && this.__showLogin() }, delete: function () { $(this.__window).off("resize.ftux-frontpage"); this.__loadedMedia = 0; _.each(this.__waitingImgs, function (a) { $(a).off("load") }.bind(this)); _.each(this.__waitingVideos, function (a) { $(a).off("loadeddata") }.bind(this)); this.__window.landingVideoInfo.video && $(this.__window.landingVideoInfo.video).off("loadeddata"); d.prototype.delete.call(this) }, isAllMediaLoaded: function () { var a = this.__waitingImgs.length + this.__waitingVideos.length + 1; this.__window.landingVideoInfo.isAlreadyLoaded && a++; return this.__loadedMedia >= a }, __showMoreLocalesMenu: function (a) { a.preventDefault(); for (var c = [], e = {}, b = $jscomp.makeIterator(this.__remainderLocaleInfo), f = b.next(); !f.done; e = { $jscomp$loop$prop$localeInfo$3: e.$jscomp$loop$prop$localeInfo$3 }, f = b.next())e.$jscomp$loop$prop$localeInfo$3 = f.value, c.push({ name: e.$jscomp$loop$prop$localeInfo$3.code, text: e.$jscomp$loop$prop$localeInfo$3.name, handler: function (g) { return function () { var k = g.$jscomp$loop$prop$localeInfo$3.code; this.__featureAccessManager.isElectronClient() ? (this.__localStorage.setItem("lang", k), this.__window.location.reload()) : ("" === k ? this.__cookieManager.clear("saved_locale") : this.__cookieManager.set("saved_locale", k), this.__window.location.href = a.target.getAttribute("href")) } }(e).bind(this) }); this.__contextMenuManager.showMenu(a, h.ContextMenu, { items: c, displayOptions: { above: !0, right: !0 } }) }, __changeLanguage: function (a) { a.preventDefault(); var c = a.target.getAttribute("data-code"); this.__featureAccessManager.isElectronClient() ? (this.__localStorage.setItem("lang", c), this.__window.location.reload()) : ("" === c ? this.__cookieManager.clear("saved_locale") : this.__cookieManager.set("saved_locale", c), this.__window.location.href = a.target.getAttribute("href")) }, __onLandingVideoLoaded: function () { $(this.__window).trigger("resize") }, __onAnyMediaLoaded: function () { this.__loadedMedia++; this.isAllMediaLoaded() && (this.__recordEvent("ftux_front_page_load_time", { record: !0, time: (Date.now() - this.__window.loadStartTime) / 1e3 }), this.__modeManager.recordPageReady(), this.__uiEventReporter.flush(), "function" === typeof this.__parentMode.maybeShowGDPRDialog && this.__parentMode.maybeShowGDPRDialog()) }, render: function () { d.prototype.render.call(this); this.__globalNav.setText(this.__globalStringManager.get("WELCOME TO IMVU")); this.$el.html(h.template({ currentLocale: this.__currentLocaleInfo, otherLocales: this.__otherLocaleInfo, canSeeAppleSignIn: this.__featureAccessManager.canSeeAppleSignIn(), adchoicesUrl: this.__urlManager.get("opt_out_third_party") })); this.__waitingImgs = this.$("img"); this.__waitingVideos = this.$("video"); _.each(this.__waitingImgs, function (a) { $(a).on("load", this.__onAnyMediaLoaded.bind(this)) }.bind(this)); _.each(this.__waitingVideos, function (a) { $(a).on("loadeddata", this.__onAnyMediaLoaded.bind(this)) }.bind(this)); $(this.__window.landingVideoInfo.video).on("loadeddata", this.__onLandingVideoLoaded.bind(this)); this.__onAnyMediaLoaded(); this.__window.landingVideoInfo.isAlreadyLoaded && (this.__onAnyMediaLoaded(), this.__onLandingVideoLoaded()); this.__parentMode.show2dAvatar && !this.__webGL.use3d() && (this.__parentMode.show2dAvatar({ gender: "female", $parentElement: this.$(".ftux-avatar-cache"), parentContext: this, allowDuplicates: !0 }), this.__parentMode.show2dAvatar({ gender: "male", $parentElement: this.$(".ftux-avatar-cache"), parentContext: this, allowDuplicates: !0 })) }, refreshVideoSize: function () { var a = $(this.__window.landingVideoInfo.container), c = $(this.__window.landingVideoInfo.video); c.addClass("is-refreshed"); !c.hasClass("is-full-height") && c.height() < a.height() && c.addClass("is-full-height"); c.hasClass("is-full-height") && c.width() < a.width() && c.removeClass("is-full-height") }, __onClickCta: function () { IMVU.removeLandingVideo(); this.__globalNav.toggleLogo(!0); this.__googleAnalytics.recordClick("welcome", "get started"); "mobile" === this.__serviceProvider.get("platform") ? "iOS" === this.__browserInfo.getMobileOS() ? this.__window.location = "itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8" : "Android" === this.__browserInfo.getMobileOS() ? this.__window.location = "https://play.google.com/store/apps/details?id=com.imvu.mobilecordova" : this.__window.location = "https://about.imvu.com/mobile/" : this.__redirectToFtux() }, __redirectToFtux: function () { this.$el.fadeOut(300, function () { this.__modeManager.openMode({ mode: { id: "ftux" }, submode: { id: "gender" } }) }.bind(this)) }, __onClickFB: function () { var a = this; "mobile" === this.__serviceProvider.get("platform") ? this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this), function () { a.__dialogManager.confirm({ title: a.__globalStringManager.get("ftux_frontpage_get_the_app"), text: a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"), yes: a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"), no: a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn") }).finished.then(function () { this.__onClickCta() }.bind(a)) }) : this.__featureAccessManager.isElectronClient() ? this.__window.navigator.onLine ? this.__socialLogin.fbOauthLogin(this.__imvuLoginCallback.bind(this), this.__redirectToFtux.bind(this)) : this.__dialogManager.alert({ title: this.__globalStringManager.get("generic_offline_error_title"), text: this.__globalStringManager.get("generic_offline_error_message") }) : this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this), this.__redirectToFtux.bind(this)) }, __onClickApple: function () { var a = this; "mobile" === this.__serviceProvider.get("platform") ? this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this), function () { a.__dialogManager.confirm({ title: a.__globalStringManager.get("ftux_frontpage_get_the_app"), text: a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"), yes: a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"), no: a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn") }).finished.then(function () { this.__onClickCta() }.bind(a)) }, this.__appleErrorCallback.bind(this)) : this.__featureAccessManager.isElectronClient() ? this.__window.navigator.onLine ? this.__socialLogin.appleOauthLogin(this.__imvuLoginCallback.bind(this), this.__redirectToFtux.bind(this), this.__appleErrorCallback.bind(this)) : this.__dialogManager.alert({ title: this.__globalStringManager.get("generic_offline_error_title"), text: this.__globalStringManager.get("generic_offline_error_message") }) : this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this), this.__redirectToFtux.bind(this), this.__appleErrorCallback.bind(this)) }, __appleErrorCallback: function (a) { var c = this.__globalStringManager.get("Error"), e = this.__globalStringManager.get("login_dialog_unknown_login_error"); "user-disabled" === a ? e = this.__globalStringManager.get("login_dialog_disabled_error") : "user-velocity" === a ? e = this.__globalStringManager.get("login_dialog_try_again_later_error") : "user-service" === a && (e = this.__globalStringManager.get("login_dialog_try_again_later_error_server_load")); this.__dialogManager.alert({ title: c, text: e }) }, __imvuLoginCallback: function () { var a = new URL(this.__window.location.href).searchParams; a && a.get("next") ? (a = a.get("next"), this.__window.location.href = decodeURIComponent(a)) : this.__loginDestination ? this.__window.location.href = decodeURIComponent(this.__loginDestination) : this.__loginManager.getLoginDestination() ? this.__window.location.href = this.__loginManager.getLoginDestination() : this.__serviceProvider.services.overrideMode && "ftux" !== this.__serviceProvider.services.overrideMode ? (a = this.__serviceProvider.get("siteRoot"), a += this.__serviceProvider.get("startMode") + "/", this.__serviceProvider.services.startSubmode && (a += this.__urlId(this.serviceProvider.get("startSubmode")) + "/"), this.__window.location.href = a) : this.__window.location.reload() }, __showLogin: function (a, c) { c = c || "ftux"; a && this.__googleAnalytics.recordClick("welcome", "show login"); this.__loginDialog = this.__globalNav.showLoginDialog({ loginMode: c }).then(function (e) { "signup" == e && this.__onClickCta() }.bind(this)) }, __onClickBottomLogIn: function () { var a = this.__serviceProvider.get("loginDestination") || this.__serviceProvider.get("siteRoot").replace("welcome", "next"); this.__loginDialog = this.__dialogManager.showDialog(h.LoginDialog, { loginDestination: a, isFrontpage: !0 }) } }) }({ UiCore: n["@UiCore"], ContextMenu: G, LoginDialog: E, Submode: p, template: L }); G = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '<div class="ftux-body loading">\n    <div class="gender">\n        <div class="avatar-container">\n            <div class="gender-wrapper">\n                <div class="female-wrapper">\n                    <div class="dgf" data-gender="female"></div>\n                </div>\n                <div class="male-wrapper">\n                    <div class="dgm" data-gender="male"></div>\n                </div>\n            </div>\n            <div class="gender-buttons">\n                <div class="gender-buttons-inner">\n                    <button class="btn btn-ghost female">'; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "gender_f", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</button>\n                    <button class="btn btn-ghost male">', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "gender_m", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="dca hidden" data-gender>\n        <div class="avatar-container"></div>\n        <button class="go-back-button">', f = a.icon || d && d.icon || c, b = f.call(d, "icon-ftux-back-arrow", { name: "icon", hash: {}, data: e }), (b || 0 === b) && (g += b), g + ' <span>back</span></button>\n    </div>\n    <div class="slide-in main-content" data-gender></div>\n</div>\n' }, useData: !0 }) }({}); E = function (h) { return IMVU.BaseClass.extend("InventoryManager", { dependencies: "ftuxState Promise rest restModelFactory startupModel window".split(" "), initialize: function (d) { this.__Promise = d.Promise; this.__rest = d.rest; this.__restModelFactory = d.restModelFactory; this.__startupModel = d.startupModel; this.__ftuxState = d.ftuxState; this.__window = d.window; this.__ftuxState.on("setGender", this.__fetchProducts, this); this.__fetchProducts() }, __fetchProducts: function () { this.__gender = this.__ftuxState.getGender(); this.__productCollectionResolver = void 0; this.__productCollectionPromise = new this.__Promise(function (d) { this.__productCollectionResolver = d }.bind(this)); this.__initialGenderProductsResolver = void 0; this.__initialGenderProductsPromise = new this.__Promise(function (d) { this.__initialGenderProductsResolver = d }.bind(this)); this.__ftuxModelResolver = void 0; this.__ftuxModelPromise = new this.__Promise(function (d) { this.__ftuxModelResolver = d }.bind(this)); this.__startupModel.populated().then(function (d) { return d.getSingleEdge("dress_up_ftux").populated() }.bind(this)).then(function (d) { this.__ftuxModelResolver.resolve(d); this.__collection = this.__restModelFactory.searchCollection(d.get("dress_up_reg"), { gender: this.__gender }, h.UiCore.NodeCollection); this.__collection.populated().then(function () { this.__productCollectionResolver.resolve(this.__collection) }.bind(this)).catch(function (a) { this.__window.console.error(a); this.__productCollectionResolver.reject() }.bind(this)); this.genderInitialLookUrl = d.get(this.__gender + "_reg"); this.__rest.get(this.genderInitialLookUrl).then(function (a) { this.__initialGenderProductsResolver.resolve(a.response.products) }.bind(this)).catch(function (a) { this.__window.console.error(a); this.__initialGenderProductsResolver.reject() }.bind(this)) }.bind(this)).catch(function (d) { this.__window.console.error(d); this.__ftuxModelResolver.reject() }.bind(this)) }, getProductCollectionPromise: function () { return this.__productCollectionPromise }, getInitialGenderProductsPromise: function () { return this.__initialGenderProductsPromise }, getFtuxModelPromise: function () { return this.__ftuxModelPromise }, randomize: function () { var d, a = new this.__Promise(function (b) { d = b }.bind(this)), c = []; "male" === this.__gender ? c.push(191) : c.push(80); var e = {}; this.__productCollectionPromise.then(function (b) { b.each(function (f) { f = this.__randomOne(f.get("items")); c.push(f.product_id) }.bind(this)); b = this.__ftuxState.getEquippedItems(); e.remove = _.difference(b, c); e.add = _.difference(c, b); e.add.push(13759128); d.resolve({ randomizedProductIds: c, changes: e }) }.bind(this)).catch(function (b) { this.__window.console.error(b); d.reject() }.bind(this)); return a }, __randomOne: function (d) { return d[Math.floor(Math.random() * d.length)] } }) }({ UiCore: n["@UiCore"], FtuxState: y }); v = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '<div class="undo-redo_menu">\n    <a href="javascript:;" class="undo-btn disabled" title="Undo">'; return f = a.icon || d && d.icon || c, b = f.call(d, "icon-undo", { name: "icon", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</a>\n    <a href="javascript:;" class="redo-btn disabled" title="Redo">', f = a.icon || d && d.icon || c, b = f.call(d, "icon-redo", { name: "icon", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</a>\n</div>\n<div class="has-menu">\n    <nav class="magic-line-menu bar disable-text-selection">\n        <div class="product-category ftux-category-container center-nav-container">\n            <ul class="center-nav dna-categories">\n                <li data-category="hair">', f = a.i18n || d && d.i18n || c, b = f.call(d, "Hair", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</li>\n                <li data-category="facial_hair">', f = a.i18n || d && d.i18n || c, b = f.call(d, "Facial Hair", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</li>\n                <li data-category="eyes">', f = a.i18n || d && d.i18n || c, b = f.call(d, "Eyes", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</li>\n                <li data-category="heads">', f = a.i18n || d && d.i18n || c, b = f.call(d, "Heads", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</li>\n                <li data-category="skins">', f = a.i18n || d && d.i18n || c, b = f.call(d, "Skins", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</li>\n            </ul>\n            <ul class="center-nav clothing-categories hidden">\n                <li data-category="tops">', f = a.i18n || d && d.i18n || c, b = f.call(d, "Tops", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</li>\n                <li data-category="bottoms">', f = a.i18n || d && d.i18n || c, b = f.call(d, "Bottoms", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</li>\n                <li data-category="shoes">', f = a.i18n || d && d.i18n || c, b = f.call(d, "Shoes", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</li>\n                <li data-category="accessories">', f = a.i18n || d && d.i18n || c, b = f.call(d, "Accessories", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</li>\n            </ul>\n            <div class="magic-line"></div>\n        </div>\n        <div class="ftux-category-simple-scroller-placeholder"></div>\n    </nav>\n\n    <div class="ftux-product ftux-product-list">\n        <section class="is-list">\n            <article class="tile product-tile template"><img src></article>\n        </section>\n    </div>\n\n</div>\n\n\n<div class="ftux-footer">\n    <button class="btn btn-primary btn-select-clothing">', f = a.i18n || d && d.i18n || c, b = f.call(d, "select_clothing", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</button>\n    <button class="btn btn-primary complete-avatar hidden">', f = a.i18n || d && d.i18n || c, b = f.call(d, "save_this_look", { name: "i18n", hash: {}, data: e }), (b || 0 === b) && (g += b), g + "</button>\n</div>" }, useData: !0 }) }({}); B = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function () { return '<div class="slidein-body">\n    <div class="slidein-main"></div>\n</div>\n' }, useData: !0 }) }({}); B = function (h) { var d = h.UiCore.UiContext; return d.extend("SlideIn", { uiContextName: "slidein", className: "slidein", dependencies: ["featureAccessManager", "mode"], trackedEvents: function () { return [] }, initialize: function (a) { d.prototype.initialize.call(this, a); this.addToDOM() }, render: function () { this.$el.html(h.template); this.renderBody(this.$(".slidein-main")) }, toggle: function () { this.$el.hasClass("shown") ? this.hide() : this.show(); this.trigger("toggle") }, show: function (a) { !0 === a && this.$(".slidein-body").addClass("no-animation"); this.$el.hasClass("shown") || ((a = this.__mode.getCurrentSubmode()) && a.hideAllSlideIns(), this.$(".slidein-body").removeClass("side-slide-out"), this.$(".slidein-body").addClass("side-slide-in"), this.$el.addClass("shown"), this.trigger("show")) }, hide: function (a) { this.$el.hasClass("shown") && (a && this.$(".slidein-body").addClass("no-animation"), this.$(".slidein-body").removeClass("side-slide-in"), this.$(".slidein-body").addClass("side-slide-out"), this.$el.removeClass("shown"), this.trigger("hide")) } }) }({ UiCore: n["@UiCore"], template: B }); F = function (h) { var d = h.SlideIn; return d.extend("FtuxProductSlideIn", { uiContextName: "ftux_product_slidein", className: "slidein ftux-product-slidein light-theme", dependencies: "featureAccessManager ftuxState globalNav googleAnalytics imageManager inventoryManager mode restModelFactory startupModel stringManager timer undoRedo window".split(" "), trackedEvents: function () { return d.prototype.trackedEvents.call(this).concat([{ type: "click", selector: ".product-category li", name: "change_category", handler: this.__onChangeBodyCategory }, { type: "click", selector: ".ftux-product article", name: "toggle_product", handler: this.__toggleProduct }, { type: "click", selector: ".btn-select-clothing", name: "select_clothing", handler: this.showClothingProducts }, { type: "click", selector: ".complete-avatar", name: "complete_avatar", handler: this.__onClickCompleteAvatar }, { type: "click", selector: ".undo-btn", name: "undo", handler: this.__undo }, { type: "click", selector: ".redo-btn", name: "redo", handler: this.__redo }]) }, initialize: function (a) { this.__totalMedias = this.__loadedMedias = 0; this.__initialDefaultProducts = []; this.__timer = a.timer; this.__inventoryManager = a.inventoryManager; this.__step = a.step; this.__landedOnClothing = "clothing" === this.__step ? !0 : !1; d.prototype.initialize.call(this, a); this.refreshUndoRedo(); this.listenTo(this.__undoRedo, "change add remove", this.refreshUndoRedo) }, delete: function () { d.prototype.delete.call(this); _.each(this.__initialDefaultProducts, function (a) { a.find("img").off("load") }) }, renderBody: function (a) { a.html(h.template({})); this.$productTileTemplate = this.$("article.template"); this.$productTileTemplate.remove() }, show: function (a) { d.prototype.show.call(this, a); this.__lastGender = this.__ftuxState.getGender(); this.__inventoryManager.getFtuxModelPromise().then(function (c) { this.trigger("show:scene", c); return this.__inventoryManager.getProductCollectionPromise() }.bind(this)).then(function (c) { this.__collection = c; return this.__inventoryManager.getInitialGenderProductsPromise() }.bind(this)).then(function (c) { this.__ftuxState.isNothingEquipped() && this.__ftuxState.createEquippedItemIds(c); this.$el.parents(".slide-in").attr("data-gender", this.__lastGender); this.__landedOnClothing ? (this.showClothingProducts(), this.__landedOnClothing = !1) : this.showDnaProducts(); this.__isInitialDefaultProducts = !0; this.__scrollerRefreshScrollability(); this.__isInitialDefaultProducts = !1 }.bind(this)).catch(function (c) { this.__window.console.error(c) }.bind(this)) }, hide: function () { d.prototype.hide.call(this, !1) }, setupScroller: function () { this.__categoryScroller ? this.__categoryScroller.resetPosition() : this.__categoryScroller = this.createChildContext(h.SimpleScroller, { $replaceElement: this.$(".ftux-category-simple-scroller-placeholder"), $target: this.$(".ftux-category-container.center-nav-container") }) }, getProductImageUrl: function (a) { var c = a.swatch_image; c || (c = a.preview_image + "?width=150&height=150"); return c }, disableProductEquip: function () { this.$("section article").addClass("disabled") }, enableProductEquip: function () { this.$("section article").removeClass("disabled") }, refreshUndoRedo: function () { this.$(".undo-btn").toggleClass("disabled", !this.__undoRedo.get("canUndo")); this.$(".redo-btn").toggleClass("disabled", !this.__undoRedo.get("canRedo")) }, __undo: function () { this.__googleAnalytics.recordClick("ftux_productSlidein", "undo"); this.trigger("undo:look") }, __redo: function () { this.__googleAnalytics.recordClick("ftux_productSlidein", "redo"); this.trigger("redo:look") }, __showBodyCategory: function (a) { this.__bodyCategory = a; var c = this.$('.product-category li[data-category="' + a + '"]'); h.NextUtil.DomHelper.radioClass(c, "active"); this.$(".magic-line").css({ "margin-left": c.position().left + "px", width: c.outerWidth() }); this.__populateCarousel(a); this.$(".ftux-product-list").scrollbar().scrollTop(0); this.__2dAvatar && this.trigger("change:2dAvatar", a); this.trigger("show:body", a) }, __scrollerRefreshScrollability: function () { this.__categoryScroller && this.__categoryScroller.refreshScrollability() }, __onChangeBodyCategory: function (a) { this.__showBodyCategory($(a.currentTarget).attr("data-category")) }, __populateProductTile: function (a) { var c = this.$productTileTemplate.clone(); c.removeClass("template"); c.toggleClass("added", _.contains(this.__ftuxState.getEquippedItems(), a.product_id)); c.attr("data-pid", a.product_id); this.__isInitialDefaultProducts && (this.__initialDefaultProducts.push(c), c.find("img").on("load", function () { this.__mediaLoaded() }.bind(this))); this.__imageManager.load(c.find("img"), this.getProductImageUrl(a), { container: c }); this.$(".ftux-product section").append(c) }, __populateProductTileList: function (a) { _.each(a, function (c) { this.__populateProductTile(c) }.bind(this)); this.$(".ftux-product-list").scrollbar() }, __populateCarousel: function (a) { this.$(".ftux-product section").html(""); this.__collection.each(function (c) { c.get("name") === a && (this.__isInitialDefaultProducts && (this.__totalMedias = c.get("items").length + 1, this.__totalMedias === this.__loadedMedias && this.__onFinishedLoading()), this.__populateProductTileList(c.get("items"))) }.bind(this)) }, __toggleProduct: function (a) { a = $(a.currentTarget); var c = this.__bodyCategory, e = a.attr("data-pid"), b = {}; "accessories" !== c && "facial_hair" !== c && a.hasClass("added") || a.hasClass("disabled") || (this.disableProductEquip(), "accessories" === c ? (a.toggleClass("added"), a.hasClass("added") ? b.add = e : b.remove = e) : "facial_hair" === c ? a.hasClass("added") ? (b.remove = e, a.removeClass("added")) : (b.add = e, h.NextUtil.DomHelper.radioClass(a, "added")) : (h.NextUtil.DomHelper.radioClass(a, "added"), b.add = e), this.trigger("change:look", b)) }, showDnaProducts: function () { this.__inventoryManager.getProductCollectionPromise().then(function () { this.__inventoryManager.getInitialGenderProductsPromise().then(function () { this.__collection && this.__collection.length && (this.$(".dna-categories").removeClass("hidden"), this.$(".clothing-categories").addClass("hidden"), this.$(".btn-select-clothing").removeClass("hidden"), this.$(".complete-avatar").addClass("hidden"), this.__showBodyCategory("hair"), this.setupScroller()) }.bind(this)).catch(function (a) { this.__window.console.error(a) }.bind(this)) }.bind(this)).catch(function (a) { this.__window.console.error(a) }.bind(this)) }, showClothingProducts: function () { this.__inventoryManager.getProductCollectionPromise().then(function () { this.__inventoryManager.getInitialGenderProductsPromise().then(function () { this.__collection && this.__collection.length && (this.trigger("show:clothing"), this.$(".dna-categories").addClass("hidden"), this.$(".clothing-categories").removeClass("hidden"), this.$(".btn-select-clothing").addClass("hidden"), this.$(".complete-avatar").removeClass("hidden"), this.__showBodyCategory("tops"), this.setupScroller()) }.bind(this)).catch(function (a) { this.__window.console.error(a) }.bind(this)) }.bind(this)).catch(function (a) { this.__window.console.error(a) }.bind(this)) }, markEquippedProducts: function (a) { this.$("article.product-tile").toggleClass("added", !1); a.forEach(function (c) { this.$('article.product-tile[data-pid="' + c + '"]').toggleClass("added", !0) }.bind(this)) }, __onClickCompleteAvatar: function () { this.__globalNav.setText(this.__stringManager.get("save_this_look_nav")); this.hide(); this.__slideOuttime = this.__timer.setTimeout(function () { this.trigger("show:body", "tops"); this.trigger("show:registration") }.bind(this), 300); "creatorlanding" === this.__serviceProvider.get("modeManager").uiApplication && this.__window.pintrk("track", "signup", { lead_type: "click_create_account" }) } }) }({ NextUtil: n["@NextUtil"], UiCore: n["@UiCore"], SimpleScroller: F, SlideIn: B, template: v }); v = function (h) { h = { yawRate: 15, zoomRate: 10 }; return { dressUp: { zoomDistanceMin: 2, zoomDistanceMax: 10, zoomInitial: 5, zoomSensitivity: { mousemove: .2, mousewheel: -.05 }, zoomRate: h.zoomRate, lookAtHeightNearHeadOffset: 0, camHeightFar: .9, pathSegments: [[3, 8, .05, .003], [3, 9, .1, .007], [null, 11, .2, .01]], pitch: 8, yawRate: h.yawRate, panSensitivity: { x: 0, y: 1 }, headInterpolate: { horzRatio: .3, vertRatio: .3 } }, room: { zoomDistanceMin: .1, firstPersonViewSwitchDistance: 1.6, zoomDistanceMax: 100, zoomInitial: 5, zoomSensitivity: { mousemove: .2, mousewheel: -.01 }, zoomRate: h.zoomRate, lookAtHeightNearHeadOffset: .17, camHeightFar: 2, pathSegments: [[1, -2, .1, .001], [.7, 0, .02, .001], [3, 6, .2, .002], [4, 8, .5, .005], [7, 9, 1, .008], [15, 10, 2, .015], [40, 11, 3, .02], [null, 10, 4, .07]], pitch: 10, yawRate: h.yawRate, panSensitivity: { x: 1, y: 1 }, headInterpolate: { horzRatio: .14, vertRatio: .08 } }, universal: h } }({}); M = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f, g = a.helperMissing, k = '<div class="ftux-registration-form">\n    <form method="GET" action="#" accept-charset="utf-8">\n        <div class="avatar-name-container">\n            <div class="avatar">\n                <img src="" />\n            </div>\n            <h2 class="welcome">'; return f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_welcome_to_imvu", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</h2>\n            <div class="label signup_avatarname" data-holder="', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_avatar_name_placeholder", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '">\n                <label class="avatar-name">\n                        <input type="text" name="signup_avatarname" placeholder="', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_avatar_name_placeholder", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '" autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" max="20" maxlength="20" min="1"/>\n                </label>\n            </div>\n        </div>\n        <div class="label signup_displayname" data-holder="', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_display_name_cover", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '">\n            <input class="signup_displayname_input" tabindex="1" type="text" name="signup_displayname" placeholder="', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_display_name_cover", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '" autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" max="30" maxlength="30" min="3"/>\n        </div>\n        <div class="label signup_email" data-holder="', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_email_cover", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '">\n            <input class="signup_email_input" tabindex="2" type="email" name="signup_email" placeholder="', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_email_cover", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '" autocapitalize="none" autocorrect="off" spellcheck="false" autocomplete="off" />\n        </div>\n\n        <fake_fields>\n            \x3c!-- fake fields are a workaround for chrome autofill getting the wrong fields --\x3e\n            <input type="text" name="fakeusernameremembered"  autocomplete="off" />\n            <input type="password" name="fakepasswordremembered"/>\n        </fake_fields>\n\n        <div class="label signup_password" data-holder="', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_email_password", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '">\n            ', b = this.invokePartial(c.InputMixinHolderLabel, "InputMixinHolderLabel", d, { content: d && d.passwordTooltipContent }, a, c, e), (b || 0 === b) && (k += b), k += '\n            <div style="position:relative">\n                <input tabindex="3" type="password" name="signup_password" placeholder="', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_email_password", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '" min="6" />\n                <div class="toggle-password-visibility icon icon-password-show"></div>\n            </div>\n        </div>\n        <div class="label signup_dob" data-dropdown data-holder="', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_birthday_cover", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '">\n            ', b = this.invokePartial(c.InputMixinHolderLabel, "InputMixinHolderLabel", d, { content: d && d.dobTooltipContent, defaultLabel: d && d.dobDefaultLabel }, a, c, e), (b || 0 === b) && (k += b), k += '\n            <div class="date-picker"></div>\n        </div>\n\n        <div class=\'funcaptcha-wrapper\'>\n        </div>\n\n        <div class="error-message-container">\n            <div class="error-message error-message-left funcaptcha">', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_error_funcaptcha", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n            <div class="error-message error-message-left unknown">', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_error_unknown", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n            <div class="error-message error-message-left underage">', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_dialog_error_underage", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</div>\n        </div>\n    </form>\n</div>\n\n<footer class="ftux-reg-footer">\n    <button disabled class="btn btn-primary submit">', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "signup_slidein_submit_button_ftux", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += '</button>\n    <p class="tos small-tos">', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "register_TOS", { name: "i18n-g", hash: { arbitrationTag: '<a href="https://secure.imvu.com/next/policyhub/termsofservice#arbitrationagreement" target="_blank">', linkEndTag: "</a>", privacyStartTag: '<a data-external href="https://secure.imvu.com/next/policyhub/privacypolicy/" target="_blank">', termsStartTag: '<a class="reg-tos" data-external href="https://secure.imvu.com/next/policyhub/" target="_blank">' }, data: e }), (b || 0 === b) && (k += b), k + "</p>\n</footer>\n" }, usePartial: !0, useData: !0 }) }({}); var N = function (h) { function d(a) { return 26 > a ? a + 65 : 52 > a ? a + 71 : 62 > a ? a - 4 : 62 === a ? 43 : 63 === a ? 47 : 65 } return { decode: function (a, c) { a = a.replace(/[^A-Za-z0-9\+\/]/g, ""); var e = a.length; c = c ? Math.ceil((3 * e + 1 >> 2) / c) * c : 3 * e + 1 >> 2; for (var b = new Uint8Array(c), f, g = 0, k = 0, m = 0; m < e; m++) { f = m & 3; var l = a.charCodeAt(m); g |= (64 < l && 91 > l ? l - 65 : 96 < l && 123 > l ? l - 71 : 47 < l && 58 > l ? l + 4 : 43 === l ? 62 : 47 === l ? 63 : 0) << 18 - 6 * f; if (3 === f || 1 === e - m) { for (f = 0; 3 > f && k < c; f++ , k++)b[k] = g >>> (16 >>> f & 24) & 255; g = 0 } } return b }, encode: function (a) { for (var c = 2, e = "", b = a.length, f = 0, g = 0; g < b; g++)if (c = g % 3, 0 < g && 0 === 4 * g / 3 % 76 && (e += "\r\n"), f |= a[g] << (16 >>> c & 24), 2 === c || 1 === a.length - g) e += String.fromCharCode(d(f >>> 18 & 63), d(f >>> 12 & 63), d(f >>> 6 & 63), d(f & 63)), f = 0; return e.substr(0, e.length - 2 + c) + (2 === c ? "" : 1 === c ? "=" : "==") } } }({}), O = function (h) { function d(e) { return void 0 !== e ? decodeURIComponent(e.replace(/\+/g, "%20")) : "" } function a(e) { var b = {}; 0 < e.length && (e = e.substring(1), e = e.split("&"), _.each(e, function (f) { var g = f.split("="); f = d(g[0]); g = d(g[1]); if (c.test(f)) if (c.exec(f)[1]) { var k = f.replace(c, ""); k in b || (b[k] = {}); b[k][c.exec(f)[1]] = g } else f = f.replace(c, ""), f in b || (b[f] = []), b[f].push(g); else b[f] = g })); return b } var c = /\[(.*?)\]/; return { fetch: function (e, b) { var f = a(e.location.search), g = _.pick(f, b); b = _.omit(f, b); f = e.location.pathname; _.size(b) && (f += "?" + $.param(b)); e.history.replaceState(e.history.state, document.title, f); return g }, get: function (e, b) { return a(e.location.search)[b] }, getAllParams: a } }({}); N = function (h) { function d(a, c) { c = h.Base64.decode(c); for (var e = h.Base64.decode("V25kKzVxQS81SSE+M3VCfnkjO300WlFHWTZQQXtWLiUlJChFMnUsdg=="), b = new Uint8Array(c.length + e.length), f = 0; f < c.length; ++f)b[f] = c[f]; for (f = 0; f < e.length; ++f)b[c.length + f] = e[f]; c = h.Base64.encode(b); return new a(c, "B64").getHash("SHA-512", "B64") } return IMVU.BaseClass.extend("RegistrationManager", { dependencies: "campaign globalStartupModel localStorage loginManager Promise registrationFlow rest root Sha512".split(" "), initialize: function (a) { this.__Promise = a.Promise; this.__rest = a.rest; this.__localStorage = a.localStorage; this.__challengeUrl = a.root + "/challenge"; this.__accountUrl = a.root + "/" + (null !== this.__localStorage.getItem("accountEndpoint") ? this.__localStorage.getItem("accountEndpoint") : "account"); this.__validateUrl = a.root + "/validate_account"; this.__suggestedAvatarnameUrl = a.root + "/generated_avatarname"; this.__globalStartupModel = a.globalStartupModel; this.__sha512 = a.Sha512; this.__registrationFlow = a.registrationFlow; this.__serviceProvider = new h.UiCore.ServiceProvider; this.__window = this.__serviceProvider.get("window"); this.__setCab(this.__window.location.search, a); this.__loginManager = a.loginManager; this.__socialLogin = this.__loginManager.getSocialLogin() }, __setCab: function (a, c) { a = h.QueryParams.getAllParams(a); var e = []; void 0 !== a.affid && e.push(a.affid); void 0 !== a.subid1 && e.push(a.subid1); void 0 !== a.subid2 && e.push(a.subid2); 0 === e.length && "" !== c.campaign && e.push(c.campaign); this.customers_acquired_by = e.join("_") }, getChallenge: function () { return this.__rest.post(this.__challengeUrl, { type: "alloy" }).then(function (a) { return this.__Promise.resolve(a.response.data.challenge) }.bind(this)) }, register: function (a, c) { var e = this, b = IMVU.requireProperty(c, "dob"), f = IMVU.requireProperty(c, "fc_token"), g = IMVU.requireProperty(c, "locale"), k = { avatarname: IMVU.requireProperty(c, "avatarname"), device_id: IMVU.requireProperty(c, "device_id"), email: IMVU.requireProperty(c, "email"), location: { country: "US", region: "" }, profile_info: { dob: b.toISOString() }, reg_token: { challenge: a, response: d(this.__sha512, a), type: "alloy" }, customers_acquired_by: this.customers_acquired_by, fc_token: f, registration_flow: this.__registrationFlow, external: { hasoffers: _.reduce("transaction_id offer_id aff_sub aff_sub2 aff_sub3 aff_sub4 aff_sub5 affiliate_id affiliate_name currency payout offer_name".split(" "), function (m, l) { m[l] = this.__globalStartupModel.get("hasOffers." + l); return m }.bind(this), {}) } }; return this.__socialLogin.getAuth().then(function () { e.__socialLogin.isLoggedIn() || null !== e.__socialLogin.getAppleRefreshToken() ? k.social_registration = IMVU.requireProperty(c, "social_registration") : k.password = IMVU.requireProperty(c, "password"); var m = c.displayname; m && (k.display_name = m); c.pids && 0 < c.pids.length && (k.products = c.pids.map(function (l) { return l + "" })); return e.__rest.post(e.__accountUrl, k, { headers: { "Accept-Language": g } }).catch(function (l) { return this.__Promise.reject(l.error) }.bind(e)) }) }, validate: function (a) { return this.__rest.post(this.__validateUrl, a).then(function (c) { return this.__Promise.resolve(c.response.data) }.bind(this)) }, getSuggestedAvatarname: function (a) { var c = IMVU.requireProperty(a, "displayname"); a = IMVU.requireProperty(a, "email"); return this.__rest.get(this.__buildSuggestedAvatarnameUrl(c, a)).then(function (e) { return this.__Promise.resolve(e.response.data) }.bind(this)) }, __buildSuggestedAvatarnameUrl: function (a, c) { return this.__suggestedAvatarnameUrl + "?display_name=" + encodeURIComponent(a) + "&email_address=" + encodeURIComponent(c) } }) }({ UiCore: n["@UiCore"], Base64: N, QueryParams: O }); O = function (h) { return IMVU.BaseClass.extend("AvatarName", { dependencies: ["Promise", "restModelFactory", "root"], initialize: function (d) { this.__url = d.root + "/avatar_name"; this.__restModelFactory = d.restModelFactory; this.__Promise = d.Promise }, getAvailable: function (d) { var a = this.__restModelFactory.searchCollection(this.__url, { avatar: d }, h.UiCore.NodeCollection); return a.populated().then(function () { return 1 === a.length && a.at(0).get("avatar") === d ? this.__Promise.resolve({ available: !0, suggestions: [] }) : this.__Promise.resolve({ available: !1, suggestions: a.pluck("avatar") }) }.bind(this), function () { return this.__Promise.reject({ error: !0 }) }.bind(this)) } }) }({ UiCore: n["@UiCore"] }); var T = function () { return { dependencies: ["globalStartupModel"], processArgs: function (h) { "undefined" !== typeof h && (this.__serviceProvider = "undefined" !== typeof h.serviceProvider ? h.serviceProvider : null, this.__globalStartupModel = null !== this.__serviceProvider ? this.__serviceProvider.get("globalStartupModel") : null, this.__window = "undefined" !== typeof h.window ? h.window : null) }, showPixel: function (h) { this.processArgs(h); h = document.createElement("script"); h.src = "/localkey.php"; document.head.appendChild(h) }, showRegistrationPixel: function (h) { this.processArgs(h); h = document.createElement("iframe"); h.classList.add("SL_norewrite"); h.setAttribute("id", "registration_pixel"); h.setAttribute("style", "position:absolute;top:0;left:0;pointer-events:none;visiblity:hidden"); h.setAttribute("width", 1); h.setAttribute("height", 1); h.setAttribute("frameborder", 0); h.setAttribute("src", this.__globalStartupModel.get("baseHostURI") + "/pixel_iframe.php?location=registration"); document.body.appendChild(h) }, showSignupPixel: function (h) { this.processArgs(h); h = document.createElement("iframe"); h.classList.add("SL_norewrite"); h.setAttribute("id", "registration_pixel"); h.setAttribute("style", "position:absolute;top:0;left:0;pointer-events:none;visiblity:hidden"); h.setAttribute("width", 1); h.setAttribute("height", 1); h.setAttribute("frameborder", 0); h.setAttribute("src", this.__globalStartupModel.get("baseHostURI") + "/pixel_iframe.php?location=signup"); document.body.appendChild(h) } } }({}), U = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = "<div class='id-dob-tooltip tooltip-target icon icon-tooltip-icon'></div>\n<div class='tooltip-content'>\n    <div class=\"tooltip-header\">"; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "signup_dialog_dob_tooltip_title", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</div>\n    <div class="tooltip-body">\n        <div>', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "signup_dialog_dob_tooltip_text", { name: "i18n-g", hash: { privacy_policy_link: d && d.privacy_policy_link }, data: e }), (b || 0 === b) && (g += b), g + "</div>\n    </div>\n</div>\n" }, useData: !0 }) }({}), V = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = a.helperMissing; var g = '<div class=\'id-password-tooltip tooltip-target icon icon-tooltip-icon\'></div>\n<div class="password-requirement-tooltip tooltip-content">\n    <div class="tooltip-header">'; return f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "Password Tips", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g += '</div>\n    <div class="tooltip-body">\n        <div>', f = a["i18n-g"] || d && d["i18n-g"] || c, b = f.call(d, "password_requirement", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (g += b), g + "</div>\n    </div>\n</div>\n" }, useData: !0 }) }({}); z = function (h) { var d = IMVU.NamedModel; return d.extend("RegisterModeModel", { dependencies: "cookieManager featureAccessManager leanplum localStorage loginManager passwordStrength Promise timer window".split(" "), initialize: function (a) { d.prototype.initialize.call(this, {}); this.__serviceProvider = a.serviceProvider; this.__Promise = a.Promise; this.__timer = a.timer; this.__registrationManager = a.registrationManager; this.__passwordStrength = a.passwordStrength; this.__leanplum = a.leanplum; this.__localStorage = a.localStorage; this.__loginManager = a.loginManager; this.__cookieManager = a.cookieManager; this.useSuggestedAvatarname = !0; this.__generateAvatarnameDelay = 500; this.__prefsManager = IMVU.optionalProperty(a, "prefsManager", h.PrefsManager); this.__window = a.window; this.__featureAccessManager = a.featureAccessManager; this.set({ avatarname: "", displayname: "", email: "", password: "", dob: null, pids: [] }); this.validity = new Backbone.Model({ avatarname: "pending", displayname: "pending", email: "pending", password: "pending", dob: "pending", fc_token: this.__serviceProvider.get("showFuncaptcha") ? "pending" : "valid" }); this.error = new Backbone.Model({ avatarname_invalid: !1, avatarname_taken: !1, displayname_invalid: !1, challenge: !1, dob_invalid: !1, email_invalid: !1, email_taken: !1, email_banned: !1, email_imvu: !1, login: !1, password_fair: !1, password_too_long: !1, password_too_short: !1, password_weak: !1, fc_token_invalid: !1, unknown: !1 }); this.errorMessage = new Backbone.Model({ displayname_invalid: "" }); this.state = new Backbone.Model({ form: "invalid" }); this.listenTo(this, "change:avatarname", this.__checkAvatarname.bind(this)); this.listenTo(this, "change:displayname", this.__checkDisplayname.bind(this)); this.listenTo(this, "change:email", this.__checkEmail.bind(this)); this.listenTo(this, "change:password", this.__checkPasswordStrength.bind(this)); this.listenTo(this, "change:dob", this.__checkDob.bind(this)); this.listenTo(this.validity, "change", this.__updateValidity.bind(this)); this.__socialLogin = this.__loginManager.getSocialLogin() }, submitRegistration: function () { this.state.set({ form: "loading" }); return new this.__Promise(function (a) { if (!this.__checkAge(this.get("dob"))) return a.reject({ temporary: !1, type: "dob_invalid" }); this.__registrationManager.getChallenge().catch(function () { a.reject({ temporary: !0, type: "challenge" }); return this.__Promise.reject() }.bind(this)).then(function (c) { var e = this.get("fc_token"), b = ""; b = this.__featureAccessManager.isElectronClient() ? this.__localStorage.getItem("lang") : this.__cookieManager.get("saved_locale"); e = { avatarname: this.get("avatarname"), displayname: this.get("displayname"), email: this.get("email"), device_id: "", dob: this.get("dob"), pids: this.get("pids"), fc_token: e, locale: b }; this.__socialLogin.isLoggedIn() ? e.social_registration = { platform: this.__socialLogin.getPlatform(), platform_token: this.__socialLogin.getAccessToken(), platform_uid: this.__socialLogin.getProfileItem("id") } : null !== this.__socialLogin.getAppleRefreshToken() ? e.social_registration = { platform: this.__socialLogin.getPlatform(), platform_token: this.__socialLogin.getAppleRefreshToken(), platform_uid: this.__socialLogin.getAppleUserId() } : e.password = this.get("password"); return this.__registrationManager.register(c, e).catch(function (f) { if (f) { var g = { "ERROR_ACCOUNT-2": "challenge_error", "ERROR_ACCOUNT-3": "avatarname_invalid", "ERROR_ACCOUNT-4": "avatarname_taken", "ERROR_ACCOUNT-5": "email_invalid", "ERROR_ACCOUNT-6": "email_taken", "ERROR_ACCOUNT-7": "birthday_error", "ERROR_ACCOUNT-8": "fc_token_invalid", "ERROR_ACCOUNT-9": "display_name_blank", "ERROR_ACCOUNT-10": "display_name_invalid_string", "ERROR_ACCOUNT-11": "display_name_invalid_length", "ERROR_ACCOUNT-12": "display_name_inappropriate", "ERROR_ACCOUNT-13": "display_name_inappropriate", "ERROR_ACCOUNT-14": "display_name_wrapping_spaces", "ERROR_ACCOUNT-15": "display_name_at_sign", "ERROR_ACCOUNT-16": "display_name_persona", "ERROR_ACCOUNT-17": "display_name_multiple_spaces", "ERROR_ACCOUNT-18": "fun_captcha_answer_wrong", "ERROR_ACCOUNT-22": "social_credentials_already_in_use" }[f.error] || "unknown"; a.reject({ temporary: "unknown" === g, type: g, code: f.error }) } return this.__Promise.reject(f) }.bind(this)) }.bind(this)).then(function (c) { c = { username: this.get("avatarname") || c.response.data.avatarname, password: this.get("password"), gdpr_cookie_acceptance: "true" === this.__cookieManager.get("accepted_all_cookies") ? !0 : !1 }; this.__socialLogin.isLoggedIn() ? c = { platform: this.__socialLogin.getPlatform(), platform_token: this.__socialLogin.getAccessToken(), platform_uid: this.__socialLogin.getProfileItem("id") } : null !== this.__socialLogin.getAppleRefreshToken() && (c = { platform: this.__socialLogin.getPlatform(), platform_token: this.__socialLogin.getAppleRefreshToken(), platform_uid: this.__socialLogin.getAppleUserId() }); return this.__loginManager.performLoginFromCredentials(this.__serviceProvider, c).catch(function () { a.reject({ temporary: !0, type: "login" }); return this.__Promise.reject() }.bind(this)) }.bind(this)).then(function () { this.__cookieManager.set("login_username", this.get("email")); this.__prefsManager = this.__serviceProvider.create(this.__prefsManager); this.__prefsManager.populated().then(function () { null !== this.__localStorage.getItem("__leanplum_device_id") ? this.__prefsManager.set("next.leanplum_device_id", this.__localStorage.getItem("__leanplum_device_id")) : this.__window.console.log("no __leanplum_device_id found"); this.__prefsManager.setBool("next.should_show_sticky_daily_spin_toaster", !0) }.bind(this)); a.resolve() }.bind(this)) }.bind(this)).catch(function (a) { var c = {}; c[a.type] = !0; this.error.set(c); this.state.set({ form: a.temporary ? "valid" : "invalid" }); "avatarname_invalid" === a.type || "avatarname_taken" === a.type ? this.validity.set({ avatarname: "invalid" }) : "email_invalid" === a.type || "email_taken" === a.type || "email_banned" === a.type || "email_imvu" === a.type ? this.validity.set({ email: "invalid" }) : "dob_invalid" === a.type ? this.validity.set({ dob: "invalid" }) : ("fc_token_invalid" === a.type || "fun_captcha_answer_wrong" === a.type) && this.validity.set({ fc_token: "invalid" }); return this.__Promise.reject(a) }.bind(this)) }, __updateValidity: function () { this.state.set({ form: this.__allDataValid() ? "valid" : "invalid" }) }, __allDataValid: function () { var a = "valid" === this.validity.get("avatarname") && "valid" === this.validity.get("displayname") && "valid" === this.validity.get("email") && "valid" === this.validity.get("dob") && "valid" === this.validity.get("fc_token"); "undefined" === typeof this.__socialLogin || this.__socialLogin.isLoggedIn() || null !== this.__socialLogin.getAppleRefreshToken() || (a = a && "valid" === this.validity.get("password")); return a }, __checkAvatarname: function () { this.error.set({ avatarname_taken: !1, avatarname_invalid: !1 }); if (this.useSuggestedAvatarname) this.validity.set({ avatarname: "valid" }); else { var a = this.get("avatarname"); "" === a ? this.validity.set({ avatarname: "pending" }) : 3 > a.length || 20 < a.length || !/^[a-z0-9]*$/i.test(a) ? (this.validity.set({ avatarname: "invalid" }), this.error.set({ avatarname_taken: !1, avatarname_invalid: !0 })) : (this.validity.set({ avatarname: "loading" }), this.__registrationManager.validate({ avatarname: this.get("avatarname") }).then(function (c) { c.valid ? (this.validity.set({ avatarname: "valid" }), this.error.set({ avatarname_taken: !1, avatarname_invalid: !1 })) : "msg_avname_taken" === c.errors.avatarname.error_code ? (this.validity.set({ avatarname: "invalid" }), this.errorMessage.set({ avatarname_invalid: c.errors.avatarname.error_message }), this.error.set({ avatarname_taken: !0 })) : c.errors.avatarname.error_code && (this.validity.set({ avatarname: "invalid" }), this.errorMessage.set({ avatarname_invalid: c.errors.avatarname.error_message }), this.error.set({ avatarname_invalid: !0 })) }.bind(this), function (c) { this.validity.set({ avatarname_invalid: !0 }) }.bind(this))) } }, __checkDisplayname: function () { "" === this.get("displayname") ? (this.validity.set({ displayname: "invalid" }), this.error.set({ displayname_blank: !0 })) : (this.validity.set({ avatarname: "valid" }), this.error.set({ displayname_invalid: !1, displayname_blank: !1 }), this.__registrationManager.validate({ display_name: this.get("displayname") }).then(function (a) { a.valid ? (this.validity.set({ displayname: "valid" }), this.error.set({ displayname_invalid: !1 }), this.__generateAvatarname()) : a.errors.display_name.error_code && (this.validity.set({ displayname: "invalid" }), this.errorMessage.set({ displayname_invalid: a.errors.display_name.error_message }), this.error.set({ displayname_invalid: !0 })) }.bind(this), function (a) { this.validity.set({ displayname_invalid: "invalid" }) }.bind(this))) }, __checkPasswordStrength: function () { var a = this.get("password"), c = this.get("avatarname"); "" === a ? (this.validity.set({ password: "pending" }), this.error.set({ password_too_long: !1, password_too_short: !1, password_weak: !1, password_fair: !1 })) : (c = this.__passwordStrength.passwordStrength(a, c), "weak" === c && a.length < this.__passwordStrength.passwordMinLength && (c = "too_short"), a.length > this.__passwordStrength.passwordMaxLength && (c = "too_long"), "good" === c || "strong" === c ? (this.validity.set({ password: "valid" }), this.error.set({ password_too_long: !1, password_too_short: !1, password_weak: !1, password_fair: !1 })) : "" !== c && (this.validity.set({ password: "invalid" }), "too_short" === c ? this.error.set({ password_too_long: !1, password_too_short: !0, password_weak: !1, password_fair: !1 }) : "too_long" === c ? this.error.set({ password_too_long: !0, password_too_short: !1, password_weak: !1, password_fair: !0 }) : "weak" !== c ? this.error.set({ password_too_long: !1, password_too_short: !1, password_weak: !1, password_fair: !0 }) : "fair" !== c && this.error.set({ password_too_long: !1, password_too_short: !1, password_weak: !0, password_fair: !1 }))) }, __checkEmail: function () { var a = this.get("email"); this.validity.set({ email: "pending" }); this.error.set({ email_invalid: !1, email_taken: !1, email_banned: !1, email_imvu: !1 }); "" !== a && this.__registrationManager.validate({ email_address: a }).then(function (c) { c.valid ? (this.validity.set({ email: "valid" }), this.error.set({ email_taken: !1, email_invalid: !1, email_banned: !1, email_imvu: !1 }), this.__generateAvatarname()) : "msg_invalid_email" === c.errors.email_address.error_code ? (this.validity.set({ email: "invalid" }), this.error.set({ email_taken: !1, email_invalid: !0, email_banned: !1, email_imvu: !1 })) : "msg_email_exists" === c.errors.email_address.error_code ? (this.validity.set({ email: "invalid" }), this.error.set({ email_taken: !0, email_invalid: !1, email_banned: !1, email_imvu: !1 })) : "msg_email_banned" === c.errors.email_address.error_code ? (this.validity.set({ email: "invalid" }), this.error.set({ email_taken: !1, email_invalid: !1, email_banned: !0, email_imvu: !1 })) : "msg_imvu_email_external_ip" === c.errors.email_address.error_code && (this.validity.set({ email: "invalid" }), this.error.set({ email_taken: !1, email_invalid: !1, email_banned: !1, email_imvu: !0 })) }.bind(this), function (c) { this.validity.set({ email: "invalid" }) }.bind(this)) }, __checkAge: function (a) { var c = this.__timer.getDate(); c = new Date(c.getFullYear(), c.getMonth(), c.getDate()); c = new Date(c.getFullYear() - 13, c.getMonth(), c.getDate(), c.getHours(), c.getMinutes(), c.getMilliseconds()); return a <= c }, __checkDob: function () { var a = "pending", c = this.get("dob"); null !== c && (a = isNaN(c) || !this.__checkAge(c) ? "invalid" : "valid"); this.validity.set({ dob: a }); this.error.set({ dob_invalid: "invalid" === a }) }, __generateAvatarname: function () { "valid" === this.validity.get("displayname") && "valid" === this.validity.get("email") && this.useSuggestedAvatarname && this.__registrationManager.getSuggestedAvatarname({ displayname: this.get("displayname"), email: this.get("email") }).then(function (a) { this.set("avatarname", a.generated_avatarname); this.trigger("generated:avatarname") }.bind(this)) } }) }({ PrefsManager: z }); var P = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ 1: function (d) { var a, c = this.escapeExpression; return '\n    <option value="' + c((a = d && d.value, "function" === typeof a ? a.apply(d) : a)) + '">' + c((a = d && d.label, "function" === typeof a ? a.apply(d) : a)) + "</option>\n    " }, 3: function (d) { var a = this.escapeExpression; return '\n    <option value="' + a("function" === typeof d ? d.apply(d) : d) + '">' + a("function" === typeof d ? d.apply(d) : d) + "</option>\n    " }, compiler: [5, ">= 2.0.0"], main: function (d, a, c, e) { var b, f; c = this.escapeExpression; var g = a.helperMissing, k = '<div class="selector">\n    <select tabindex="' + c((f = a.tabIndex1 || d && d.tabIndex1, "function" === typeof f ? f.call(d, { name: "tabIndex1", hash: {}, data: e }) : f)) + '" class="date-picker-dropdown month">\n    <option selected value="">'; return f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "datepicker_unselected_month", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += "</option>\n    ", b = a.each.call(d, d && d.monthRange, { name: "each", hash: {}, fn: this.program(1, e), inverse: this.noop, data: e }), (b || 0 === b) && (k += b), k += '\n    </select>\n</div>\n<div class="selector">\n    <select tabindex="' + c((f = a.tabIndex2 || d && d.tabIndex2, "function" === typeof f ? f.call(d, { name: "tabIndex2", hash: {}, data: e }) : f)) + '" class="date-picker-dropdown day">\n    <option selected value="">', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "datepicker_unselected_day", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += "</option>\n    ", b = a.each.call(d, d && d.dayRange, { name: "each", hash: {}, fn: this.program(3, e), inverse: this.noop, data: e }), (b || 0 === b) && (k += b), k += '\n    </select>\n</div>\n<div class="selector">\n    <select tabindex="' + c((f = a.tabIndex3 || d && d.tabIndex3, "function" === typeof f ? f.call(d, { name: "tabIndex3", hash: {}, data: e }) : f)) + '" class="date-picker-dropdown year">\n    <option selected value="">', f = a["i18n-g"] || d && d["i18n-g"] || g, b = f.call(d, "datepicker_unselected_year", { name: "i18n-g", hash: {}, data: e }), (b || 0 === b) && (k += b), k += "</option>\n    ", b = a.each.call(d, d && d.yearRange, { name: "each", hash: {}, fn: this.program(3, e), inverse: this.noop, data: e }), (b || 0 === b) && (k += b), k + "\n    </select>\n</div>\n" }, useData: !0 }) }({}), Q = function () { var h = Handlebars.template; return Handlebars.templates = Handlebars.templates || {}, h({ compiler: [5, ">= 2.0.0"], main: function () { return '<div class="dropdown-label is-truncated"><span>&nbsp;</span></div>\n<div class="dropdown-option-list-container">\n    <div class="dropdown-scroll-up"></div>\n    <div class="dropdown-scroll-down"></div>\n    <ul class="dropdown-option-list">\n        <li class="dropdown-option is-truncated" data-value="" tabindex="-1"></li>\n    </ul>\n</div>\n' }, useData: !0 }) }({}); Q = function (h) { function d(e) { e = $(e.target).closest(".dropdown"); $(".dropdown").not(e).each(function (b, f) { $(f).data("dropdown-instance").__hide() }) } var a = h.UiCore.UiContext, c = h.NextUtil.Keys; return a.extend("Dropdown", { globalSetup: function () { document.addEventListener("click", d, !0); document.addEventListener("touchend", d, !0) }, globalTearDown: function () { document.removeEventListener("click", d, !0); document.removeEventListener("touchend", d, !0) }, uiContextName: "dropdown", className: "dropdown disable-text-selection", ITEM_HEIGHT: 40, AUTO_SCROLL_BY: 2, dependencies: ["timer", "window"], trackedEvents: function () { return [{ type: "click", selector: ".dropdown-label", name: "dropdown_label_click", handler: "toggleOpen" }, { type: "click", selector: ".dropdown-option", name: "dropdown_option_click", handler: "clickOption" }, { type: "keydown", selector: "", name: "dropdown_keydown", handler: this.__onKeydown.bind(this, []) }, { type: "mousemove", selector: ".dropdown-option", name: "dropdown_option_mouseenter", handler: this.__onMousemove.bind(this, { x: 0, y: 0 }) }, { type: "mouseenter", selector: ".dropdown-label", name: "dropdown_label_mouseenter", handler: "__onMouseenterLabel" }, { type: "mouseenter", selector: ".dropdown-scroll-up", name: "dropdown_scroll_up_mouseenter", handler: "__onScrollUpMouseenter" }, { type: "mouseleave", selector: ".dropdown-scroll-up", name: "dropdown_scroll_up_mouseleave", handler: "__onScrollUpMouseleave" }, { type: "mouseenter", selector: ".dropdown-scroll-down", name: "dropdown_scroll_down_mouseenter", handler: "__onScrollDownMouseenter" }, { type: "mouseleave", selector: ".dropdown-scroll-down", name: "dropdown_scroll_down_mouseleave", handler: "__onScrollDownMouseleave" }] }, __onMousemove: function (e, b) { if (e.x != b.screenX || e.y != b.screenY) e.x = b.screenX, e.y = b.screenY, this.$el.focus(), this.setActiveElement($(b.target)) }, __onBlur: function (e) { this.$el.removeClass("is-open") }, __onMouseenterLabel: function (e) { this.$(".is-selected").removeClass("is-selected") }, initialize: function (e) { this.$select = IMVU.requireProperty(e, "$replaceElement"); if (!this.$select.is("select")) throw Error("$replaceElement must be a <select> element. got: " + this.$select[0].tagName); if (this.$select.closest("label").length) throw Error("do not wrap custom dropdowns with <label> tags; it disrupts event handling"); a.prototype.initialize.call(this, e); this.window = e.window; this.timer = e.timer; this.boundingBox = e.boundingBox || this.getDefaultBoundingBox(); this.document = e.document || document; this.__keyArray = []; if (this.dismissOnScroll = e.dismissOnScroll) $(e.dismissOnScroll).on("scroll.dropdown", function () { this.__hide() }.bind(this)); $(".dropdown-layer").length || $("body").append('<div class="dropdown-layer"/>'); this.$dropdownLayer = $(".dropdown-layer"); e.dimNoValue && this.$el.addClass("dim-no-value"); this.$el.data("dropdown-instance", this); this.addToDOM() }, delete: function () { this.__keyValueArray && this.timer.clearTimeout(this.__keyValueArray); this.dismissOnScroll && $(this.dismissOnScroll).off("scroll.dropdown"); $(this.window).off("resize.dropdown"); a.prototype.delete.call(this) }, __onHidden: function () { this.$el.is(":visible") && this.remove(); a.prototype.__onHidden.apply(this, arguments) }, getDefaultBoundingBox: function () { var e = this.$el.position().top - 5 * this.ITEM_HEIGHT, b = e + 11 * this.ITEM_HEIGHT; 0 > e && (e = 0); b > $(this.window).height() && (b = $(this.window).height()); return { x: 0, y: e, w: $(this.window).width(), h: b - e } }, render: function () { this.$placeholder = $("<div/>"); this.$el.html(h.template); this.$label = this.$(".dropdown-label"); this.$optionList = this.$(".dropdown-option-list"); this.$optionListContainer = this.$(".dropdown-option-list-container"); var e = this.$optionList.find(".dropdown-option"); this.$select.addClass("is-enhanced"); this.refreshLabel(this.$select.find(":selected")); e.remove(); this.$select.children().each(function (b, f) { b = e.clone(!0); b.text($(f).text()); b.attr("data-text", $(f).text().toLowerCase()); b.attr("data-value", $(f).val()); this.$optionList.append(b) }.bind(this)); this.$el.addClass(this.$select[0].className).removeClass("dropdown-template").addClass("dropdown"); this.$label.append(this.$select); this.$el.attr("tabindex", this.$select.attr("tabindex") || "0"); this.$select.attr("tabindex", -1); this.$optionList.on("scroll", this.__onScroll.bind(this)); this.$select.on("change", this.__changedOption.bind(this)); this.$el.addClass("is-ready") }, __fullHeight: function () { return this.$select.children().length * this.ITEM_HEIGHT }, __getSelectedIndex: function () { return this.$select[0].selectedIndex }, __getTopEdgeInViewport: function (e) { return e.offset().top - $(this.document).scrollTop() }, __getComputedInfo: function () { var e = this.__getTopEdgeInViewport(this.$el), b = this.__fullHeight(), f = this.__getSelectedIndex() * this.ITEM_HEIGHT, g = this.getDefaultBoundingBox().y, k = this.getDefaultBoundingBox().y + this.getDefaultBoundingBox().h, m = e - f, l = m + b; m < g && (m = g); if (l > k) { var q = l - k; l = k; m > g && (m -= Math.min(m - g, q)) } return { projectedTopDiff: m - e, computedHeight: l - m, selectedTop: f, maxTop: g, maxBottom: k, fullHeight: b } }, __refreshScrollers: function () { var e = this.$optionList[0].scrollHeight - this.$optionList.innerHeight(), b = 0 < this.$optionList.scrollTop(); e = Math.round(this.$optionList.scrollTop()) < e; this.$el.toggleClass("can-scroll-up", b).toggleClass("can-scroll-down", e) }, isOpen: function () { return this.$el.hasClass("is-open") }, __hide: function () { this.isOpen() && ($(this.window).off("resize.dropdown"), this.$el.removeClass("is-open"), this.$placeholder.before(this.$el).detach(), this.$el.removeAttr("style")) }, __show: function () { if (!this.isOpen()) { $(this.window).on("resize.dropdown", d); var e = this.$el.offset(), b = this.$el.width(), f = this.$el.height(), g = this.$el.css("margin-left"), k = this.$el.css("margin-right"), m = this.$el.css("margin-top"), l = this.$el.css("margin-bottom"), q = this.$el.css("float"); this.$placeholder.css({ width: b, height: f, "margin-left": g, "margin-right": k, "margin-top": m, "margin-bottom": l, float: q }); this.$el.addClass("is-open").css({ top: this.__getTopEdgeInViewport(this.$el), left: e.left, width: b, height: f, "margin-left": 0, "margin-right": 0, "margin-top": 0, "margin-bottom": 0 }); this.$el = this.$el.before(this.$placeholder).detach(); this.$dropdownLayer.append(this.$el) } }, toggleOpen: function (e) { this.isOpen() ? this.__hide() : (this.__show(), e = this.__getComputedInfo(), this.$optionListContainer.css({ top: e.projectedTopDiff, height: e.computedHeight }), this.$el.focus(), e = e.selectedTop + e.projectedTopDiff, this.$optionList.scrollTop(e), this.__lastScrollTop = e, this.setActiveElement(this.$(".dropdown-option").eq(this.__getSelectedIndex())), this.__refreshScrollers()); return !1 }, refreshLabel: function (e) { this.$label.find("> span").text(e.text()).toggleClass("no-value", "" === e.val()) }, clickOption: function (e) { this.__hide(); this.$select.val($(e.target).attr("data-value")); this.$select.trigger("change"); d(e) }, selectByValue: function (e) { this.$(".is-selected").removeClass("is-selected"); this.$('.dropdown-option[data-value="' + e + '"]').addClass("is-selected"); this.$("select").val(e); e = this.$("select").find(":selected"); this.refreshLabel(e) }, val: function () { return this.$("select").val() }, __changedOption: function (e) { e = $(e.target).find(":selected"); this.refreshLabel(e) }, __maybeScrollOptionIntoView: function (e, b) { if (e[0]) { var f = this.$el.hasClass("can-scroll-up"), g = this.$el.hasClass("can-scroll-down"), k = this.$optionList, m = k.height(), l = k.offset().top, q = l + m, t = e.outerHeight(); e = e.offset().top; var R = e + t, I = e - l + k.scrollTop(), S = m / 2 - t / 2 * 3; e < l + (f ? t : 0) ? (b && (I -= S), k.scrollTop(I - (f ? this.ITEM_HEIGHT : 0))) : R > q - (g ? t : 0) && (b && (I += S), k.scrollTop(I - (m - t) + (g ? t : 0))) } }, __open: function (e) { this.isOpen() && this.$select.val(this.$optionList.find(".is-selected").attr("data-value")).change(); this.toggleOpen(e); e = this.$optionList.children().eq(this.$select[0].selectedIndex); h.NextUtil.DomHelper.radioClass(e, "is-selected"); return e }, __moveSelection: function (e) { e = this.$optionList.children().index(this.$optionList.find(".is-selected")) + e; 0 > e ? e = 0 : e > this.$select.children().length - 1 && (e = this.$select.children().length - 1); e = this.$optionList.children().eq(e); h.NextUtil.DomHelper.radioClass(e, "is-selected"); return e }, setActiveElement: function (e) { this.__activeElement = e; h.NextUtil.DomHelper.radioClass(e, "is-selected") }, __onKeydown: function (e, b) { if (!this.isOpen() && c.is(b, "VK_ENTER") || !this.isOpen() && c.is(b, "VK_DOWN")) d(this.$el), this.__open(b); else { var f = this.__activeElement && this.__activeElement.parent()[0] === this.$optionList[0] ? this.__activeElement : this.$(".dropdown-option").first(); if (c.is(b, "VK_DOWN")) this.__maybeScrollOptionIntoView(f.next()), f.next()[0] && this.setActiveElement(f.next()); else if (c.is(b, "VK_UP")) this.__maybeScrollOptionIntoView(f.prev()), f.prev()[0] && this.setActiveElement(f.prev()); else if (c.is(b, "VK_ENTER")) this.__hide(), this.$select.val(this.__activeElement.attr("data-value")), this.$select.trigger("change"), d(b); else if (c.is(b, "VK_ESC")) d(this.$el); else { var g = c.getAlphaNumericChar(b); if (!1 !== g) { var k = f[0]; this.__keyValueArray && this.timer.clearTimeout(this.__keyValueArray); e.push(g); g = e.join("").toLowerCase(); for (this.__keyValueArray = this.timer.setTimeout(function () { e.length = 0 }.bind(this), 1e3); k.nextSibling;) { k = k.nextSibling; var m = $(k); if (m.attr("data-text")[0] && h.NextUtil.string.startsWith(m.attr("data-text"), g)) { this.isOpen() || this.toggleOpen(b); this.setActiveElement(m); this.__maybeScrollOptionIntoView(m, m[0] != f[0].nextSibling && m[0] != f[0].prevSibling); return } } for (k = this.$(".dropdown-option")[0]; k && k != f[0];) { m = $(k); if (m.attr("data-text")[0] && h.NextUtil.string.startsWith(m.attr("data-text"), g)) { this.isOpen() || this.toggleOpen(b); this.setActiveElement(m); this.__maybeScrollOptionIntoView(m, m[0] != f[0].nextSibling && m[0] != f[0].prevSibling); break } k = k.nextSibling } } } } }, __onScroll: function (e) { e = this.$optionList.scrollTop(); this.__refreshScrollers(); this.__lastScrollTop = e }, __doScrollUp: function (e, b) { e = this.__getComputedInfo(); var f = void 0 === b ? this.AUTO_SCROLL_BY : b; this.$optionListContainer.offset().top + this.$optionListContainer.height() + f < e.maxBottom ? (b = this.$optionListContainer.height() + f, b > e.fullHeight && (b = e.fullHeight), this.$optionListContainer.css({ height: b }), this.$optionList[0].scrollTop -= f, this.__refreshScrollers(this.$dropdown)) : void 0 === b && (this.$optionList[0].scrollTop -= this.AUTO_SCROLL_BY) }, __onScrollUpMouseenter: function (e) { this.timer.clearInterval(this.__autoScrollInterval); this.__autoScrollIntervalCounter = 0; this.__autoScrollInterval = this.timer.setInterval(function () { this.__doScrollUp(e) }.bind(this), 1) }, __onScrollUpMouseleave: function (e) { this.timer.clearInterval(this.__autoScrollInterval) }, __doScrollDown: function (e, b) { e = this.__getComputedInfo(); var f = void 0 === b ? this.AUTO_SCROLL_BY : b; if (this.$optionListContainer.offset().top - f > e.maxTop) { var g = this.$optionListContainer.height() + f; b = this.$optionListContainer.position().top - f; g > e.fullHeight ? g = e.fullHeight : this.$optionListContainer.css({ top: b }); this.$optionListContainer.css({ height: g }); this.$optionList[0].scrollTop += f; this.__refreshScrollers(this.$dropdown) } else void 0 === b && (this.$optionList[0].scrollTop += this.AUTO_SCROLL_BY) }, __onScrollDownMouseenter: function (e) { this.timer.clearInterval(this.__autoScrollDownInterval); this.__autoScrollDownIntervalCounter = 0; this.__autoScrollDownInterval = this.timer.setInterval(function () { this.__doScrollDown(e) }.bind(this), 1) }, __onScrollDownMouseleave: function (e) { this.timer.clearInterval(this.__autoScrollDownInterval) } }) }({ NextUtil: n["@NextUtil"], UiCore: n["@UiCore"], template: Q }); P = function (h) { var d = h.UiCore.UiContext; return d.extend("DatePicker", { uiContextName: "date_picker", className: "date-picker", dependencies: ["tabIndex"], trackedEvents: function () { return [{ type: "change", name: "change_year", selector: ".year select", handler: "__onChangeYear" }, { type: "change", name: "change_month", selector: ".month select", handler: "__onChangeMonth" }, { type: "change", name: "change_day", selector: ".day select", handler: "__onChangeDay" }] }, initialize: function (a) { this.__serviceProvider = a.serviceProvider; this.__globalStringManager = this.__serviceProvider.get("globalStringManager"); this.__timer = this.__serviceProvider.get("timer"); this.__now = this.__timer.getDate(); this.__current = a.current || null; this.__tabIndex = a.tabIndex; d.prototype.initialize.call(this, a); this.addToDOM() }, render: function () { this.__currentYear = this.year(); this.__currentMonth = this.month(); this.__currentDay = this.day(); this.__yearRange = _.range(this.__now.getFullYear() - 100, this.__now.getFullYear() + 1).reverse(); this.__monthRange = [{ value: "1", label: this.__globalStringManager.get("datepicker_month_january") }, { value: "2", label: this.__globalStringManager.get("datepicker_month_february") }, { value: "3", label: this.__globalStringManager.get("datepicker_month_march") }, { value: "4", label: this.__globalStringManager.get("datepicker_month_april") }, { value: "5", label: this.__globalStringManager.get("datepicker_month_may") }, { value: "6", label: this.__globalStringManager.get("datepicker_month_june") }, { value: "7", label: this.__globalStringManager.get("datepicker_month_july") }, { value: "8", label: this.__globalStringManager.get("datepicker_month_august") }, { value: "9", label: this.__globalStringManager.get("datepicker_month_september") }, { value: "10", label: this.__globalStringManager.get("datepicker_month_october") }, { value: "11", label: this.__globalStringManager.get("datepicker_month_november") }, { value: "12", label: this.__globalStringManager.get("datepicker_month_december") }]; this.__dayRange = _.range(1, 32); this.$el.html(h.template({ currentYear: this.__currentYear, currentMonth: this.__currentMonth, currentDay: this.__currentDay, yearRange: this.__yearRange, monthRange: this.__monthRange, dayRange: this.__dayRange, tabIndex1: this.__tabIndex, tabIndex2: this.__tabIndex + 1, tabIndex3: this.__tabIndex + 2 })); this.yearDropdown = this.createChildContext(h.Dropdown, { $replaceElement: this.$(".year") }); this.monthDropdown = this.createChildContext(h.Dropdown, { $replaceElement: this.$(".month") }); this.dayDropdown = this.createChildContext(h.Dropdown, { $replaceElement: this.$(".day") }); $(".year .dropdown-label").addClass("noValue"); $(".month .dropdown-label").addClass("noValue"); $(".day .dropdown-label").addClass("noValue"); this.$(".year select").val(this.__currentYear).change(); this.$(".month select").val(this.__currentMonth).change(); this.$(".day select").val(this.__currentDay).change() }, cleanup: function () { this.yearDropdown.__hide(); this.monthDropdown.__hide(); this.dayDropdown.__hide() }, __daysInMonth: function () { if (!this.__currentMonth || !this.__currentYear) return 31; var a = this.__current ? new Date(this.__current) : new Date; a.setDate(1); a.setMonth(this.__currentMonth); a.setYear(this.__currentYear); a.setDate(0); return a.getDate() }, __ensureValue: function () { var a = this.__daysInMonth(), c = this.$(".day select option"), e = this.$(".day .dropdown-option"); c.removeClass("hidden"); e.removeClass("hidden"); if (null !== this.__currentMonth) { for (var b = 31; 28 < b; b--)parseInt(c[b].value, 10) > a && ($(c[b]).addClass("hidden"), $(e[b]).addClass("hidden")); this.__currentDay && this.__currentDay > a && (this.__currentDay = a.toString(), this.dayDropdown.selectByValue(this.__currentDay)) } null === this.__currentYear || null === this.__currentMonth || null === this.__currentDay ? this.__current = null : (null === this.__current && (this.__current = new Date), this.__current.setDate(1), this.__current.setFullYear(this.__currentYear), this.__current.setMonth(this.__currentMonth - 1), this.__current.setDate(this.__currentDay), this.__current.setHours(0), this.__current.setMinutes(0), this.__current.setSeconds(0), this.__current.setMilliseconds(0)); this.trigger("change") }, value: function () { return null === this.__current ? null : new Date(this.__current) }, year: function () { return null === this.__current ? null : this.__current.getFullYear() }, month: function () { return null === this.__current ? null : this.__current.getMonth() + 1 }, day: function () { return null === this.__current ? null : this.__current.getDate() }, __onChangeYear: function () { var a = this.$(".year select").val(); if ("" === a || -1 === a) a = null; $(".year .dropdown-label").toggleClass("noValue", null === a); this.__currentYear = null !== a ? a.toString() : null; this.__ensureValue() }, __onChangeMonth: function () { var a = this.$(".month select").val(); if ("" === a || -1 === a) a = null; $(".month .dropdown-label").toggleClass("noValue", null === a); this.__currentMonth = null !== a ? a.toString() : a; this.__ensureValue() }, __onChangeDay: function () { var a = this.$(".day select").val(); if ("" === a || -1 === a) a = null; $(".day .dropdown-label").toggleClass("noValue", null === a); this.__currentDay = null !== a ? a.toString() : a; this.__ensureValue() }, setDate: function (a, c, e) { "undefined" !== typeof a && "undefined" !== typeof c && "undefined" !== typeof e && (this.__currentYear = a, this.__currentMonth = "0" == c.substring(0, 1) ? c.substring(1) : c, this.__currentDay = "0" == e.substring(0, 1) ? e.substring(1) : e, this.$(".year select").val(this.__currentYear).change(), this.$(".month select").val(this.__currentMonth).change(), this.$(".day select").val(this.__currentDay).change(), this.__ensureValue()) } }) }({ UiCore: n["@UiCore"], Dropdown: Q, template: P }); r = function (h) { var d = function () { var e = { avatarname_invalid: { selector: ".signup_avatarname", string: "signup_dialog_error_avatarname_invalid" }, avatarname_taken: { selector: ".signup_avatarname", string: "signup_dialog_error_avatarname_taken" }, email_invalid: { selector: ".signup_email", string: "signup_dialog_error_email_invalid" }, email_taken: { selector: ".signup_email", string: "signup_dialog_error_email_taken" }, email_banned: { selector: ".signup_email", string: "signup_dialog_error_email_banned" }, email_imvu: { selector: ".signup_email", string: "signup_dialog_error_email_imvu" }, displayname_invalid: { selector: ".signup_displayname", string: "signup_dialog_error_displayname_invalid" }, displayname_blank: { selector: ".signup_displayname", string: "signup_dialog_error_blank_field" }, password_too_long: { selector: ".signup_password", string: "signup_dialog_error_password_short" }, password_too_short: { selector: ".signup_password", string: "signup_dialog_error_password_short" }, password_weak: { selector: ".signup_password", string: "signup_dialog_error_weak" }, password_fair: { selector: ".signup_password", string: "signup_dialog_error_fair" }, dob_invalid: { selector: ".signup_dob", string: "signup_dialog_error_date_invalid" }, unknown: { selector: ".noop", string: "signup_dialog_error_unknown" } }, b = function (f, g) { this.__model = f; this.__globalStringManager = g }; _.extend(b.prototype, { getSelector: function (f) { return (e[f] || e.unknown).selector }, getTranslatedString: function (f) { return this.__globalStringManager.get((e[f] || e.unknown).string) }, getError: function (f) { for (var g in e) if ((e[g] || e.unknown).selector === f && this.__model.get(g)) return g } }); return b }(), a = function (e, b, f) { f = f || ""; b = b || {}; b = this.__getUiAttributes(b); if ("string" !== typeof f) throw Error("subContext (" + IMVU.repr(f) + ") must be a string."); _.isUndefined(this.__parentUiContext) ? (b.name && this.__validateName(b.name), this.__serviceProvider.get("uiEventReporter").recordEvent(this.__getUiApplication(), this.__getUiPlatform(), this.__getUiContext(f), e, b)) : a.call(this.__parentUiContext, e, b, this.__getUiContext(f)) }, c = h.SlideIn; return c.extend("FtuxAccountSlideIn", h.Mixin.mixin({ uiContextName: "ftux_account_slidein", className: "slidein ftux-account-slidein light-theme", dependencies: "cookieManager dialogManager featureAccessManager ftuxState funCaptchaPromise globalStartupModel globalStringManager googleAnalytics imageManager inventoryManager leanplum localStorage loginManager nextPageCallback restModelFactory startupModel timer window".split(" "), trackedEvents: function () { return c.prototype.trackedEvents.call(this).concat([{ name: "blur", type: "blur", selector: "input", handler: "__onInputBlur" }, { name: "avatarname", type: "focus", selector: 'input[name="signup_avatarname"]', handler: "__onFocusAvatarField" }, { name: "avatarname", type: "blur", selector: 'input[name="signup_avatarname"]', handler: "__onBlurAvatarField" }, { name: "avatarname", type: "change", selector: 'input[name="signup_avatarname"]', handler: "__onAvatarNameChange" }, { name: "avatarnamepencil", type: "click", selector: "label.avatar-name", handler: "__onFocusAvatarFieldLabel" }, { name: "displayname", type: "change", selector: 'input[name="signup_displayname"]', handler: "__onDisplayNameChange" }, { name: "email", type: "change", selector: 'input[name="signup_email"]', handler: "__onEmailChange" }, { name: "password", type: "change", selector: 'input[name="signup_password"]', handler: "__onPasswordChange" }, { name: "submit", type: "click", selector: ".ftux-reg-footer button", handler: "__onSubmit" }, { type: "click", selector: ".toggle-password-visibility", name: "toggle_password_visibility", handler: "__togglePasswordVisibility" }]) }, initialize: function (e) { var b = this; this.__window = e.window; this.__localStorage = e.localStorage; this.__globalStringManager = e.globalStringManager; this.__showFuncaptcha = e.serviceProvider.get("showFuncaptcha"); this.__globalStartupModel = e.globalStartupModel; this.__parentMode = e.mode; this.__userClickedOnCreateAccount = e.userClickedOnCreateAccount; this.className += " ftux-registration-desktop"; c.prototype.initialize.call(this, e); this.__socialLogin = this.__loginManager.getSocialLogin(); this.__socialLogin.getAuth().then(function () { if (b.__socialLogin.isLoggedIn()) { var f = b.$(".signup_displayname_input"), g = b.__socialLogin.getProfileItem("name"); g = "undefined" === typeof g ? "" : g; f[0].setAttribute("value", g); b.__onDisplayNameChange(); f = b.$(".signup_email_input"); var k = b.__socialLogin.getProfileItem("email"); f[0].setAttribute("value", "undefined" === typeof g ? "" : k); b.__onEmailChange(); b.$(".signup_password").addClass("hidden") } else null !== b.__socialLogin.getAppleRefreshToken() && (b.$(".signup_email_input")[0].setAttribute("value", b.__socialLogin.getAppleEmail()), b.__onEmailChange(), b.$(".signup_password").addClass("hidden")) }); this.__loginCookieName = this.__serviceProvider.get("loginCookieName"); this.__lookModel = this.__parentMode.getLookModel() || e.serviceProvider.create(h.LookModel, { typeId: this.__ftuxState.getGender() }) }, __setupModel: function () { this.__model = this.__serviceProvider.create(h.RegisterModeModel, { avatarNameManager: this.__serviceProvider.create(h.AvatarName), registrationManager: this.__serviceProvider.create(h.RegistrationManager), passwordStrength: { passwordStrength: window.password_strength, passwordMaxLength: window.password_max_length, passwordMinLength: window.password_min_length } }); this.__Errors = new d(this.__model.error, this.__globalStringManager); this.__model.state.on("change", this.__updateState, this); this.__updateState(); this.listenTo(this.__model.error, "change", this.__updateChangedErrors); this.listenTo(this.__model, "change", this.__updateState); this.listenTo(this.__model, "generated:avatarname", this.__updateAvatarname.bind(this)) }, renderBody: function (e) { h.TrackingPixel.showSignupPixel({ serviceProvider: this.__serviceProvider, window: this.__window, globalStartupModel: this.__globalStartupModel }); this.$(".slidein-body").addClass("loading"); this.__funCaptchaPromise.then(function (b) { var f = b.funCaptcha; b = b.validation; this.$(".slidein-body").removeClass("loading"); this.__funCaptcha = f; this.__setupModel(); this.__renderForm(e); this.__funcaptchaAddToDom(); this.__window.addEventListener ? this.__window.addEventListener("message", this.__funcaptchaLoaded, !1) : window.attachEvent && this.__window.attachEvent("onmessage", this.__funcaptchaLoaded); "true" === b.success && this.__funcaptchaSuccess(); this.listenTo(b, "success", this.__funcaptchaSuccess) }.bind(this), function (b) { "forceNoCaptcha" === b ? (this.__setupModel(), this.__renderForm(e)) : a.call(this, "funcaptcha_took_over_30") }.bind(this)) }, __renderForm: function (e) { e.html(h.template({ dobDefaultLabel: this.__globalStringManager.get("signup_dialog_birthday_cover"), dobTooltipContent: h.dobTooltipTemplate({ privacy_policy_link: '<a target="_blank" href="https://secure.imvu.com/next/policyhub/privacypolicy/">' + this.__globalStringManager.get("signup_dialog_dob_tooltip_pp") + "</a>" }), passwordTooltipContent: h.passwordTooltipTemplate() })); this.__insertLabelTemplate(".signup_dob"); e = { $replaceElement: this.$(".date-picker"), tabIndex: 4 }; this.__datePicker = this.createChildContext(h.DatePicker, e); this.listenTo(this.__datePicker, "change", this.__onDateChange); this.createChildContext(h.Tooltip, { $replaceElement: this.$(".signup_dob .tooltip-content"), $tooltipTarget: this.$(".signup_dob .tooltip-target") }); this.createChildContext(h.Tooltip, { $replaceElement: this.$(".signup_password .tooltip-content"), $tooltipTarget: this.$(".signup_password .tooltip-target") }) }, hide: function () { c.prototype.hide.call(this, !0); $(this.__window).off("beforeunload") }, show: function (e) { c.prototype.show.call(this, e); this.__lookModel = this.__parentMode.getLookModel(); if (this.__model) { if (this.__ftuxState.isNothingEquipped() || this.__userClickedOnCreateAccount) this.__ftuxState.setGender(this.__lookModel.getTypeId()), this.__ftuxState.updateFromLookModel(this.__lookModel), this.__ftuxState.createEquippedItemIds(this.__lookModel.get("products")); this.__model.set({ pids: this.__ftuxState.getEquippedItems() }) } this.__inventoryManager.getFtuxModelPromise().then(function (b) { var f = b.get(this.__ftuxState.getGender() + "_reg"); this.__clothingProductUrl = b.get("dress_up_reg"); this.trigger("show:scene", b); this.__ftuxModel = b; this.__showAvatarImage(this.__ftuxModel); return this.__serviceProvider.get("rest").get(f) }.bind(this)).then(function () { this.__showFuncaptcha ? (this.__leanplum.recordEvent("welcome_funcaptcha_should_show"), 0 === this.$("div#funcaptcha").find("iframe").length && this.__funcaptchaAddToDom()) : this.__leanplum.recordEvent("welcome_funcaptcha_should_not_show") }.bind(this)) }, __showAvatarImage: function (e) { var b = this.__ftuxState.getGenderState().avatarImage || this.__lookModel.get("avatar_image"); b || (b = e.get(this.__ftuxState.getGender() + "_image")); this.setAvatarImage(b) }, setAvatarImage: function (e) { this.$(".avatar img").attr("src", e) }, __onEmailChange: function () { this.__leanplum.recordEvent("welcome_email_change"); var e = this.$('input[name="signup_email"]').val(); this.__model.set({ email: e }) }, __onPasswordChange: function () { this.__leanplum.recordEvent("welcome_password_change"); this.__model.set({ password: this.$('input[name="signup_password"]').val() }) }, __onDateChange: function () { this.__leanplum.recordEvent("welcome_date_change"); this.__model.set({ dob: this.__datePicker.value() }) }, __onAvatarNameChange: function () { this.__leanplum.recordEvent("welcome_avatar_name_change"); var e = this.__removeExtraWhitespace(this.$('input[name="signup_avatarname"]').val(), !0); this.$('input[name="signup_avatarname"]').val(e); this.__model.useSuggestedAvatarname = !1; this.__model.set({ avatarname: e }) }, __onDisplayNameChange: function () { this.__leanplum.recordEvent("welcome_display_name_change"); var e = this.__removeExtraWhitespace(this.$('input[name="signup_displayname"]').val(), !1); this.$('input[name="signup_displayname"]').val(e); this.__model.set({ displayname: e }) }, __removeExtraWhitespace: function (e, b) { return e = e.replace(/\s+/g, b ? "" : " ").replace(/^\s|\s$/g, "") }, __onInputBlur: function (e) { if ("signup_email" !== $(e.currentTarget).attr("name") || "pending" !== this.__model.validity.get("email")) { e = "." + $(e.currentTarget).attr("name"); var b = this.__Errors.getError(e); b ? this.__setInputErrorLabelMsg(e, this.__Errors.getTranslatedString(b)) : this.__clearError(e) } }, __failedSubmit: function (e) { this.__leanplum.recordEvent("welcome_registration_failure", { error: e }); this.__recordEvent("registration_error", { error_log: e, record: !0 }); this.__funCaptcha && this.__funCaptcha.refresh_session(); this.__updateAllErrors(); this.$("select").prop("disabled", !1); this.$("input").prop("disabled", !1); this.$(".selector").removeClass("disabled"); this.$(".submit").removeClass("clicked"); this.$(".submit").prop("disabled", !1); this.$(".ftux-account-slidein").removeClass("loading"); this.__updateState() }, __onSubmit: function (e) { e.preventDefault(); this.__leanplum.recordEvent("welcome_create_account_click"); this.__serviceProvider.get("uiEventReporter").flush(); this.$("button").prop("disabled", !0); this.$("select").prop("disabled", !0); this.$(".selector").addClass("disabled"); this.$("input").prop("disabled", !0); this.$(".ftux-account-slidein").addClass("loading"); e = this.$('input[name="fc-token"]').val(); this.__model.set({ fc_token: e }); this.__onDateChange(); "valid" === this.__model.state.get("form") && (e = this.__timer.getDate(), e = new Date(e.getFullYear() - 13, e.getMonth(), e.getDate(), 0, 0, 0, 0), this.__model.get("dob").getTime() <= e.getTime() ? (this.__googleAnalytics.recordClick("welcome", "create account"), this.__model.submitRegistration().then(function () { this.__leanplum.recordEvent("welcome_registration_success"); this.__googleAnalytics.recordRegistrationComplete(this.__googleAnalyticsLabel); this.__recordEvent("registration_success", { record: !0 }); a.call(this, "secret_registration_success"); h.TrackingPixel.showPixel(); h.TrackingPixel.showRegistrationPixel({ serviceProvider: this.__serviceProvider, window: this.__window, globalStartupModel: this.__globalStartupModel }); this.__cookieManager.set(this.__loginCookieName, "true"); this.__serviceProvider.get("uiEventReporter").flush().then(this.__nextPageCallback, this.__nextPageCallback); this.__localStorage.setItem("account-just-created", 1) }.bind(this)).catch(function (b) { this.__failedSubmit(b) }.bind(this))) : this.__failedSubmit({ temporary: !1, type: "unknown_frontend_error" })) }, __updateChangedErrors: function (e, b) { for (var f in e.changed) if (e.changed[f]) { this.__setInputErrorLabelMsg(this.__Errors.getSelector(f), this.__Errors.getTranslatedString(f)); break } else this.__clearError(this.__Errors.getSelector(f)) }, __updateAllErrors: function () { this.$(".error-message").removeClass("active"); _.each({ unknown: "unknown", challenge: "unknown", login: "unknown", fc_token_invalid: "funcaptcha", fun_captcha_answer_wrong: "funcaptcha", birthday_error: "underage" }, function (e, b) { this.__model.error.get(b) && this.$(".error-message." + e).addClass("active") }.bind(this)) }, __updateState: function () { switch (this.__model.state.get("form")) { case "invalid": this.$("input").prop("disabled", !1); this.$(".submit").prop("disabled", !0); break; case "valid": this.$("input").prop("disabled", !1); this.$(".submit").prop("disabled", !1); break; case "loading": this.$("input").prop("disabled", !0), this.$(".selector").addClass("disabled"), this.$(".submit").prop("disabled", !0) } }, __togglePasswordVisibility: function () { var e = this.$(".signup_password input"), b = "password" == e.attr("type"); e[0].setAttribute("type", b ? "text" : "password"); this.$(".toggle-password-visibility").toggleClass("icon-password-show", !b).toggleClass("icon-password-hide", b); e.focus() }, __updateAvatarname: function () { this.$(".avatar-name-container input[name=signup_avatarname]").val(this.__model.get("avatarname")); this.__onBlurAvatarField(); this.__showAvatarname || (this.__showAvatarname = !0, this.$(".avatar-name-container").addClass("show-avatarname-field")) }, __onFocusAvatarFieldLabel: $.noop, __onFocusAvatarField: function () { this.$(".avatar-name").addClass("active"); this.__leanplum.recordEvent("welcome_avatar_name_focus"); this.__googleAnalytics.recordClick("welcome", "modify avatarname field") }, __onBlurAvatarField: function () { this.$(".avatar-name").removeClass("active"); var e = this.$(".avatar-name-container input[name=signup_avatarname]").val(), b = $("<div />").css({ margin: 0, padding: 0, display: "none", "font-size": "15px" }).text(e); this.$(".avatar-name-container").append(b); e = 0 !== e.length ? b.width() : 85; this.$(".avatar-name-container input[name=signup_avatarname]").width(e); b.remove() }, __funcaptchaAddToDom: function () { this.__leanplum.recordEvent("welcome_funcaptcha_added_to_dom"); this.$("div.funcaptcha-wrapper").append($("#funcaptcha")); "rtl" === document.querySelector("html").getAttribute("dir") && document.querySelector("html").classList.add("terrible-funcaptcha-layout-hack-for-chrome") }, __funcaptchaSuccess: function () { this.__leanplum.recordEvent("welcome_funcaptcha_success"); this.__model.validity.set({ fc_token: "valid" }); this.$(".error-message.funcaptcha").removeClass("active") }, __funcaptchaLoaded: function (e) { "https://funcaptcha.com" == e.origin && e.data && "finished_loading_game" == e.data && !this.__fc_loaded && (this.__fc_loaded = !0, 1 === this.$('div.funcaptcha-wrapper input[name="fc-token"]').length && -1 === this.$('div.funcaptcha-wrapper input[name="fc-token"]').val().indexOf("sup=1") && this.$("div.funcaptcha-wrapper").addClass("shown")) }, _updateLookModel: function (e) { this.__lookModel.set(e) }, _getRegistrationModelPids: function () { return this.__model.get("pids") } }, h.InputMixin)) }({ Model: n["@Model"], NextUtil: n["@NextUtil"], PasswordStrength: n["@PasswordStrength"], UiCore: n["@UiCore"], AvatarName: O, DatePicker: P, InputMixin: H, LookModel: x, Mixin: A, RegisterModeModel: z, RegistrationManager: N, SlideIn: B, Tooltip: r, TrackingPixel: T, dobTooltipTemplate: U, passwordTooltipTemplate: V, template: M }); w = function (h) { var d = h.Submode; return d.extend("FtuxSubmode", { uiContextName: "ftux_submode", className: "submode ftux-submode ftux-layout", dependencies: "browserInfo counterHelper dialogManager featureAccessManager ftuxState globalNav globalStringManager googleAnalytics historyManager localStorage loginManager perfReportManager Promise restModelFactory startupModel stringManager uiEventReporter webGL window".split(" "), trackedEvents: function () { return d.prototype.trackedEvents.call(this).concat([{ type: "click", selector: ".gender button", name: "change_gender", handler: this.__onGenderButtonClick }, { type: "click", selector: ".gender .avatar-container .female-wrapper .avatar-2d .avatar-image", name: "2d_female_avatar_click", handler: this.__onFemaleAvatarClick }, { type: "click", selector: ".gender .avatar-container .male-wrapper .avatar-2d .avatar-image", name: "2d_male_avatar_click", handler: this.__onMaleAvatarClick }, { type: "click", selector: ".go-back-button", name: "go_back", handler: this.__goBackViaButtonClick }]) }, initialize: function (a) { var c = this; d.prototype.initialize.call(this, a); this.__Promise = a.Promise; this.__serviceProvider = a.serviceProvider; this.__startupModel = a.startupModel; this.__Promise = a.Promise; this.__globalStringManager = a.globalStringManager; this.__restModelFactory = a.restModelFactory; this.__webGL = a.webGL; this.__timer = a.timer; this.__initTime = this.__timer.getTime(); this.__undoRedo = a.undoRedo; this.__window = a.window; this.__uiEventReporter = a.uiEventReporter; this.__globalNav = a.globalNav; this.__modeManager = a.modeManager; this.__localStorage = a.localStorage; this.__loadedMedias = 0; this.__eleBody = null; this.__regShown = !1; this.__selectedGender = null; this.__3DSceneDCAShown = !1; this.__step = this.__previousStep = this.ftuxModule = null; this.__initialStep = "undefined" === typeof a.initialStep ? "gender" : a.initialStep; this.__genderChanged = !1; this.__2dAvatar = null; this.__userClickedOnCreateAccount = this.__slideInListensSetup = !1; this.__connectionResolver = void 0; this.__connectionPromise = new this.__Promise(function (e) { this.__connectionResolver = e }.bind(this)); this.__connectionPromise.then(function () { this.__totalMedias = this.__webGL.use3d() && 0 !== this.__connectionTier ? 1 : 2 }.bind(this)).catch(function (e) { this.__window.console.error(e) }.bind(this)); this.ftuxState = a.ftuxState; this.__currentLook = JSON.stringify({ trackedAdds: this.__parentMode.trackedAdds, trackedRemoves: this.__parentMode.trackedRemoves, change: {} }); this.addToDOM(); this.__startupModel.populated().then(function () { return this.__startupModel.getSingleEdge("dress_up_ftux").populated() }.bind(this)).then(function () { this.__onResize() }.bind(this)).catch(function (e) { this.__window.console.error(e) }.bind(this)); this.__historyManager.noHistory() && "gender" !== this.__step && (null === this.__step && null !== this.__initialStep && (this.__step = this.__initialStep), "dna" !== this.__step && "clothing" !== this.__step && "account" !== this.__step || this.__setHistoryState("gender"), "clothing" !== this.__step && "account" !== this.__step || this.__setHistoryState("dna"), "account" === this.__step && this.__setHistoryState("clothing")); this.__undoRedo = a.undoRedo; this.__parentMode.initFuncaptcha(); this.__supported_redirects = ["/creatorlanding/"]; this.__serviceProvider.get("acceptedDollarStorePermaLinkProducts").forEach(function (e) { return c.__supported_redirects.push("/store/" + e + "/") }) }, delete: function () { $(this.__window).off("resize.ftux"); d.prototype.delete.call(this); this.__2dAvatar && this.__2dAvatar.off("loaded"); _.each(this.__initialDefaultProducts, function (a) { a.find("img").off("load") }) }, __switchToGender: function () { this.__eleLoginNav.addClass("hidden"); this.__eleBody.removeClass("fixed-position-ghost-layout"); this.__eleGender.removeClass("hidden"); this.__eleDCA.addClass("hidden"); this.__eleSlidein.addClass("hidden"); this.__undoRedo.clearHistory(); this.__parentMode.resetTrackedIds(); this.__currentLook = JSON.stringify({ trackedAdds: this.__parentMode.trackedAdds, trackedRemoves: this.__parentMode.trackedRemoves, change: {} }); this.__showGender() }, __switchToDCA: function () { this.__eleLoginNav.removeClass("hidden"); this.__eleBody.addClass("fixed-position-ghost-layout"); this.__eleGender.addClass("hidden"); this.__eleDCA.removeClass("hidden"); this.__eleSlidein.removeClass("hidden"); this.__globalNav.setText(this.__stringManager.get("customize_dna_nav")); this.__showDCA() }, __setStep: function (a, c) { c = "undefined" === typeof c ? !1 : !!c; this.__previousStep = this.__step; this.__step = a; null === this.__eleBody && (this.__eleLoginNav = $(".login-nav"), this.__eleBody = this.$(".ftux-body"), this.__eleAvCon = this.__eleBody.find(".avatar-container"), this.__eleGender = this.__eleBody.find(".gender"), this.__eleDGFemale = this.__eleGender.find('[data-gender="female"]'), this.__eleDGMale = this.__eleGender.find('[data-gender="male"]'), this.__eleDCA = this.__eleBody.find(".dca"), this.__eleSlidein = this.__eleBody.find(".slide-in")); this.__setStepSwitch(); c || this.__setHistoryState(this.__step); return !0 }, __setStepSwitch: function () { switch (this.__step) { case "gender": this.__switchToGender(); this.__globalNav.setText(this.__globalStringManager.get("select_gender_nav")); this.__ftuxState.clearAssets(); this.__historyManager.unsetPopInterception(); break; case "dna": this.__switchToDCA(); this.__globalNav.setText(this.__stringManager.get("customize_dna_nav")); $(".go-back-button > span").text(this.__stringManager.get("back_to_gender")); this.__historyManager.setPopInterception(this.__popStateInterceptForBrowserGoBack.bind(this)); "undefined" !== typeof this.__ftuxProductSlideIn && ("clothing" !== this.__previousStep && this.__ftuxProductSlideIn.show(this.__parentMode.slideInOpen), this.__ftuxProductSlideIn.showDnaProducts()); "undefined" !== typeof this.__ftuxAccountSlideIn && this.__ftuxAccountSlideIn.hide(); null !== this.ftuxModule && this.stopListening(this.ftuxModule, "change:gender"); break; case "clothing": this.__switchToDCA(); this.__globalNav.setText(this.__stringManager.get("select_clothing_nav")); $(".go-back-button > span").text(this.__stringManager.get("back_to_dna")); this.__historyManager.setPopInterception(this.__popStateInterceptForBrowserGoBack.bind(this)); "undefined" !== typeof this.__ftuxProductSlideIn && ("dna" !== this.__previousStep && this.__ftuxProductSlideIn.show(this.__parentMode.slideInOpen), this.__ftuxProductSlideIn.showClothingProducts()); "undefined" !== typeof this.__ftuxAccountSlideIn && this.__ftuxAccountSlideIn.hide(); null !== this.ftuxModule && this.stopListening(this.ftuxModule, "change:gender"); break; case "account": this.__switchToDCA(), this.__globalNav.setText(this.__stringManager.get("save_this_look_nav")), $(".go-back-button > span").text(this.__stringManager.get("back_to_clothing")), this.__historyManager.setPopInterception(this.__popStateInterceptForBrowserGoBack.bind(this)), "undefined" !== typeof this.__ftuxProductSlideIn && this.__ftuxProductSlideIn.hide(), this.__showRegistrationSlideIn(), this.__ftuxAccountSlideIn.show(), this.__parentMode.getLookModel() && !this.__3dActive && this.__ftuxAccountSlideIn.setAvatarImage(this.__parentMode.getLookModel().get("avatar_image")), this.__counterHelper.increment("welcome_ftux_account") } }, __getStep: function () { switch (this.__step) { case "gender": case "dna": case "clothing": case "account": return this.__step; default: return !1 } }, __getStage: function () { if (null === this.__step) return "gender"; switch (this.__step) { case "gender": return "gender"; case "dna": case "clothing": case "account": return "dca"; default: return !1 } }, __onResize: function () { "gender" === this.__step && (h.NextUtil.DomHelper.squarify({ me: this.__eleDGFemale, within: this.__eleAvCon, isHalfWidth: !0 }), h.NextUtil.DomHelper.squarify({ me: this.__eleDGMale, within: this.__eleAvCon, isHalfWidth: !0 })) }, render: function () { d.prototype.render.call(this); this.$el.html(h.template); this.__connectionPromise.then(function () { this.$el.toggleClass("is2d", !this.__webGL.use3d() && 0 !== this.__connectionTier); this.__webGL.use3d() && 0 !== this.__connectionTier && this.__showLoadingProgress() }.bind(this)).catch(function (a) { this.__window.console.error(a) }.bind(this)); $(this.__window).on("resize.ftux", this.__onResize.bind(this)); this.__startupModel.populated().then(function () { return this.__startupModel.getSingleEdge("dress_up_ftux").populated() }.bind(this)).then(function (a) { this.ftuxModel = a; this.__categoriesUrl = a.get("dress_up_reg"); this.__preloadCategories(this.ftuxState.getGender()) }.bind(this)).catch(function (a) { this.__window.console.error(a) }.bind(this)); this.__webGL.use3d() || this.$("#landing-video-container").css("display", "none"); this.__featureAccessManager.isMobile() && this.__dialogManager.confirm({ title: this.__globalStringManager.get("ftux_frontpage_get_the_app"), text: this.__globalStringManager.get("ftux_frontpage_best_mobile_experience"), yes: this.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"), no: this.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn") }).finished.then(function () { "iOS" === this.__browserInfo.getMobileOS() ? (this.__window.open("itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8"), this.__window.location = "/welcome/") : "Android" === this.__browserInfo.getMobileOS() ? (this.__window.open("https://play.google.com/store/apps/details?id=com.imvu.mobilecordova"), this.__window.location = "/welcome/") : this.__window.location = "https://about.imvu.com/mobile/" }.bind(this)).catch(function (a) { this.__window.location = "/welcome/" }.bind(this)) }, show: function () { IMVU.removeLandingVideo(); this.__loginManager.isLoggedIn() && (this.__window.location = "/next/"); d.prototype.show.call(this); this.__parentMode.slideInOpen = !1; this.__setStep(this.__initialStep) }, __spawn2dAvatar: function (a, c) { return this.__parentMode.show2dAvatar({ gender: a, $parentElement: c, parentContext: this, setDefault: !0 }) }, __showGender: function () { this.__3DSceneDCAShown = !1; this.__startupModel.populated().then(function () { return this.__parentMode.getConnectionTier() }.bind(this)).then(function (a) { this.__connectionTier = a; return this.__startupModel.getSingleEdge("dress_up_ftux").populated() }.bind(this)).then(function () { this.__connectionResolver.accept(); if (this.__webGL.use3d() && 0 !== this.__connectionTier) { this.__3dActive = !0; this.__moveLoadingProgress("bootstrap"); var a = _.extend(_.clone(h.CamParams.room), { pitchForFtux: 10, yaw: 156, firstPersonViewSwitchDistance: 0 }); this.__parentMode.show3dScene({ $parentElement: this.$(".gender .avatar-container").expect(1), parentContext: this, genders: ["female", "male"], camParams: a, canClickAvatar: !0, allowCameraInteraction: !1, resetGenderLooks: !0 }).then(function (c) { this.__moveLoadingProgress("northstar"); this.ftuxModule = c; this.__parentMode.resetScenePosition(); return c.loadedEverything().then(function () { this.__setSelectedGender(this.ftuxState.getGender()); var e = this.ftuxState.getAssetUrl(); this.ftuxState.setGender(this.__selectedGender); null !== e && this.ftuxState.setAssetUrl(e); this.ftuxModule.__ftuxMode !== this.ftuxModule.FTUX_MODE_GENDER && (e = this.ftuxModel.get(this.__selectedGender + "_asset_url"), this.ftuxState.getAssetUrl() && (e = this.ftuxState.getAssetUrl()), this.ftuxModule.changeAssetsByUrlString(e, function () { }), this.ftuxModule.setModeToGender(), this.__parentMode.resetTrackedIds(), this.ftuxState.setGender(this.__selectedGender)); this.__moveLoadingProgress("ftuxModule"); this.listenTo(this.ftuxModule, "change:gender", this.__onGenderAvatarClick); $(this.__window).trigger("resize") }.bind(this)) }.bind(this)).then(function () { this.__on3dLoaded(a) }.bind(this)).catch(function (c) { this.__window.console.error(c) }.bind(this)) } else this.setLoading(!1), _.each(["female", "male"], function (c) { var e = this.$('.gender .avatar-container div[data-gender="' + c + '"]'); this.__spawn2dAvatar(c, e).then(function () { this.__mediaLoaded(); $(this.__window).trigger("resize") }.bind(this)).catch(function (b) { this.__window.console.error(b) }.bind(this)) }.bind(this)), this.ftuxState.setGender("female") }.bind(this)) }, __showDCA: function () { this.__selectedGender || (this.__selectedGender = this.__ftuxState.getGender() ? this.__ftuxState.getGender() : "female"); this.__ftuxProductSlideIn || (this.__inventoryManager = this.__serviceProvider.create(h.InventoryManager, { ftuxState: this.__ftuxState }), this.__ftuxProductSlideIn = this.addSlideIn(h.FtuxProductSlideIn, { $parentElement: this.$(".slide-in"), lookModel: this.__parentMode.getLookModel(), inventoryManager: this.__inventoryManager, undoRedo: this.__undoRedo, step: this.__step })); this.__connectionResolver.accept(); "3d" === (this.__webGL.use3d() && 0 !== this.__connectionTier ? "3d" : "2d") ? (this.__moveLoadingProgress("bootstrap"), this.__show3DSceneDCA()) : (this.setLoading(!1), this.__show2dAvatarDCA()); this.__slideInListensSetup || (this.__slideInListensSetup = !0, this.listenTo(this.__ftuxProductSlideIn, "show:body", function (a) { this.ftuxModule && this.ftuxModule.focusOnBodyRegion(a) }), this.listenTo(this.__ftuxProductSlideIn, "change:look", function (a) { this.__userChangedLook = !0; this.__webGL.use3d() && 0 !== this.__connectionTier && this.__showPutOnItemProgressBar(); this.__changeLook(a) }), this.listenTo(this.__ftuxProductSlideIn, "undo:look", function () { this.__undo() }), this.listenTo(this.__ftuxProductSlideIn, "redo:look", function () { this.__redo() }), this.listenTo(this.__ftuxProductSlideIn, "show:clothing", function () { "clothing" !== this.__step && this.__setStep("clothing") }), this.listenTo(this.__ftuxProductSlideIn, "show:registration", function () { this.__userClickedOnCreateAccount = !0; this.__setStep("account") })) }, hide: function () { d.prototype.hide.call(this); this.__globalNav.clearText() }, __on3dLoaded: function (a) { this.setLoading(!1); this.__mediaLoaded() }, __showLoadingProgress: function () { this.__3dProgressPoints = {}; _.each(["bootstrap", "northstar", "ftuxModule"], function (a) { new this.__Promise(function (c) { this.__3dProgressPoints[a] = c }.bind(this)) }.bind(this)); this.__loadingProgress = this.createChildContext(h.LoadingProgress, { progressPromises: _.pluck(_.values(this.__3dProgressPoints), "promise"), $parentElement: this.$el, perfStartTime: this.__perfReportManager.getTime() }); this.__connectionPromise.then(function (a) { this.listenTo(this.__loadingProgress, "timeCompleted", this.__googleAnalytics.recordPerformance.bind(this.__googleAnalytics, "welcome", "loading progressbar")) }.bind(this)) }, __moveLoadingProgress: function (a) { this.__3dProgressPoints[a].accept() }, __preloadCategories: function (a) { this.__restModelFactory.readCollection(this.__categoriesUrl + "?gender=" + a, h.UiCore.NodeCollection, { withCredentials: !1 }) }, __mediaLoaded: function () { this.__loadedMedias++; 0 < this.__totalMedias && this.__loadedMedias === this.__totalMedias && this.__onFinishedLoading() }, __onFinishedLoading: function () { var a = this.uiContextName + "_" + (this.__webGL.use3d() ? "3d" : "2d") + "_load_time", c = (this.__timer.getTime() - this.__initTime) / 1e3; this.__recordEvent(a, { time: c, record: !0 }); this.__uiEventReporter.flush(); this.__connectionPromise.then(function () { this.__googleAnalytics.recordPerformance("mirror", "ftux submode " + (this.__webGL.use3d() && 0 !== this.__connectionTier ? "3d" : "2d") + " load time", parseInt(this.__timer.getTime() - this.__initTime)) }.bind(this)); "function" === typeof this.__parentMode.maybeShowGDPRDialog && this.__parentMode.maybeShowGDPRDialog() }, __snapshotLook: function (a) { this.__currentLook = JSON.stringify({ trackedAdds: this.__parentMode.trackedAdds, trackedRemoves: this.__parentMode.trackedRemoves, change: a }) }, __changeLook: function (a) { var c = this.__currentLook, e = this.__buildChangeQuery(a); this.__movePutOnItemProgressBar("prepareLook"); this.__parentMode.getLookModel().fetch(e).then(function () { this.__movePutOnItemProgressBar("startWearing"); this.__snapshotLook(a); this.__setTrackedPids(e); this.__undoRedo.add(c); this.__executeChangeLook() }.bind(this)) }, __undo: function () { if (this.__undoRedo.get("canUndo") && this.__undoRedo.get("canProcess")) { this.__undoRedo.set("canProcess", !1); var a = this.__undoRedo.undo(this.__currentLook); if (this.__currentLook = a) { a = JSON.parse(a); this.__parentMode.trackedAdds = a.trackedAdds; this.__parentMode.trackedRemoves = a.trackedRemoves; var c = this.__buildChangeQuery(a.change); return this.__parentMode.getLookModel().fetch(c).then(function () { this.__setTrackedPids(c); this.__executeChangeLook(); this.__undoRedo.set("canProcess", !0) }.bind(this)) } } return this.__Promise.accept() }, __redo: function () { if (this.__undoRedo.get("canRedo") && this.__undoRedo.get("canProcess")) { this.__undoRedo.set("canProcess", !1); var a = this.__undoRedo.redo(this.__currentLook); this.__currentLook = a; a = JSON.parse(a); this.__parentMode.trackedAdds = a.trackedAdds; this.__parentMode.trackedRemoves = a.trackedRemoves; var c = this.__buildChangeQuery(a.change); return this.__parentMode.getLookModel().fetch(c).then(function () { this.__setTrackedPids(c); this.__executeChangeLook(); this.__undoRedo.set("canProcess", !0) }.bind(this)) } return this.__Promise.accept() }, __extractChangeArray: function (a, c) { return !_.has(a, c) || _.isNull(a[c]) || _.isUndefined(a[c]) ? [] : _.isArray(a[c]) ? a[c] : a[c].split(",") }, __setTrackedPids: function (a) { var c = this.__extractChangeArray(a, "add"); a = this.__extractChangeArray(a, "remove"); var e = _.pluck(this.__parentMode.getLookModel().get("products"), "product_id"); this.__parentMode.trackedAdds = _.difference(this.__parentMode.trackedAdds, a); this.__parentMode.trackedRemoves = _.difference(this.__parentMode.trackedRemoves, c); c = _.uniq(this.__parentMode.trackedAdds.concat(c)); a = _.uniq(this.__parentMode.trackedRemoves.concat(a)); var b = _.intersection(c, a); this.__parentMode.trackedAdds = _.intersection(_.difference(c, b), e); this.__parentMode.trackedRemoves = _.difference(a, b) }, __buildChangeQuery: function (a) { var c = this.__extractChangeArray(a, "add"); a = this.__extractChangeArray(a, "remove"); _.each([c, a], function (b) { _.each(b, function (f, g) { _.isString(b[g]) && (b[g] = parseInt(b[g].replace(/^(.*\/product-)*(\d+)$/, "$2"), 10)) }.bind(this)) }.bind(this)); c = _.uniq(this.__parentMode.trackedAdds.concat(c)); a = _.uniq(this.__parentMode.trackedRemoves.concat(a)); var e = {}; 0 < c.length && (e.add = c); 0 < a.length && (e.remove = a); return e }, __showPutOnItemProgressBar: function () { this.__userChangedLook && (void 0 !== this.__putOnItemProgressBar && this.__putOnItemProgressBar.delete(), this.__putOnItemProgressPoints = {}, _.each(["startWearing", "prepareLook", "putOnOutfit", "doneWearing"], function (a) { new this.__Promise(function (c) { this.__putOnItemProgressPoints[a] = c }.bind(this)) }.bind(this)), this.__putOnItemProgressBar = this.createChildContext(h.LoadingProgress, { $parentElement: this.$(".dca .avatar-container"), progressPromises: _.pluck(_.values(this.__putOnItemProgressPoints), "promise") }, !0)) }, __movePutOnItemProgressBar: function (a) { this.__userChangedLook && this.__webGL.use3d() && 0 !== this.__connectionTier && this.__putOnItemProgressPoints[a].accept() }, __executeChangeLookFromSlideIn: function (a) { a.disableProductEquip(); this.__ftuxState.createEquippedItemIds(this.__parentMode.getLookModel().get("products")); this.__connectionPromise.then(function () { this.__webGL.use3d() && 0 !== this.__connectionTier ? (this.__movePutOnItemProgressBar("putOnOutfit"), this.__parentMode.get3dScenePromise().then(function () { this.ftuxModule = this.__parentMode.getFtuxModule(); this.ftuxModule.changeAssetsByUrlString(this.__parentMode.getLookModel().get("asset_url"), function () { this.__movePutOnItemProgressBar("doneWearing"); this.__ftuxState.updateFromLookModel(this.__parentMode.getLookModel()); a.markEquippedProducts(this.__ftuxState.getEquippedItems()); a.enableProductEquip() }.bind(this)) }.bind(this))) : (a.markEquippedProducts(this.__ftuxState.getEquippedItems()), a.enableProductEquip()) }.bind(this)) }, setLoading: function (a) { this.$(".ftux-body").toggleClass("loading", a) }, __setFtuxGender: function () { this.ftuxModule ? (this.ftuxModule.setGender(this.__selectedGender), "male" === this.ftuxState.getGender() ? this.ftuxState.setAssetUrl(this.ftuxModule.__maleUrl) : this.ftuxState.setAssetUrl(this.ftuxModule.__femaleUrl)) : this.ftuxState.setGender(this.__selectedGender); this.__preloadCategories(this.__selectedGender); this.__genderChanged = !0; "creatorlanding" === this.__modeManager.uiApplication && this.__window.pintrk("track", "signup", { lead_type: ["Signup choose gender:", this.ftuxState.getGender()].join(" ") }); this.__setStep("dna") }, __onGenderButtonClick: function (a) { a = $(a.currentTarget); var c = a.attr("data-gender"), e = !1; !c && a.is("button") && (c = a.hasClass("female") ? "female" : "male", e = !0); e && this.ftuxState.clearAssets(); this.__setSelectedGender(c); this.__setFtuxGender() }, __onGenderAvatarClick: function () { this.__setSelectedGender(this.ftuxState.getGender()); this.__setFtuxGender() }, __onFemaleAvatarClick: function () { this.__setSelectedGender("female"); this.__setFtuxGender() }, __onMaleAvatarClick: function () { this.__setSelectedGender("male"); this.__setFtuxGender() }, __setSelectedGender: function (a) { this.__selectedGenderPrevious = this.__selectedGender; this.__selectedGender = "undefined" === typeof a ? null : a; this.__parentMode.createLookModel(this.__selectedGender) }, getSelectedGender: function () { return this.__selectedGender }, __show3DSceneDCA: function () { if (!this.__3DSceneDCAShown) { this.__3DSceneDCAShown = !0; var a = "clothing" === this.__step ? "tops" : "hair"; this.__parentMode.show3dScene({ $parentElement: this.$(".dca .avatar-container"), parentContext: this, genders: [this.__selectedGender] }).then(function (c) { this.__moveLoadingProgress("northstar"); this.__ftuxState.isNothingEquipped() && this.__ftuxState.createEquippedItemIds(this.__parentMode.getLookModel().get("products")); this.__parentMode.moveScene({ left: -340 }, this.__parentMode.slideInOpen); return c.loadedEverything().then(function () { this.__moveLoadingProgress("ftuxModule"); c.setGender(this.__selectedGender); c.setModeToLook(function () { c.focusOnBodyRegion(a); this.__getPreviousProductsSelection(); $(this.__window).trigger("resize") }.bind(this)) }.bind(this)) }.bind(this)).then(this.__on3dLoaded.bind(this)) } }, __show2dAvatarDCA: function () { var a = null === this.__2dAvatar || this.__genderChanged; this.__genderChanged = !1; a && (null !== this.__2dAvatar && (this.__2dAvatar.off("loaded"), this.__2dAvatar.delete(), this.__2dAvatar = null), a = this.$(".dca .avatar-container"), a.empty(), this.__spawn2dAvatar(this.__selectedGender, a).then(function (c) { this.__2dAvatar = c; this.__parentMode.setLookModel(c.getLookModel()); this.__2dAvatar.setCategory("body" === this.__category ? this.__bodyCategory : this.__category); this.__ftuxProductSlideIn.enableProductEquip(); this.__2dAvatar.on("loaded", this.__ftuxProductSlideIn.enableProductEquip.bind(this)); this.__mediaLoaded(); this.__getPreviousProductsSelection() }.bind(this))) }, __getPreviousProductsSelection: function () { if (!this.__ftuxState.isNothingEquipped()) { var a = this.__ftuxState.getEquippedItems(), c = _.pluck(this.__parentMode.getLookModel().get("products"), "product_id"); a = _.difference(a, c); this.__parentMode.trackedAdds = a; this.__3dActive || 0 === a.length || this.__changeLook(a.toString()); this.__ftuxProductSlideIn.markEquippedProducts(this.__ftuxState.getEquippedItems()); this.__ftuxProductSlideIn.enableProductEquip() } }, __executeChangeLook: function () { this.__executeChangeLookFromSlideIn(this.__ftuxProductSlideIn); !this.__3dActive && this.__ftuxAccountSlideIn && this.__ftuxAccountSlideIn.setAvatarImage(this.__parentMode.getLookModel().get("avatar_image")) }, __getURLComponents: function () { var a = this.__serviceProvider.get("registrationDestination"), c = "", e = ""; if (a) { e = (e = a.substring(0, a.indexOf("?"))) ? e : a; c = a.split("/"); var b = c.pop(), f = c.pop(); "" === b && (b = f, f = c.pop()); c = "store" === f ? "/" + f + "/" + b + "/" : "/" + b + "/" } return { urlNoParams: e, urlPath: c, url: a } }, __showRegistrationSlideIn: function () { if (!this.__regShown) { this.__regShown = !0; this.__nextPageCallback = this.__serviceProvider.get("ftuxNextPageCallback"); if (!this.__nextPageCallback) { var a = this.__getURLComponents(), c = a.urlPath, e = a.url; if (a.urlNoParams && -1 !== _.indexOf(this.__supported_redirects, c)) this.__nextPageCallback = function () { "creatorlanding" === this.__serviceProvider.get("modeManager").uiApplication && this.__window.pintrk("track", "signup", { lead_type: "account_created" }); this.__window.location = e }.bind(this); else if ((a = new URL(this.__window.location.href).searchParams) && a.get("next")) { var b = a.get("next"); this.__nextPageCallback = function () { this.__window.open(decodeURIComponent(b), "_self") }.bind(this) } else this.__nextPageCallback = this.__parentMode.openSubmode.bind(this.__parentMode, { id: "download" }) } this.__ftuxAccountSlideIn || (this.__parentMode.getLookModel(), this.__ftuxAccountSlideIn = this.addSlideIn(h.FtuxAccountSlideIn, { $parentElement: this.$(".slide-in"), inventoryManager: this.__inventoryManager, nextPageCallback: this.__nextPageCallback, dressupProducts: this.__ftuxState.getEquippedItems(), funCaptchaPromise: this.__parentMode.getFunCaptchaPromise(), userClickedOnCreateAccount: this.__userClickedOnCreateAccount })) } }, __setHistoryState: function (a) { this.__historyManager.setState({ fragment: a, mode: { id: "ftux" }, submode: { id: a } }) }, __goBackViaButtonClick: function () { this.__historyManager.silentMoveHistory(-1) }, __popStateInterceptForBrowserGoBack: function () { this.__goBackOneStep() }, __goBackOneStep: function () { switch (this.__step) { case "gender": return !1; case "dna": return this.__setStep("gender", !0), !0; case "clothing": return this.__setStep("dna", !0), !0; case "account": return this.__setStep("clothing", !0), this.__ftuxAccountSlideIn.hide(), !0; default: return !1 } } }) }({ NextUtil: n["@NextUtil"], UiCore: n["@UiCore"], CamParams: v, FtuxAccountSlideIn: r, FtuxProductSlideIn: F, InventoryManager: E, LoadingProgress: w, Submode: p, template: G }); p = function (h) { var d = IMVU.NamedModel; return d.extend("UndoRedoModel", { initialize: function () { d.prototype.initialize.apply(this, arguments); this.clearHistory() }, add: function (a) { 0 !== this.undoArr.length && _.isEqual(this.undoArr[this.undoArr.length - 1], a) || (this.undoArr.push(a), this.redoArr = [], this.trigger("add", a), this.__updateComputedAttributes()) }, undo: function (a) { this.redoArr.push(a); a = this.undoArr.pop(); this.trigger("undo", a); this.__updateComputedAttributes(); return a }, redo: function (a) { this.undoArr.push(a); a = this.redoArr.pop(); this.trigger("redo", a); this.__updateComputedAttributes(); return a }, clearHistory: function () { this.undoArr = []; this.redoArr = []; this.processBool = !0; this.__updateComputedAttributes() }, historyFind: function (a) { return _.find(this.undoArr, a) || _.find(this.redoArr, a) }, isInHistory: function (a) { var c = a.get("product_id").toString(); a = function (e) { e = _.last(e.split("/")).split(","); return _.contains(e, c) }; return _.find(this.undoArr, a) || _.find(this.redoArr, a) }, __updateComputedAttributes: function () { this.set({ canUndo: !!this.undoArr.length, canRedo: !!this.redoArr.length, canProcess: this.processBool }) }, get: function (a) { switch (a) { case "lastUndo": return _.last(this.undoArr); default: return d.prototype.get.apply(this, arguments) } } }) }({ UiCore: n["@UiCore"] }); return function (h) { (function () { var a = new window.WeakMap; return function (c) { a.has(c) || a.add(c, {}); return a.get(c) } })(); var d = h.Mode; return d.extend("FtuxMode", { uiContextName: "ftux_mode", className: "mode ftux ftux-mode", dependencies: "cookieManager dialogManager featureAccessManager leanplum localStorage loginManager Promise PromiseResolver rest sceneManager startupModel stringManager timer uiEventReporter webGL window".split(" "), submodes: function () { return { __default__: [h.FtuxFrontpageSubmode, {}], gender: [h.FtuxSubmode, { undoRedo: this.__undoRedo, initialStep: "gender" }], dna: [h.FtuxSubmode, { undoRedo: this.__undoRedo, initialStep: "dna" }], clothing: [h.FtuxSubmode, { undoRedo: this.__undoRedo, initialStep: "clothing" }], account: [h.FtuxSubmode, { undoRedo: this.__undoRedo, initialStep: "account" }], download: [h.FtuxDownloadSubmode] } }, initialize: function (a) { d.prototype.initialize.call(this, a); -1 !== location.host.indexOf("localhost.") && "true" === localStorage.getItem("forceProduction") && this.__loginManager.isLoggedIn() && (this.__window.location.href = "/next?forceProduction=true"); this.__startupModel = a.startupModel; this.__shouldCheckGDPR = IMVU.optionalProperty(a, "shouldCheckGDPR", !0); this.__serviceProvider = a.serviceProvider.nestedProvider(); this.__ftuxState = this.__serviceProvider.create(h.FtuxState); this.__serviceProvider.register("ftuxState", this.__ftuxState); this.__cookieManager = a.cookieManager; this.__localStorage = a.localStorage; this.__avatar2dFactory = a.avatar2dFactory || h.Avatar2d; this.__ftuxModuleFactory = a.ftuxModuleFactory || h.FtuxModule; this.__Promise = a.Promise; this.module = a.module || module; this.__window = a.window; this.__timer = a.timer; this.__undoRedo = new h.UndoRedo; this.slideInOpen = !1; this.__avatar2d = []; this.__gaEventSent = []; this.listenTo(this, "shown", a.uiEventReporter.flush.bind(a.uiEventReporter)); this.__network = a.network; this.__preciseTimer = a.preciseTimer; this.__frameTimer = a.frameTimer; this.trackedAdds = IMVU.optionalProperty(a, "trackedAdds", []); this.trackedRemoves = IMVU.optionalProperty(a, "trackedRemoves", []); this.__ftuxGender = this.__ftuxState.getGender(); this.createLookModel(this.__ftuxGender); this.funCaptcha = null; this.funCaptchaValidation = { success: "false" }; _.extend(this.funCaptchaValidation, Backbone.Events); this.__funCaptchaPromiseResolver = (a = this.__serviceProvider.get("showFuncaptcha")) ? this.__serviceProvider.get("PromiseResolver").get() : this.__serviceProvider.get("PromiseResolver").getRejected("forceNoCaptcha"); this.__funCaptchaPromiseResolver.init = a ? function () { var c = this, e = this.__timer.getTime(); return function () { if (3e4 <= this.__timer.getTime() - e && !this.__window.FunCaptcha) return this.__funCaptchaPromiseResolver.reject("took too long"); if (!this.__window.FunCaptcha) return this.__timer.setTimeout(this.__funCaptchaPromiseResolver.init, 1e3); null === this.funCaptcha && (this.funCaptcha = new this.__window.FunCaptcha({ public_key: "0C2B415C-D772-47D4-A183-34934F786C7E", callback: function () { c.funCaptchaValidation.success = "true"; c.funCaptchaValidation.trigger("success") }, onsuppress: function () { c.funCaptchaValidation.success = "true"; c.funCaptchaValidation.trigger("success") }, language: c.__serviceProvider.get("language") }), this.__funCaptchaPromiseResolver.resolve({ funCaptcha: this.funCaptcha, validation: this.funCaptchaValidation })) }.bind(this) }.call(this) : $.noop; this.addToDOM(); this.__startupModel.populated().then(function () { this.__startupModel.getSingleEdge("dress_up_ftux").populated() }.bind(this)).catch(function (c) { this.__window.console.error(c) }.bind(this)) }, maybeShowGDPRDialog: function () { this.__shouldCheckGDPR && (this.__isGDPR = !1, this.__consentUrl = this.__startupModel.get("consentUrl"), this.__consentModel = this.__restModelFactory.readModel(this.__consentUrl, h.UiCore.NodeModel), this.__consentModel.populated().then(function () { (this.__isGDPR = this.__consentModel.get("qualifies_for_gdpr") || "1" === this.__cookieManager.get("test_gdpr")) && "true" !== this.__cookieManager.get("accepted_all_cookies") && this.__dialogManager.showDialog(h.PrivacyPolicyAdultDialog) }.bind(this)).catch(function (a) { this.__window.console.error(a) }.bind(this))) }, show2dAvatar: function (a) { a = void 0 === a ? {} : a; var c = IMVU.requireProperty(a, "gender"), e = IMVU.requireProperty(a, "$parentElement"); a.allowDuplicates || e.empty(); var b = IMVU.requireProperty(a, "parentContext"); if (!this.__avatar2d[c] || a.setDefault) { var f; return this.__startupModel.populated().then(function () { return this.__startupModel.getSingleEdge("dress_up_ftux").populated() }.bind(this)).then(function (k) { k = a.keepLookModel ? this.__lookModel : this.__serviceProvider.create(h.LookModel, { typeId: c }); f = +new Date; k = b.createChildContext(this.__avatar2dFactory, { category: "all", model: k, $parentElement: e, attachedToBottom: a.attachedToBottom, view: "ftux" }); this.__avatar2d[c] = { parentContext: b, avatarContext: k }; return k.loaded() }.bind(this)).then(function (k) { this.__gaEventSent[c] || (this.__googleAnalytics.recordPerformance("load", "2dAvatar", +new Date - f), this.__gaEventSent[c] = !0); return k }.bind(this)).catch(function (k) { this.__window.console.error(k) }.bind(this)) } var g = this.__avatar2d[c].avatarContext; this.__avatar2d[c].parentContext.removeChildContext(g); g.setAttachedToBottom(a.attachedToBottom); g.setParentUiContext(b); b.children().push(g); g.$el.appendTo(e); return g.loaded() }, show3dScene: function (a) { var c = IMVU.requireProperty(a, "parentContext"), e = IMVU.requireProperty(a, "$parentElement"); if (this.__ftuxModule) return c.removeChildContext(this.__ftuxModule), this.__ftuxModule.reparent(e), this.__Promise.accept(this.__ftuxModule); a = _.extend({ context: c, $parentElement: e, lingerTime: 0 }, a); return this.__create3dScene(a).then(function () { return this.__show3dScenePromise }.bind(this)).catch(function (b) { this.__window.console.error(b) }.bind(this)) }, __create3dScene: function (a) { var c, e; this.__northstarLoader = this.__serviceProvider.get("northstarLoader"); return this.__show3dScenePromise = this.__startupModel.populated().then(function () { return this.__startupModel.getSingleEdge("dress_up_ftux").populated() }.bind(this)).then(function (b) { e = b; c = Date.now(); return this.__northstarLoader.getNorthstar() }.bind(this)).then(function (b) { this.Northstar = b.Northstar; return this.__sceneManager.initFtuxScene(_.extend({ context: a.context, roomUrl: e.get("room_asset_url"), femaleUrl: e.get("female_asset_url"), maleUrl: e.get("male_asset_url"), $parentElement: a.$parentElement, Northstar: this.Northstar }, a)) }.bind(this)).then(function (b) { this.__ftuxModule = b; this.__googleAnalytics.recordPerformance("load", "3dAvatar", Date.now() - c); return this.__Promise.accept(this.__ftuxModule) }.bind(this)).catch(function (b) { this.__window.console.error(b) }.bind(this)) }, get3dScenePromise: function () { return this.__show3dScenePromise }, getFtuxModule: function () { return this.__ftuxModule }, createLookModel: function (a) { this.__lookModel = this.__serviceProvider.create(h.LookModel, { typeId: a }) }, setLookModel: function (a) { this.__lookModel = a }, getLookModel: function () { return this.__lookModel }, resetTrackedIds: function () { this.trackedAdds = []; this.trackedRemoves = [] }, moveScene: function (a, c) { this.$(".ftux-module").addClass("moved"); c && this.$(".ftux-module").addClass("animate"); $.each(a, function (e, b) { this.$(".ftux-module").css(e, b) }.bind(this)); this.$(".ftux-module").removeClass("animate") }, resetScenePosition: function () { this.$(".ftux-module").removeClass("moved"); this.$(".ftux-module").css({ top: 0, right: -170, bottom: 0, left: -170 }) }, getFunCaptchaPromise: function () { return this.__funCaptchaPromiseResolver.promise }, initFuncaptcha: function () { this.__funCaptchaPromiseResolver.init() }, connectionSpeed: null, connectionTier: null, getConnectionSpeed: function () { return new this.__Promise(function (a) { return null === this.__localStorage.getItem("northstarSpeedTest") ? (this.connectionSpeed = 4688, this.connectionTier = 3, a.resolve(this.connectionSpeed)) : null !== this.connectionSpeed ? a.resolve(this.connectionSpeed) : this.__testConnectionSpeed().then(function () { return a.resolve(this.connectionSpeed) }.bind(this)).catch(function (c) { this.__window.console.error(c) }.bind(this)) }.bind(this)) }, getConnectionTier: function () { return new this.__Promise(function (a) { return null === this.__localStorage.getItem("northstarSpeedTest") ? (this.connectionSpeed = 4688, this.connectionTier = 3, a.resolve(this.connectionTier)) : null !== this.connectionTier ? a.resolve(this.connectionTier) : this.__testConnectionSpeed().then(function () { return a.resolve(this.connectionTier) }.bind(this)).catch(function (c) { this.__window.console.error(c) }.bind(this)) }.bind(this)) }, __testConnectionSpeed: function () { return new this.__Promise(function (a) { if (null !== this.connectionSpeed) return a.resolve(!0); this.promiseResolver = a; this.connectionSpeed = 50; var c, e = {}, b = {}, f = {}, g = {}, k = this.__serviceProvider.get("connectionSpeedTimeout"); _.each(this.__serviceProvider.get("speedTestImages"), function (m, l, q) { g[l] = new Image; e[l] = (new Date).getTime(); c = "?_=" + e[l]; g[l].src = m.url + c; g[l].onload = function () { b[l] = (new Date).getTime(); f[l] = b[l] - e[l]; if ((f[l] > k || l + 1 === q.length) && "accepted" != a.promise.state) { var t = Math.round(100 * this.connectionSpeed) / 100; this.connectionSpeed = 8 * m.size / f[l]; this.connectionTier = l; l + 1 === q.length && f[l] < k && (this.connectionTier = 3); this.__window.console.log("Download Duration:", f[l] + "ms", "Limit:", k + "ms"); this.__window.console.log("Connection Speed:", t + "kbps"); this.__window.console.log("Connection Tier:", this.connectionTier); this.__recordEvent("connection_details", { speed_in_kbps: t, tier: this.connectionTier, record: !0 }); a.resolve() } }.bind(this, a, l, q, g, k); g[l].onerror = function (t, R) { this.__window.console.error("Download Error:", t, R); this.connectionTier = this.connectionSpeed = 0; a.resolve() }.bind(this) }, this, e, b, g, c) }.bind(this)) } }) }({ UiCore: n["@UiCore"], Avatar2d: D, FtuxDownloadSubmode: K, FtuxFrontpageSubmode: L, FtuxModule: J, FtuxState: y, FtuxSubmode: w, LookModel: x, Mode: C, PrivacyPolicyAdultDialog: u, UndoRedo: p }).extend("DesktopFtuxMode", {}) });